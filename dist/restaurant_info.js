let restaurant;var map;async function fillReviewsHTML(e){let t;const n=document.getElementById("reviews-container"),r=document.createElement("h2");r.innerHTML="Reviews",r.setAttribute("id","review-title"),n.appendChild(r),await fetchReviewsById(e);const a=await getReviewsByRestaurantId(e);if(!a)throw new Error("Reviews does not exist");t=a.filter(t=>t.restaurant_id==e);if(!t){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const i=document.getElementById("reviews-list");t.forEach(e=>{i.appendChild(createReviewHTML(e))}),n.appendChild(i)}async function addReview(){event.preventDefault();let e=getParameterByName("id");const t={restaurant_id:e,name:document.getElementById("reviewer").value,rating:document.querySelector("#rating-selection option:checked").value,comments:document.getElementById("review-comments").value};if(!navigator.onLine)return void DBHelper.sendOfflineData(t);await postReview(t);const n=document.getElementById("review-title");n.parentNode.removeChild(n),document.getElementById("reviews-list").innerHTML="",fillReviewsHTML(e)}window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{let t;if(self.restaurant)return void e(null,self.restaurant);const n=getParameterByName("id");n?DBHelper.fetchRestaurantById(n).then(n=>{t=n,self.restaurant=t,fillRestaurantHTML(),e(null,t)}).catch(e=>{console.log(e)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e.id)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwiYXN5bmMiLCJmaWxsUmV2aWV3c0hUTUwiLCJyZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZmV0Y2hSZXZpZXdzQnlJZCIsImFsbFJldmlld3MiLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJFcnJvciIsImZpbHRlciIsInIiLCJyZXN0YXVyYW50X2lkIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFkZFJldmlldyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidmFsdWUiLCJyYXRpbmciLCJxdWVyeVNlbGVjdG9yIiwiY29tbWVudHMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJEQkhlbHBlciIsInNlbmRPZmZsaW5lRGF0YSIsInBvc3RSZXZpZXciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwiY29uc29sZSIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJpZCIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJ0aGVuIiwicmVzdWx0IiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibGkiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVzdWx0cyIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQ0osSUFBSUMsSUErRkpDLGVBQWVDLGdCQUFnQkMsR0FDN0IsSUFBSUMsRUFDSixNQUFNQyxFQUFZQyxTQUFTQyxlQUFlLHFCQUNwQ0MsRUFBUUYsU0FBU0csY0FBYyxNQUNyQ0QsRUFBTUUsVUFBWSxVQUNsQkYsRUFBTUcsYUFBYSxLQUFNLGdCQUN6Qk4sRUFBVU8sWUFBWUosU0FJaEJLLGlCQUFpQlYsR0FFdkIsTUFBTVcsUUFBbUJDLHlCQUF5QlosR0FFbEQsSUFBSVcsRUFJRixNQUFNLElBQUlFLE1BQU0sMEJBRmhCWixFQURnQlUsRUFBV0csT0FBT0MsR0FBS0EsRUFBRUMsZUFBaUJoQixHQU01RCxJQUFLQyxFQUFTLENBQ1osTUFBTWdCLEVBQVlkLFNBQVNHLGNBQWMsS0FHekMsT0FGQVcsRUFBVVYsVUFBWSx1QkFDdEJMLEVBQVVPLFlBQVlRLEdBR3hCLE1BQU1DLEVBQUtmLFNBQVNDLGVBQWUsZ0JBQ25DSCxFQUFRa0IsUUFBUUMsSUFDZEYsRUFBR1QsWUFBWVksaUJBQWlCRCxNQUVsQ2xCLEVBQVVPLFlBQVlTLEdBd0R4QnBCLGVBQWV3QixZQUViQyxNQUFNQyxpQkFFTixJQUFJeEIsRUFBZXlCLG1CQUFtQixNQUl0QyxNQUFNTCxFQUFTLENBQ2JKLGNBQWlCaEIsRUFDakIwQixLQUxTdkIsU0FBU0MsZUFBZSxZQUFZdUIsTUFNN0NDLE9BTFd6QixTQUFTMEIsY0FBYyxvQ0FBb0NGLE1BTXRFRyxTQUxhM0IsU0FBU0MsZUFBZSxtQkFBbUJ1QixPQVMxRCxJQUFLSSxVQUFVQyxPQUViLFlBREFDLFNBQVNDLGdCQUFnQmQsU0FJckJlLFdBQVdmLEdBQ2pCLE1BQU1mLEVBQVFGLFNBQVNDLGVBQWUsZ0JBQ3RDQyxFQUFNK0IsV0FBV0MsWUFBWWhDLEdBQ05GLFNBQVNDLGVBQWUsZ0JBQ2hDRyxVQUFZLEdBQzNCUixnQkFBZ0JDLEdBM01sQnNDLE9BQU9DLFFBQVUsTUFDZkMsdUJBQXVCLENBQUNDLEVBQU83QyxLQUN6QjZDLEVBQ0ZDLFFBQVFELE1BQU1BLElBRWRFLEtBQUs5QyxJQUFNLElBQUkrQyxPQUFPQyxLQUFLQyxJQUFJM0MsU0FBU0MsZUFBZSxPQUFRLENBQzdEMkMsS0FBTSxHQUNOQyxPQUFRcEQsRUFBV3FELE9BQ25CQyxhQUFhLElBRWZDLGlCQUNBbEIsU0FBU21CLHVCQUF1QlQsS0FBSy9DLFdBQVkrQyxLQUFLOUMsVUFRNUQyQyx1QkFBeUIsQ0FBQ2EsSUFDeEIsSUFBSXpELEVBQ0osR0FBSStDLEtBQUsvQyxXQUVQLFlBREF5RCxFQUFTLEtBQU1WLEtBQUsvQyxZQUd0QixNQUFNMEQsRUFBSzdCLG1CQUFtQixNQUN6QjZCLEVBSUhyQixTQUFTc0Isb0JBQW9CRCxHQUFJRSxLQUFNQyxJQUNyQzdELEVBQWE2RCxFQUNiZCxLQUFLL0MsV0FBYUEsRUFDbEI4RCxxQkFDQUwsRUFBUyxLQUFNekQsS0FDZCtELE1BQU9DLElBQ1JsQixRQUFRbUIsSUFBSUQsTUFUZG5CLE1BQVEsMEJBQ1JZLEVBQVNaLE1BQU8sU0FnQnBCaUIsbUJBQXFCLEVBQUM5RCxFQUFhK0MsS0FBSy9DLGNBQ3pCTyxTQUFTQyxlQUFlLG1CQUNoQ0csVUFBWVgsRUFBVzhCLEtBRVp2QixTQUFTQyxlQUFlLHNCQUNoQ0csVUFBWVgsRUFBV2tFLFFBRS9CLE1BQU1DLEVBQVE1RCxTQUFTQyxlQUFlLGtCQUN0QzJELEVBQU1DLFVBQVksaUJBQ2xCRCxFQUFNdkQsYUFBYSxNQUFPWixFQUFXOEIsTUFDckNxQyxFQUFNRSxJQUFNaEMsU0FBU2lDLHNCQUFzQnRFLEdBRTNCTyxTQUFTQyxlQUFlLHNCQUNoQ0csVUFBWVgsRUFBV3VFLGFBRzNCdkUsRUFBV3dFLGlCQUNiQywwQkFHRnRFLGdCQUFnQkgsRUFBVzBELE1BTTdCZSx3QkFBMEIsRUFBQ0MsRUFBaUIzQixLQUFLL0MsV0FBV3dFLG1CQUMxRCxNQUFNRyxFQUFRcEUsU0FBU0MsZUFBZSxvQkFDdEMsSUFBSyxJQUFJb0UsS0FBT0YsRUFBZ0IsQ0FDOUIsTUFBTUcsRUFBTXRFLFNBQVNHLGNBQWMsTUFFN0JvRSxFQUFNdkUsU0FBU0csY0FBYyxNQUNuQ29FLEVBQUluRSxVQUFZaUUsRUFDaEJDLEVBQUloRSxZQUFZaUUsR0FFaEIsTUFBTUMsRUFBT3hFLFNBQVNHLGNBQWMsTUFDcENxRSxFQUFLcEUsVUFBWStELEVBQWVFLEdBQ2hDQyxFQUFJaEUsWUFBWWtFLEdBRWhCSixFQUFNOUQsWUFBWWdFLE1BNEN0QnBELGlCQUFtQixDQUFDRCxJQUNsQixNQUFNd0QsRUFBS3pFLFNBQVNHLGNBQWMsTUFDNUJvQixFQUFPdkIsU0FBU0csY0FBYyxLQUNwQ29CLEVBQUtuQixVQUFZYSxFQUFPTSxLQUN4QmtELEVBQUduRSxZQUFZaUIsR0FFZixNQUFNbUQsRUFBTzFFLFNBQVNHLGNBQWMsS0FDcEN1RSxFQUFLdEUsVUFBWSxJQUFJdUUsS0FBSzFELEVBQU8yRCxXQUFXQyxlQUM1Q0osRUFBR25FLFlBQVlvRSxHQUVmLE1BQU1qRCxFQUFTekIsU0FBU0csY0FBYyxLQUN0Q3NCLEVBQU9yQixxQkFBdUJhLEVBQU9RLFNBQ3JDZ0QsRUFBR25FLFlBQVltQixHQUVmLE1BQU1FLEVBQVczQixTQUFTRyxjQUFjLEtBSXhDLE9BSEF3QixFQUFTdkIsVUFBWWEsRUFBT1UsU0FDNUI4QyxFQUFHbkUsWUFBWXFCLEdBRVI4QyxJQU1UekIsZUFBaUIsRUFBQ3ZELEVBQWErQyxLQUFLL0MsY0FDbEMsTUFBTXFGLEVBQWE5RSxTQUFTQyxlQUFlLGNBQ3JDd0UsRUFBS3pFLFNBQVNHLGNBQWMsTUFDbENzRSxFQUFHckUsVUFBWVgsRUFBVzhCLEtBQzFCdUQsRUFBV3hFLFlBQVltRSxLQU16Qm5ELG1CQUFxQixFQUFDQyxFQUFNd0QsS0FDckJBLElBQ0hBLEVBQU01QyxPQUFPNkMsU0FBU0MsTUFDeEIxRCxFQUFPQSxFQUFLMkQsUUFBUSxVQUFXLFFBQy9CLE1BQ0VDLEVBRFksSUFBSUMsY0FBYzdELHNCQUNkOEQsS0FBS04sR0FDdkIsT0FBS0ksRUFFQUEsRUFBUSxHQUVORyxtQkFBbUJILEVBQVEsR0FBR0QsUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XHJcbnZhciBtYXA7XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGxldCByZXN0YXVyYW50XHJcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XHJcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcclxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xyXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkKS50aGVuKChyZXN1bHQpID0+IHtcclxuICAgICAgcmVzdGF1cmFudCA9IHJlc3VsdFxyXG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpXHJcbiAgICB9KVxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgcmVzdGF1cmFudC5uYW1lKVxyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcclxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuICB9XHJcbiAgLy8gZmlsbCByZXZpZXdzIG5ld2VyIHZlcnNpb25zIG5vdyBuZWVkcyByZXN0YXVyYW50IGlkIHRvIHBhc3NlZFxyXG4gIGZpbGxSZXZpZXdzSFRNTChyZXN0YXVyYW50LmlkKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XHJcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XHJcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG5cclxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XHJcblxyXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBmaWxsUmV2aWV3c0hUTUwocmVzdGF1cmFudElkKSB7XHJcbiAgbGV0IHJldmlld3M7XHJcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcclxuICB0aXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcInJldmlldy10aXRsZVwiKTtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xyXG4gIC8vIFRoaXMgZnVuY3Rpb24gd2FzIG1vZGlmaWVkIHRvIGJlIGFibGUgdG8gZ2V0IGFsbHJldmlld3MgZnJvbVxyXG5cclxuICAvLyBGZXRjaCBhbGwgcmV2aWV3cyBvZiBjZXJ0YWluIHJlc3RhdXJhbnRcclxuICBhd2FpdCBmZXRjaFJldmlld3NCeUlkKHJlc3RhdXJhbnRJZCk7XHJcblxyXG4gIGNvbnN0IGFsbFJldmlld3MgPSBhd2FpdCBnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQocmVzdGF1cmFudElkKTtcclxuXHJcbiAgaWYgKGFsbFJldmlld3MpIHtcclxuICAgIGNvbnN0IHJlc3VsdHMgPSBhbGxSZXZpZXdzLmZpbHRlcihyID0+IHIucmVzdGF1cmFudF9pZCA9PSByZXN0YXVyYW50SWQpO1xyXG4gICAgcmV2aWV3cyA9IHJlc3VsdHNcclxuICB9IGVsc2Uge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCdSZXZpZXdzIGRvZXMgbm90IGV4aXN0JylcclxuICB9XHJcblxyXG4gIGlmICghcmV2aWV3cykge1xyXG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICB9KTtcclxuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XHJcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KS50b0RhdGVTdHJpbmcoKTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKVxyXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xyXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuICBpZiAoIXJlc3VsdHMpXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pXHJcbiAgICByZXR1cm4gJyc7XHJcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCB0aGUgdmFsdWVzIGZyb20gdGhlIHJldmlldyBmb3JtXHJcbiAqL1xyXG5hc3luYyBmdW5jdGlvbiBhZGRSZXZpZXcoKSB7XHJcbiAgLy8gUHJldmVudGluZyBkZWZhdWwgYmVoYXZpb3JcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIC8vIFJldHJpdmluZyBuZXNzZXNhcnkgZGF0YSBmcm9tIG91ciBmb3JtXHJcbiAgbGV0IHJlc3RhdXJhbnRJZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcclxuICBsZXQgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdlcicpLnZhbHVlO1xyXG4gIGxldCByYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmF0aW5nLXNlbGVjdGlvbiBvcHRpb246Y2hlY2tlZCcpLnZhbHVlO1xyXG4gIGxldCBjb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctY29tbWVudHMnKS52YWx1ZVxyXG4gIGNvbnN0IHJldmlldyA9IHtcclxuICAgICdyZXN0YXVyYW50X2lkJzogcmVzdGF1cmFudElkLFxyXG4gICAgJ25hbWUnOiBuYW1lLFxyXG4gICAgJ3JhdGluZyc6IHJhdGluZyxcclxuICAgICdjb21tZW50cyc6IGNvbW1lbnRzXHJcbiAgfVxyXG5cclxuICAvLyBDaGVja2luZyBpZiBjbGllbnQgaXMgb25saW5lXHJcbiAgaWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICBEQkhlbHBlci5zZW5kT2ZmbGluZURhdGEocmV2aWV3KTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgXHJcbiAgYXdhaXQgcG9zdFJldmlldyhyZXZpZXcpO1xyXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy10aXRsZScpO1xyXG4gIHRpdGxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGl0bGUpO1xyXG4gIGNvbnN0IHJldmlld3NDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHJldmlld3NDb250ZW50LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnRJZClcclxufSJdfQ==
