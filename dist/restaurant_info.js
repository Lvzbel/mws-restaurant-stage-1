let restaurant;var map;async function fillReviewsHTML(e){let t;const n=document.getElementById("reviews-container"),r=document.createElement("h2");r.innerHTML="Reviews",r.setAttribute("id","review-title"),n.appendChild(r),await fetchReviewsById(e);const a=await getReviewsByRestaurantId(e);if(!a)throw new Error("Reviews does not exist");t=a.filter(t=>t.restaurant_id==e);if(!t){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const i=document.getElementById("reviews-list");t.forEach(e=>{i.appendChild(createReviewHTML(e))}),n.appendChild(i)}async function addReview(){event.preventDefault();let e=getParameterByName("id");const t={restaurant_id:e,name:document.getElementById("reviewer").value,rating:document.querySelector("#rating-selection option:checked").value,comments:document.getElementById("review-comments").value};if(!navigator.onLine)return void DBHelper.sendOfflineData(t);await postReview(t);const n=document.getElementById("review-title");n.parentNode.removeChild(n),document.getElementById("reviews-list").innerHTML="",fillReviewsHTML(e)}window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{let t;if(self.restaurant)return void e(null,self.restaurant);const n=getParameterByName("id");n?DBHelper.fetchRestaurantById(n).then(n=>{t=n,self.restaurant=t,fillRestaurantHTML(),e(null,t)}).catch(e=>{console.log(e)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e.id)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwiYXN5bmMiLCJmaWxsUmV2aWV3c0hUTUwiLCJyZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZmV0Y2hSZXZpZXdzQnlJZCIsImFsbFJldmlld3MiLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJFcnJvciIsImZpbHRlciIsInIiLCJyZXN0YXVyYW50X2lkIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFkZFJldmlldyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidmFsdWUiLCJyYXRpbmciLCJxdWVyeVNlbGVjdG9yIiwiY29tbWVudHMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJEQkhlbHBlciIsInNlbmRPZmZsaW5lRGF0YSIsInBvc3RSZXZpZXciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwiY29uc29sZSIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJpZCIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJ0aGVuIiwicmVzdWx0IiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibGkiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVzdWx0cyIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQ0osSUFBSUMsSUErRkpDLGVBQWVDLGdCQUFnQkMsR0FDN0IsSUFBSUMsRUFDSixNQUFNQyxFQUFZQyxTQUFTQyxlQUFlLHFCQUNwQ0MsRUFBUUYsU0FBU0csY0FBYyxNQUNyQ0QsRUFBTUUsVUFBWSxVQUNsQkYsRUFBTUcsYUFBYSxLQUFNLGdCQUN6Qk4sRUFBVU8sWUFBWUosU0FJaEJLLGlCQUFpQlYsR0FFdkIsTUFBTVcsUUFBbUJDLHlCQUF5QlosR0FFbEQsSUFBSVcsRUFJRixNQUFNLElBQUlFLE1BQU0sMEJBRmhCWixFQURnQlUsRUFBV0csT0FBT0MsR0FBS0EsRUFBRUMsZUFBaUJoQixHQU01RCxJQUFLQyxFQUFTLENBQ1osTUFBTWdCLEVBQVlkLFNBQVNHLGNBQWMsS0FHekMsT0FGQVcsRUFBVVYsVUFBWSx1QkFDdEJMLEVBQVVPLFlBQVlRLEdBR3hCLE1BQU1DLEVBQUtmLFNBQVNDLGVBQWUsZ0JBQ25DSCxFQUFRa0IsUUFBUUMsSUFDZEYsRUFBR1QsWUFBWVksaUJBQWlCRCxNQUVsQ2xCLEVBQVVPLFlBQVlTLEdBd0R4QnBCLGVBQWV3QixZQUViQyxNQUFNQyxpQkFFTixJQUFJeEIsRUFBZXlCLG1CQUFtQixNQUl0QyxNQUFNTCxFQUFTLENBQ2JKLGNBQWlCaEIsRUFDakIwQixLQUxTdkIsU0FBU0MsZUFBZSxZQUFZdUIsTUFNN0NDLE9BTFd6QixTQUFTMEIsY0FBYyxvQ0FBb0NGLE1B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QWMsTUFDbENzRSxFQUFHckUsVUFBWVgsRUFBVzhCLEtBQzFCdUQsRUFBV3hFLFlBQVltRSxLQU16Qm5ELG1CQUFxQixFQUFDQyxFQUFNd0QsS0FDckJBLElBQ0hBLEVBQU01QyxPQUFPNkMsU0FBU0MsTUFDeEIxRCxFQUFPQSxFQUFLMkQsUUFBUSxVQUFXLFFBQy9CLE1BQ0VDLEVBRFksSUFBSUMsY0FBYzdELHNCQUNkOEQsS0FBS04sR0FDdkIsT0FBS0ksRUFFQUEsRUFBUSxHQUVORyxtQkFBbUJILEVBQVEsR0FBR0QsUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XG52YXIgbWFwO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICAgIH0pO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcbiAgbGV0IHJlc3RhdXJhbnRcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgfSBlbHNlIHtcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIHJlc3RhdXJhbnQgPSByZXN1bHRcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnRcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgfSlcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcblxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXG4gIGltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCByZXN0YXVyYW50Lm5hbWUpXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzIG5ld2VyIHZlcnNpb25zIG5vdyBuZWVkcyByZXN0YXVyYW50IGlkIHRvIHBhc3NlZFxuICBmaWxsUmV2aWV3c0hUTUwocmVzdGF1cmFudC5pZCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgb3BlcmF0aW5nIGhvdXJzIEhUTUwgdGFibGUgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XG4gIGNvbnN0IGhvdXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaG91cnMnKTtcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5hc3luYyBmdW5jdGlvbiBmaWxsUmV2aWV3c0hUTUwocmVzdGF1cmFudElkKSB7XG4gIGxldCByZXZpZXdzO1xuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XG4gIHRpdGxlLnNldEF0dHJpYnV0ZShcImlkXCIsIFwicmV2aWV3LXRpdGxlXCIpO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuICAvLyBUaGlzIGZ1bmN0aW9uIHdhcyBtb2RpZmllZCB0byBiZSBhYmxlIHRvIGdldCBhbGxyZXZpZXdzIGZyb21cblxuICAvLyBGZXRjaCBhbGwgcmV2aWV3cyBvZiBjZXJ0YWluIHJlc3RhdXJhbnRcbiAgYXdhaXQgZmV0Y2hSZXZpZXdzQnlJZChyZXN0YXVyYW50SWQpO1xuXG4gIGNvbnN0IGFsbFJldmlld3MgPSBhd2FpdCBnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQocmVzdGF1cmFudElkKTtcblxuICBpZiAoYWxsUmV2aWV3cykge1xuICAgIGNvbnN0IHJlc3VsdHMgPSBhbGxSZXZpZXdzLmZpbHRlcihyID0+IHIucmVzdGF1cmFudF9pZCA9PSByZXN0YXVyYW50SWQpO1xuICAgIHJldmlld3MgPSByZXN1bHRzXG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdSZXZpZXdzIGRvZXMgbm90IGV4aXN0JylcbiAgfVxuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9IG5ldyBEYXRlKHJldmlldy51cGRhdGVkQXQpLnRvRGF0ZVN0cmluZygpO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn1cblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5nZXRQYXJhbWV0ZXJCeU5hbWUgPSAobmFtZSwgdXJsKSA9PiB7XG4gIGlmICghdXJsKVxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gIGlmICghcmVzdWx0cylcbiAgICByZXR1cm4gbnVsbDtcbiAgaWYgKCFyZXN1bHRzWzJdKVxuICAgIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIHZhbHVlcyBmcm9tIHRoZSByZXZpZXcgZm9ybVxuICovXG5hc3luYyBmdW5jdGlvbiBhZGRSZXZpZXcoKSB7XG4gIC8vIFByZXZlbnRpbmcgZGVmYXVsIGJlaGF2aW9yXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIC8vIFJldHJpdmluZyBuZXNzZXNhcnkgZGF0YSBmcm9tIG91ciBmb3JtXG4gIGxldCByZXN0YXVyYW50SWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIGxldCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld2VyJykudmFsdWU7XG4gIGxldCByYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmF0aW5nLXNlbGVjdGlvbiBvcHRpb246Y2hlY2tlZCcpLnZhbHVlO1xuICBsZXQgY29tbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LWNvbW1lbnRzJykudmFsdWVcbiAgY29uc3QgcmV2aWV3ID0ge1xuICAgICdyZXN0YXVyYW50X2lkJzogcmVzdGF1cmFudElkLFxuICAgICduYW1lJzogbmFtZSxcbiAgICAncmF0aW5nJzogcmF0aW5nLFxuICAgICdjb21tZW50cyc6IGNvbW1lbnRzXG4gIH1cblxuICAvLyBDaGVja2luZyBpZiBjbGllbnQgaXMgb25saW5lXG4gIGlmICghbmF2aWdhdG9yLm9uTGluZSkge1xuICAgIERCSGVscGVyLnNlbmRPZmZsaW5lRGF0YShyZXZpZXcpO1xuICAgIHJldHVybjtcbiAgfVxuICBcbiAgYXdhaXQgcG9zdFJldmlldyhyZXZpZXcpO1xuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctdGl0bGUnKTtcbiAgdGl0bGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aXRsZSk7XG4gIGNvbnN0IHJldmlld3NDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzQ29udGVudC5pbm5lckhUTUwgPSBcIlwiO1xuICBmaWxsUmV2aWV3c0hUTUwocmVzdGF1cmFudElkKVxufSJdfQ==
