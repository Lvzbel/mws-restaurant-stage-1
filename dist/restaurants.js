async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t,e){let a=await idb.open(`reviews-db-id:${e}`,1,t=>t.createObjectStore(`reviews-id:${e}`,{keyPath:"id"})),r=a.transaction(`reviews-id:${e}`,"readwrite"),n=r.objectStore(`reviews-id:${e}`);t.forEach(t=>{n.put(t)}),await r.complete,a.close()}async function getReviewsByRestaurantId(t){let e=await idb.open(`reviews-db-id:${t}`,1),a=e.transaction(`reviews-id:${t}`,"readonly").objectStore(`reviews-id:${t}`),r=await a.getAll();return e.close(),r}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function postReview(t){await fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})})}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");n.get(t).then(t=>{t.is_favorite=e,n.put(t)}),await r.complete,a.close()}async function fetchReviewsById(t){let e=await fetch(`http://localhost:1337/reviews/?restaurant_id=${t}`);if(200===e.status){const a=await e.json();return await storeAllReviews(a,t),a}throw new Error("Resquest of reviews has failed")}const toggleFavClassAndElement=(t,e)=>{"true"===t|!0===t?(e.classList.add("yesFav"),e.setAttribute("aria-label","remove as favorite")):(e.classList.remove("yesFav"),e.setAttribute("aria-label","remove as favorite"))};class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static async sendOfflineData(t){localStorage.setItem("data",JSON.stringify(t));const e=document.getElementById("reviews-list"),a=document.createElement("li"),r=document.createElement("p");r.innerHTML=t.name,a.appendChild(r);const n=document.createElement("p");n.innerHTML=(new Date).toDateString(),a.appendChild(n);const s=document.createElement("p");s.innerHTML=`Rating: ${t.rating}`,a.appendChild(s);const o=document.createElement("p");o.innerHTML=t.comments,a.appendChild(o),e.appendChild(a);const i=document.getElementById("offline-alert");i.style.display="block",window.addEventListener("online",t=>{postReview(JSON.parse(localStorage.getItem("data"))),i.style.display="none",localStorage.removeItem("data")})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,s=t.selectedIndex,r=e[n].value,a=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,a).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant_responsive(e),s=document.createElement("figure"),r=document.createElement("picture"),a=document.createElement("source"),o=document.createElement("source"),c=document.createElement("img"),l=document.createElement("figcaption");a.setAttribute("media","(min-width: 501px)"),a.setAttribute("srcset",`${n}_large_2x.jpg 2x, ${n}_large_1x.jpg`),o.setAttribute("media","(max-width: 500px)"),o.setAttribute("srcset",`${n}_small_2x.jpg 2x, ${n}_small_1x.jpg`),c.className="restaurant-img",c.src=DBHelper.imageUrlForRestaurant(e),c.setAttribute("alt",e.name),l.textContent=e.name,s.append(r),s.append(l),r.append(a),r.append(o),r.append(c),t.append(s);const i=document.createElement("h1");i.innerHTML=e.name,t.append(i);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),toggleFavClassAndElement(e.is_favorite,d),d.onclick=(()=>{const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,toggleFavClassAndElement(e.is_favorite,d)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const m=document.createElement("p");m.innerHTML=e.address,t.append(m);const p=document.createElement("a");return p.innerHTML="View Details",p.href=DBHelper.urlForRestaurant(e),t.append(p),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwiaWQiLCJyZXZpZXciLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJwb3N0UmV2aWV3IiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwidXBkYXRlRmF2b3JpdGVTdGF0dXMiLCJyZXN0YXVyYW50SWQiLCJmYXZvcml0ZVN0YXR1cyIsImdldCIsInRoZW4iLCJyZXN0dXJhbnQiLCJpc19mYXZvcml0ZSIsImZldGNoUmV2aWV3c0J5SWQiLCJyZXZpZXdSZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJFcnJvciIsInRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudCIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmUiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsInJlc3RhdXJhbnRSZXNwb25zZSIsImZldGNoUmVzdGF1cmFudHMiLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJlcnIiLCJmaW5kIiwiciIsIm5laWdoYm9yaG9vZCIsImZpbHRlciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5kZWZpbmVkIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInVsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxpIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiZGF0ZSIsIkRhdGUiLCJ0b0RhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsIm9mZmxpbmVBbGVydCIsInN0eWxlIiwiZGlzcGxheSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInBhcnNlIiwiZ2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwic2NvcGUiLCJyZWdpc3RyYXRpb24iLCJlIiwiZXJyb3IiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsInNlbGVjdCIsIm9wdGlvbiIsInZhbHVlIiwiYXBwZW5kIiwicmVzdXRscyIsImZpbGxDdWlzaW5lc0hUTUwiLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImltYWdlSUQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZSIsImZpZ3VyZSIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsInNvdXJjZVNtYWxsIiwiaW1hZ2UiLCJmaWdDYXB0aW9uIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwidGV4dENvbnRlbnQiLCJpc0Zhdm9yaXRlIiwib25jbGljayIsImN1cnJlbnRGYXZTdGF0dXMiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInB1c2giXSwibWFwcGluZ3MiOiJBQUdFQSxlQUFlQyxtQkFBbUJDLEdBQ2hDLElBQUlDLFFBQVdDLElBQUlDLEtBQUssaUJBQWtCLEVBQUdDLEdBQWFBLEVBQVVDLGtCQUFrQixjQUFlLENBQ25HQyxRQUFTLFFBR1BDLEVBQUtOLEVBQUdPLFlBQVksY0FBZSxhQUNuQ0MsRUFBUUYsRUFBR0csWUFBWSxlQUUzQlYsRUFBWVcsUUFBUUMsSUFDbEJILEVBQU1JLElBQUlELFdBR05MLEVBQUdPLFNBQ1RiLEVBQUdjLFFBTUxqQixlQUFla0IsZ0JBQWdCQyxFQUFTQyxHQUN0QyxJQUFJakIsUUFBV0MsSUFBSUMsc0JBQXNCZSxJQUFNLEVBQUdkLEdBQWFBLEVBQVVDLGdDQUFnQ2EsSUFBTSxDQUM3R1osUUFBUyxRQUdQQyxFQUFLTixFQUFHTywwQkFBMEJVLElBQU0sYUFDeENULEVBQVFGLEVBQUdHLDBCQUEwQlEsS0FDekNELEVBQVFOLFFBQVFRLElBQ2RWLEVBQU1JLElBQUlNLFdBR05aLEVBQUdPLFNBQ1RiLEVBQUdjLFFBR0xqQixlQUFlc0IseUJBQXlCRixHQUN0QyxJQUFJakIsUUFBV0MsSUFBSUMsc0JBQXNCZSxJQUFNLEdBRzNDVCxFQURLUixFQUFHTywwQkFBMEJVLElBQU0sWUFDN0JSLDBCQUEwQlEsS0FFckNHLFFBQXNCWixFQUFNYSxTQUloQyxPQUZBckIsRUFB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QVMsS0FDN0M5RCxPQUFPaUUsU0FBU0osS0FBT0MsRUFBT3BGLE1BRWhDc0MsS0FBS1YsUUFBUTRELEtBQUtKIiwiZmlsZSI6InJlc3RhdXJhbnRzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiICAvKipcbiAgICogQ3JlYXRlIHJlc3RhdXJhbnRzIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgdXBncmFkZURCID0+IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XG4gICAgICBrZXlQYXRoOiAnaWQnXG4gICAgfSkpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxuXG4gICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KVxuICAgIH0pO1xuXG4gICAgYXdhaXQgdHguY29tcGxldGVcbiAgICBkYi5jbG9zZSgpXG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgcmV2aWV3cyBieSByZXN0YXVyYW50IGlkIGluIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gc3RvcmVBbGxSZXZpZXdzKHJldmlld3MsIGlkKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oYHJldmlld3MtZGItaWQ6JHtpZH1gLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKGByZXZpZXdzLWlkOiR7aWR9YCwge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3MtaWQ6JHtpZH1gLCAncmVhZHdyaXRlJylcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShgcmV2aWV3cy1pZDoke2lkfWApXG4gICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgICBzdG9yZS5wdXQocmV2aWV3KVxuICAgIH0pO1xuXG4gICAgYXdhaXQgdHguY29tcGxldGVcbiAgICBkYi5jbG9zZSgpXG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbihgcmV2aWV3cy1kYi1pZDoke2lkfWAsIDEpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihgcmV2aWV3cy1pZDoke2lkfWAsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxuXG4gICAgbGV0IGFsbFNhdmVkSXRlbXMgPSBhd2FpdCBzdG9yZS5nZXRBbGwoKVxuXG4gICAgZGIuY2xvc2UoKVxuXG4gICAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaXZlIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmVzdGF1cmFudHMoKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAgIGRiLmNsb3NlKClcblxuICAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgYWxsIHJlc3RhdXJhbnRzIGluIEluZGV4ZWREQi5cbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cykge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgLyoqXG4gICAqIFBPU1QgbmV3IHJldmlld1xuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gcG9zdFJldmlldyhyZXZpZXcpIHtcbiAgICBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldyksXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlU3RhdHVzKHJlc3RhdXJhbnRJZCwgZmF2b3JpdGVTdGF0dXMpIHtcbiAgICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudElkfS8/aXNfZmF2b3JpdGU9JHtmYXZvcml0ZVN0YXR1c31gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpO1xuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG5cbiAgICBzdG9yZS5nZXQocmVzdGF1cmFudElkKVxuICAgICAgLnRoZW4ocmVzdHVyYW50ID0+IHtcbiAgICAgICAgcmVzdHVyYW50LmlzX2Zhdm9yaXRlID0gZmF2b3JpdGVTdGF0dXM7XG4gICAgICAgIHN0b3JlLnB1dChyZXN0dXJhbnQpO1xuICAgICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZTtcbiAgICBkYi5jbG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaFJldmlld3NCeUlkKGlkKSB7XG4gICAgbGV0IHJldmlld1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7aWR9YClcbiAgICBpZiAocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcbiAgICAgIGF3YWl0IHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZClcbiAgICAgIHJldHVybiByZXZpZXdzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVzcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcbiAgICB9XG4gIH1cbiAgICAvKipcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcbiAgICovXG4gIGNvbnN0IHRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudCA9IChzdGF0dXMsIGVsZW1lbnQpID0+IHtcblxuICAgIGlmIChzdGF0dXMgPT09ICd0cnVlJyB8IHN0YXR1cyA9PT0gdHJ1ZSkge1xuICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKCd5ZXNGYXYnKVxuICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAncmVtb3ZlIGFzIGZhdm9yaXRlJylcbiAgICB9IGVsc2UgIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgneWVzRmF2JylcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ3JlbW92ZSBhcyBmYXZvcml0ZScpXG4gICAgfVxuICB9XG5cbiAgY2xhc3MgREJIZWxwZXIge1xuXG4gICAgLyoqXG4gICAgICogRGF0YWJhc2UgVVJMLlxuICAgICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcbiAgICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudHMoKSB7XG4gICAgICAvLyBGZXRjaCByZXN0dXJhbnRzIGRhdGEgYmFzZVxuICAgICAgY29uc3QgcmVzdGF1cmFudFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfWApXG5cbiAgICAgIGlmIChyZXN0YXVyYW50UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCByZXN0YXVyYW50UmVzcG9uc2UuanNvbigpXG4gICAgICAgIC8vIHN0b3JlIHJlc3RhdXJhbnQgZGF0YSBiYXNlIGludG8gSW5kZXhlZERCXG4gICAgICAgIGF3YWl0IHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cylcbiAgICAgICAgLy8gLy8gZmV0Y2ggYW5kIHN0b3JlIGFsbCByZXZpZXdzXG4gICAgICAgIC8vIGNvbnN0IHJldmlld1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7REJIZWxwZXIuUkVWSUVXREFUQV9VUkx9YClcblxuICAgICAgICAvLyBpZiAocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgLy8gICBjb25zdCByZXZpZXdzID0gYXdhaXQgcmV2aWV3UmVzcG9uc2UuanNvbigpXG4gICAgICAgIC8vICAgYXdhaXQgc3RvcmVBbGxSZXZpZXdzKHJldmlld3MpXG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IG9mIHJldmlld3MgaGFzIGZhaWxlZCcpXG4gICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb2YgcmVzdGF1cmFudHMgaGFzIGZhaWxlZCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQpIHtcblxuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpXG4gICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpXG4gICAgICBpZiAocmVzdGF1cmFudCkge1xuICAgICAgICByZXR1cm4gcmVzdGF1cmFudFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCkge1xuXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIHJldHVybiByZXN1bHRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laWdib3Job29kIGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0c1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50cyB3aXRoIGN1aXNpbmUgYW5kIG5laWdoYm9yaG9vZCBjb25iaW5hdGlvbiBkb2VzIG5vdCBleGlzdCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcblxuICAgICAgICByZXR1cm4gdW5pcXVlTmVpZ2hib3Job29kc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgYXQgZmV0Y2hpbmcgYWxsIG5laWdoYm9yaG9vZHMnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hDdWlzaW5lcygpIHtcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcblxuICAgICAgICByZXR1cm4gdW5pcXVlQ3Vpc2luZXNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGF0IGZldGNoaW5nIGFsbCBjdWlzaW5lJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgICAqL1xuICAgIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XG4gICAgICovXG4gICAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICBjb25zdCBwaG90byA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblxuICAgICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIChgL2ltZy9lcnJvci5qcGdgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3BvbnNpdmUgaW1hZ2Ugb25seSBnZXRzIHRoZSBuYW1lIG9mIHRoZSBwaWN0dXJlIGJ5IGlkIHdpaG91dCBnZXR0aW5nIHRoZSBleHRlbnNpb24sIGV4dGVuc2lvbiB3aWxsIGJlIGFkZGVkIGluIGxhdGVyXG4gICAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxuICAgICAqL1xuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KSB7XG5cbiAgICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXG4gICAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gKGBpbWcvcmVzcG9uc2l2ZV9pbWcvZXJyb3JgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy8ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgICAqL1xuICAgIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuICAgICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWFya2VyO1xuICAgIH1cblxuICAgIHN0YXRpYyBhc3luYyBzZW5kT2ZmbGluZURhdGEocmV2aWV3KSB7XG4gICAgICAvLyBTdG9yZSB0aGUgcmV2aWV3IG9uIGxvY2FsIHN0b3JhZ2VcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkocmV2aWV3KSk7XG5cbiAgICAgIC8vIEJ1aWxkIHRlbXBvcmFyeSBVSSBhbmQgYXBwZW5kIHRvIHRoZSBhbHJlYWR5IGxpc3Qgb2YgcmV2aWV3c1xuICAgICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICAgICAgbGkuYXBwZW5kQ2hpbGQobmFtZSlcblxuICAgICAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUoKS50b0RhdGVTdHJpbmcoKTtcbiAgICAgIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xuXG4gICAgICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gICAgICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gICAgICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgICAgIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuICAgICAgdWwuYXBwZW5kQ2hpbGQobGkpXG5cbiAgICAgIC8vIFNob3cgT2ZmbGluZSBBbGVydFxuICAgICAgY29uc3Qgb2ZmbGluZUFsZXJ0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvZmZsaW5lLWFsZXJ0XCIpXG4gICAgICBvZmZsaW5lQWxlcnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcblxuICAgICAgLy8gV2FpdCB1bnRpbCBjbGllbnQgaXMgYmFjayBvbmxpbmVcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgLy8gR2V0dGluZyBkYXRhIGZyb20gbG9jYWxTdG9yYWdlXG4gICAgICAgIGxldCByZXZpZXcgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhJykpXG4gICAgICAgIC8vIFNlbmRpbmcgcmV2aWV3IHRvIHRoZSBzZXJ2ZXJcbiAgICAgICAgcG9zdFJldmlldyhyZXZpZXcpXG5cbiAgICAgICAgLy8gUmVtb3ZlIG9mZmxpbmUgbm90aXRpY2F0aW9uXG4gICAgICAgIG9mZmxpbmVBbGVydC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgICAgLy8gUmVtb3ZlIGxvY2FsU3RvcmFnZSBkYXRhXG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdkYXRhJylcbiAgICAgIH0pXG4gICAgfVxuICB9IiwibGV0IHJlc3RhdXJhbnRzLFxuICBuZWlnaGJvcmhvb2RzLFxuICBjdWlzaW5lc1xudmFyIG1hcFxudmFyIG1hcmtlcnMgPSBbXVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDaGVja2luZyBpZiBTZXJ2aWNlIFdvcmtlciBpcyBhdmFpYmxlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy4vc2VydmljZS13b3JrZXIuanMnLCB7XG4gICAgICBzY29wZTogJy4vJ1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJhdGlvbikge1xuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgUmVnaXN0ZXInKTtcbiAgICB9KVxuICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgfSlcbn0gZWxzZSB7XG4gIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIG5vdCBzdXBwb3J0ZWQuJyk7XG59XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgYXdhaXQgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcyhuZWlnaGJvcmhvb2RzKVxuICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSByZXN1bHRzO1xuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoQ3Vpc2luZXMgPSAoY3Vpc2luZXMpID0+IHtcbiAgLy8gRE9ORVxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKGN1aXNpbmVzKVxuICAgIC50aGVuKChyZXN1dGxzKSA9PiB7XG4gICAgICBzZWxmLmN1aXNpbmVzID0gcmVzdXRscztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG59XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbmZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcblxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBsZXQgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdWx0cyk7XG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuICBzZWxmLm1hcmtlcnMgPSBbXTtcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuICB9KTtcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgY29uc3QgaW1hZ2VJRCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpO1xuICBjb25zdCBmaWd1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKTtcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcbiAgY29uc3Qgc291cmNlTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3Qgc291cmNlU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgY29uc3QgZmlnQ2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ2NhcHRpb24nKTtcblxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtaW4td2lkdGg6IDUwMXB4KScpO1xuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGAke2ltYWdlSUR9X2xhcmdlXzJ4LmpwZyAyeCwgJHtpbWFnZUlEfV9sYXJnZV8xeC5qcGdgKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOiA1MDBweCknKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZUlEfV9zbWFsbF8yeC5qcGcgMngsICR7aW1hZ2VJRH1fc21hbGxfMXguanBnYCk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHJlc3RhdXJhbnQubmFtZSlcbiAgZmlnQ2FwdGlvbi50ZXh0Q29udGVudCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgZmlndXJlLmFwcGVuZChwaWN0dXJlKTtcbiAgZmlndXJlLmFwcGVuZChmaWdDYXB0aW9uKVxuICBwaWN0dXJlLmFwcGVuZChzb3VyY2VMYXJnZSk7XG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZVNtYWxsKTtcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xuICBsaS5hcHBlbmQoZmlndXJlKTtcblxuXG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBsaS5hcHBlbmQobmFtZSk7XG5cbiAgY29uc3QgaXNGYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBpc0Zhdm9yaXRlLmlubmVySFRNTCA9ICcmaGVhcnRzOyc7XG4gIGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgnaXNGYXZvcml0ZScpXG4gIC8vIFNldCBzdHlsZXMgZGVwZW5kaW5nIGlmIGlzIGZhdm9yaXRlIG9yIG5vdFxuICB0b2dnbGVGYXZDbGFzc0FuZEVsZW1lbnQocmVzdGF1cmFudC5pc19mYXZvcml0ZSwgaXNGYXZvcml0ZSlcblxuICAvLyBVcGRhdGluZyBkYXRhIGJhc2UgYmFzZSBvbiBmYXZvcml0ZSBzdGF0dXNcbiAgaXNGYXZvcml0ZS5vbmNsaWNrID0gKCkgPT4ge1xuICAgIC8vIGlzRmF2b3JpdGUuY2xhc3NMaXN0LnRvZ2dsZSgneWVzRmF2JylcbiAgICBjb25zdCBjdXJyZW50RmF2U3RhdHVzID0gIUpTT04ucGFyc2UocmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gICAgY29uc29sZS5sb2coY3VycmVudEZhdlN0YXR1cyk7XG4gICAgdXBkYXRlRmF2b3JpdGVTdGF0dXMocmVzdGF1cmFudC5pZCwgY3VycmVudEZhdlN0YXR1cyk7XG4gICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGN1cnJlbnRGYXZTdGF0dXNcbiAgICAvLyBTZXQgc3R5bGVzIGRlcGVuZGluZyBpZiBpcyBmYXZvcml0ZSBvciBub3RcbiAgICB0b2dnbGVGYXZDbGFzc0FuZEVsZW1lbnQocmVzdGF1cmFudC5pc19mYXZvcml0ZSwgaXNGYXZvcml0ZSlcbiAgfVxuICBsaS5hcHBlbmQoaXNGYXZvcml0ZSk7XG5cbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuICBsaS5hcHBlbmQoYWRkcmVzcyk7XG5cbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgbGkuYXBwZW5kKG1vcmUpXG5cbiAgcmV0dXJuIGxpXG59XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXG4gICAgfSk7XG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgfSk7XG59Il19
