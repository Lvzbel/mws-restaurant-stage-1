async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t){let e=await idb.open("reviews-db",1,t=>t.createObjectStore("reviews",{keyPath:"id"})),a=e.transaction("reviews","readwrite"),r=a.objectStore("reviews");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function getAllReviews(){let t=await idb.open("reviews-db",1),e=t.transaction("reviews","readonly").objectStore("reviews"),a=await e.getAll();return t.close(),a}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),s=r.objectStore("restaurants");s.get(t).then(t=>{t.is_favorite=e,s.put(t)}),await r.complete,a.close()}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get REVIEWDATA_URL(){return"http://localhost:1337/reviews"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();await storeRestaurantsDb(e);const a=await fetch(`${DBHelper.REVIEWDATA_URL}`);if(200!==a.status)throw new Error("Request of reviews has failed");{const t=await a.json();await storeAllReviews(t)}return e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,n=t.selectedIndex,o=e[s].value,r=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,r).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),s=DBHelper.imageUrlForRestaurant_responsive(e),n=document.createElement("figure"),o=document.createElement("picture"),r=document.createElement("source"),a=document.createElement("source"),i=document.createElement("img"),c=document.createElement("figcaption");r.setAttribute("media","(min-width: 501px)"),r.setAttribute("srcset",`${s}_large_2x.jpg 2x, ${s}_large_1x.jpg`),a.setAttribute("media","(max-width: 500px)"),a.setAttribute("srcset",`${s}_small_2x.jpg 2x, ${s}_small_1x.jpg`),i.className="restaurant-img",i.src=DBHelper.imageUrlForRestaurant(e),i.setAttribute("alt",e.name),c.textContent=e.name,n.append(o),n.append(c),o.append(r),o.append(a),o.append(i),t.append(n);const l=document.createElement("h1");l.innerHTML=e.name,t.append(l);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),"true"===e.is_favorite|!0===e.is_favorite?(d.classList.add("yesFav"),console.log(`Status for ${e.id} is true ad type is ${typeof e.is_favorite}`)):"false"===e.is_favorite|!1===e.is_favorite&&(d.classList.remove("yesFav"),console.log(`Status for ${e.id} is false ad type is ${typeof e.is_favorite}`)),d.onclick=(()=>{d.classList.toggle("yesFav");const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,console.log(e.is_favorite)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const p=document.createElement("p");p.innerHTML=e.address,t.append(p);const m=document.createElement("a");return m.innerHTML="View Details",m.href=DBHelper.urlForRestaurant(e),t.append(m),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwicmV2aWV3IiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmV2aWV3cyIsInVwZGF0ZUZhdm9yaXRlU3RhdHVzIiwicmVzdGF1cmFudElkIiwiZmF2b3JpdGVTdGF0dXMiLCJmZXRjaCIsIm1ldGhvZCIsImdldCIsInRoZW4iLCJyZXN0dXJhbnQiLCJpc19mYXZvcml0ZSIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiUkVWSUVXREFUQV9VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJyZXN0YXVyYW50UmVzcG9uc2UiLCJzdGF0dXMiLCJqc29uIiwicmV2aWV3UmVzcG9uc2UiLCJFcnJvciIsImlkIiwiZmV0Y2hSZXN0YXVyYW50cyIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVyciIsImZpbmQiLCJyIiwibmVpZ2hib3Job29kIiwiZmlsdGVyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmRlZmluZWQiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwic2NvcGUiLCJyZWdpc3RyYXRpb24iLCJlIiwiZXJyb3IiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJyZXN1dGxzIiwiZmlsbEN1aXNpbmVzSFRNTCIsIndpbmRvdyIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibSIsInNldE1hcCIsInVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlSUQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZSIsImZpZ3VyZSIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsInNvdXJjZVNtYWxsIiwiaW1hZ2UiLCJmaWdDYXB0aW9uIiwic2V0QXR0cmlidXRlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwidGV4dENvbnRlbnQiLCJpc0Zhdm9yaXRlIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwib25jbGljayIsInRvZ2dsZSIsImN1cnJlbnRGYXZTdGF0dXMiLCJKU09OIiwicGFyc2UiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBN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IjoicmVzdGF1cmFudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgIC8qKlxuICAgKiBDcmVhdGUgcmVzdGF1cmFudHMgSW5kZXhlZERCXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcbiAgICAgIGtleVBhdGg6ICdpZCdcbiAgICB9KSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxuICAgIGRiLmNsb3NlKClcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBhbGwgcmV2aWV3cyBpbiBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jldmlld3MtZGInLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJylcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpXG5cbiAgICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICAgIHN0b3JlLnB1dChyZXZpZXcpXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxuICAgIGRiLmNsb3NlKClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaXZlIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmVzdGF1cmFudHMoKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAgIGRiLmNsb3NlKClcblxuICAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgYWxsIHJlc3RhdXJhbnRzIGluIEluZGV4ZWREQi5cbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cykge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgLy8gYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmVzdGF1cmFudHMoKSB7XG4gIC8vICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSlcblxuICAvLyAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXG4gIC8vICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAvLyAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAvLyAgIGRiLmNsb3NlKClcblxuICAvLyAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIC8vIH1cblxuICAvKipcbiAgICogUmV0cml2ZSBhbGwgcmV2aWV3cyBmcm9tIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmV2aWV3cygpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmV2aWV3cy1kYicsIDEpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKVxuXG4gICAgbGV0IGFsbFNhdmVkSXRlbXMgPSBhd2FpdCBzdG9yZS5nZXRBbGwoKVxuXG4gICAgZGIuY2xvc2UoKVxuXG4gICAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgRmF2b3JpdGUgU3RhdHVzIGluIGEgcmVzdGF1cmFudFxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlRmF2b3JpdGVTdGF0dXMocmVzdGF1cmFudElkLCBmYXZvcml0ZVN0YXR1cykge1xuICAgIGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50SWR9Lz9pc19mYXZvcml0ZT0ke2Zhdm9yaXRlU3RhdHVzfWAsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCdcbiAgICB9KTtcblxuICAgIGNvbnN0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcblxuICAgIHN0b3JlLmdldChyZXN0YXVyYW50SWQpXG4gICAgICAudGhlbihyZXN0dXJhbnQgPT4ge1xuICAgICAgICByZXN0dXJhbnQuaXNfZmF2b3JpdGUgPSBmYXZvcml0ZVN0YXR1cztcbiAgICAgICAgc3RvcmUucHV0KHJlc3R1cmFudCk7XG4gICAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlO1xuICAgIGRiLmNsb3NlKCk7XG4gIH1cblxuXG4gIGNsYXNzIERCSGVscGVyIHtcblxuICAgIC8qKlxuICAgICAqIERhdGFiYXNlIFVSTC5cbiAgICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAgICovXG4gICAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gICAgfVxuXG4gICAgc3RhdGljIGdldCBSRVZJRVdEQVRBX1VSTCgpIHtcbiAgICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jldmlld3NgO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudHMoKSB7XG4gICAgICAvLyBGZXRjaCByZXN0dXJhbnRzIGRhdGEgYmFzZVxuICAgICAgY29uc3QgcmVzdGF1cmFudFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfWApXG5cbiAgICAgIGlmIChyZXN0YXVyYW50UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCByZXN0YXVyYW50UmVzcG9uc2UuanNvbigpXG4gICAgICAgIC8vIHN0b3JlIHJlc3RhdXJhbnQgZGF0YSBiYXNlIGludG8gSW5kZXhlZERCXG4gICAgICAgIGF3YWl0IHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cylcbiAgICAgICAgLy8gZmV0Y2ggYW5kIHN0b3JlIGFsbCByZXZpZXdzXG4gICAgICAgIGNvbnN0IHJldmlld1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7REJIZWxwZXIuUkVWSUVXREFUQV9VUkx9YClcblxuICAgICAgICBpZiAocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICBjb25zdCByZXZpZXdzID0gYXdhaXQgcmV2aWV3UmVzcG9uc2UuanNvbigpXG4gICAgICAgICAgYXdhaXQgc3RvcmVBbGxSZXZpZXdzKHJldmlld3MpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IG9mIHJldmlld3MgaGFzIGZhaWxlZCcpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb2YgcmVzdGF1cmFudHMgaGFzIGZhaWxlZCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQpIHtcblxuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpXG4gICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpXG4gICAgICBpZiAocmVzdGF1cmFudCkge1xuICAgICAgICByZXR1cm4gcmVzdGF1cmFudFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCkge1xuXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIHJldHVybiByZXN1bHRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laWdib3Job29kIGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0c1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50cyB3aXRoIGN1aXNpbmUgYW5kIG5laWdoYm9yaG9vZCBjb25iaW5hdGlvbiBkb2VzIG5vdCBleGlzdCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcblxuICAgICAgICByZXR1cm4gdW5pcXVlTmVpZ2hib3Job29kc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgYXQgZmV0Y2hpbmcgYWxsIG5laWdoYm9yaG9vZHMnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hDdWlzaW5lcygpIHtcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcblxuICAgICAgICByZXR1cm4gdW5pcXVlQ3Vpc2luZXNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGF0IGZldGNoaW5nIGFsbCBjdWlzaW5lJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgICAqL1xuICAgIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cbiAgICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XG4gICAgICovXG4gICAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICBjb25zdCBwaG90byA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblxuICAgICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIChgL2ltZy9lcnJvci5qcGdgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3BvbnNpdmUgaW1hZ2Ugb25seSBnZXRzIHRoZSBuYW1lIG9mIHRoZSBwaWN0dXJlIGJ5IGlkIHdpaG91dCBnZXR0aW5nIHRoZSBleHRlbnNpb24sIGV4dGVuc2lvbiB3aWxsIGJlIGFkZGVkIGluIGxhdGVyXG4gICAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxuICAgICAqL1xuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KSB7XG5cbiAgICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXG4gICAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gKGBpbWcvcmVzcG9uc2l2ZV9pbWcvZXJyb3JgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy8ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxuICAgICAqL1xuICAgIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuICAgICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbWFya2VyO1xuICAgIH1cbiAgfVxuXG4gIC8vIGFzeW5jICgpID0+IHtcbiAgLy8gTWFrZXMgaW5pdGlhbCBmZXRjaCByZXF1ZXN0IGFuZCBzYXZlcyBpdCBpbnRvIEluZGV4ZWREQlxuICAvLyAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT57XG4gIC8vICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgLy8gICB9KS5jYXRjaCgoZXJyKSA9PntcbiAgLy8gICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gIC8vICAgfSlcbiAgLy8gfSIsImxldCByZXN0YXVyYW50cyxcbiAgbmVpZ2hib3Job29kcyxcbiAgY3Vpc2luZXNcbnZhciBtYXBcbnZhciBtYXJrZXJzID0gW11cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ2hlY2tpbmcgaWYgU2VydmljZSBXb3JrZXIgaXMgYXZhaWJsZVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcuL3NlcnZpY2Utd29ya2VyLmpzJywge1xuICAgICAgc2NvcGU6ICcuLydcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uIChyZWdpc3RyYXRpb24pIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIFJlZ2lzdGVyJyk7XG4gICAgfSlcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgIH0pXG59IGVsc2Uge1xuICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBub3Qgc3VwcG9ydGVkLicpO1xufVxuXG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXN5bmMgKGV2ZW50KSA9PiB7XG4gIGF3YWl0IGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgLy8gRE9ORVxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMobmVpZ2hib3Job29kcylcbiAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gcmVzdWx0cztcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbn1cblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaEN1aXNpbmVzID0gKGN1aXNpbmVzKSA9PiB7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcyhjdWlzaW5lcylcbiAgICAudGhlbigocmVzdXRscykgPT4ge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IHJlc3V0bHM7XG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgbGV0IGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDFcbiAgfTtcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICB9KTtcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn1cblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcbiAgLy8gRE9ORVxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKVxuICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdWx0cyk7XG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XG4gIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xuICB9KVxufVxuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuICBzZWxmLm1hcmtlcnMgPSBbXTtcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuICB9KTtcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgY29uc3QgaW1hZ2VJRCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpO1xuICBjb25zdCBmaWd1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKTtcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcbiAgY29uc3Qgc291cmNlTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3Qgc291cmNlU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgY29uc3QgZmlnQ2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ2NhcHRpb24nKTtcblxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtaW4td2lkdGg6IDUwMXB4KScpO1xuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGAke2ltYWdlSUR9X2xhcmdlXzJ4LmpwZyAyeCwgJHtpbWFnZUlEfV9sYXJnZV8xeC5qcGdgKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOiA1MDBweCknKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZUlEfV9zbWFsbF8yeC5qcGcgMngsICR7aW1hZ2VJRH1fc21hbGxfMXguanBnYCk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHJlc3RhdXJhbnQubmFtZSlcbiAgZmlnQ2FwdGlvbi50ZXh0Q29udGVudCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgZmlndXJlLmFwcGVuZChwaWN0dXJlKTtcbiAgZmlndXJlLmFwcGVuZChmaWdDYXB0aW9uKVxuICBwaWN0dXJlLmFwcGVuZChzb3VyY2VMYXJnZSk7XG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZVNtYWxsKTtcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xuICBsaS5hcHBlbmQoZmlndXJlKTtcblxuXG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBsaS5hcHBlbmQobmFtZSk7XG5cbiAgY29uc3QgaXNGYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBpc0Zhdm9yaXRlLmlubmVySFRNTCA9ICcmaGVhcnRzOyc7XG4gIGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgnaXNGYXZvcml0ZScpXG4gIC8vIFNldCBzdHlsZXMgZGVwZW5kaW5nIGlmIGlzIGZhdm9yaXRlIG9yIG5vdFxuICBpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ3RydWUnIHwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gdHJ1ZSkge1xuICAgIGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgneWVzRmF2JylcbiAgICBjb25zb2xlLmxvZyhgU3RhdHVzIGZvciAke3Jlc3RhdXJhbnQuaWR9IGlzIHRydWUgYWQgdHlwZSBpcyAke3R5cGVvZihyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKX1gKTtcbiAgfSBlbHNlIGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICdmYWxzZScgfCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSBmYWxzZSkge1xuICAgIGlzRmF2b3JpdGUuY2xhc3NMaXN0LnJlbW92ZSgneWVzRmF2JylcbiAgICBjb25zb2xlLmxvZyhgU3RhdHVzIGZvciAke3Jlc3RhdXJhbnQuaWR9IGlzIGZhbHNlIGFkIHR5cGUgaXMgJHt0eXBlb2YocmVzdGF1cmFudC5pc19mYXZvcml0ZSl9YCk7XG4gIH1cblxuICAvLyBVcGRhdGluZyBkYXRhIGJhc2UgYmFzZSBvbiBmYXZvcml0ZSBzdGF0dXNcbiAgaXNGYXZvcml0ZS5vbmNsaWNrID0gKCkgPT4ge1xuICAgIGlzRmF2b3JpdGUuY2xhc3NMaXN0LnRvZ2dsZSgneWVzRmF2JylcbiAgICBjb25zdCBjdXJyZW50RmF2U3RhdHVzID0gIUpTT04ucGFyc2UocmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gICAgY29uc29sZS5sb2coY3VycmVudEZhdlN0YXR1cyk7XG4gICAgdXBkYXRlRmF2b3JpdGVTdGF0dXMocmVzdGF1cmFudC5pZCwgY3VycmVudEZhdlN0YXR1cyk7XG4gICAgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9IGN1cnJlbnRGYXZTdGF0dXNcbiAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgfVxuICBsaS5hcHBlbmQoaXNGYXZvcml0ZSk7XG5cbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuZWlnaGJvcmhvb2QuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uZWlnaGJvcmhvb2Q7XG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuICBsaS5hcHBlbmQoYWRkcmVzcyk7XG5cbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgbGkuYXBwZW5kKG1vcmUpXG5cbiAgcmV0dXJuIGxpXG59XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXG4gICAgfSk7XG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgfSk7XG59Il19
