async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t,e){let a=await idb.open(`reviews-db-id:${e}`,1,t=>t.createObjectStore(`reviews-id:${e}`,{keyPath:"id"})),r=a.transaction(`reviews-id:${e}`,"readwrite"),s=r.objectStore(`reviews-id:${e}`);t.forEach(t=>{s.put(t)}),await r.complete,a.close()}async function getReviewsByRestaurantId(t){let e=await idb.open(`reviews-db-id:${t}`,1),a=e.transaction(`reviews-id:${t}`,"readonly").objectStore(`reviews-id:${t}`),r=await a.getAll();return e.close(),r}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function postReview(t){await fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),s=r.objectStore("restaurants");s.get(t).then(t=>{t.is_favorite=e,s.put(t)}),await r.complete,a.close()}async function fetchReviewsById(t){let e=await fetch(`http://localhost:1337/reviews/?restaurant_id=${t}`);if(200===e.status){const a=await e.json();return await storeAllReviews(a,t),a}throw new Error("Resquest of reviews has failed")}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,n=t.selectedIndex,o=e[s].value,r=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,r).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),s=DBHelper.imageUrlForRestaurant_responsive(e),n=document.createElement("figure"),o=document.createElement("picture"),r=document.createElement("source"),a=document.createElement("source"),i=document.createElement("img"),c=document.createElement("figcaption");r.setAttribute("media","(min-width: 501px)"),r.setAttribute("srcset",`${s}_large_2x.jpg 2x, ${s}_large_1x.jpg`),a.setAttribute("media","(max-width: 500px)"),a.setAttribute("srcset",`${s}_small_2x.jpg 2x, ${s}_small_1x.jpg`),i.className="restaurant-img",i.src=DBHelper.imageUrlForRestaurant(e),i.setAttribute("alt",e.name),c.textContent=e.name,n.append(o),n.append(c),o.append(r),o.append(a),o.append(i),t.append(n);const l=document.createElement("h1");l.innerHTML=e.name,t.append(l);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),"true"===e.is_favorite|!0===e.is_favorite?(d.classList.add("yesFav"),console.log(`Status for ${e.id} is true ad type is ${typeof e.is_favorite}`)):"false"===e.is_favorite|!1===e.is_favorite&&(d.classList.remove("yesFav"),console.log(`Status for ${e.id} is false ad type is ${typeof e.is_favorite}`)),d.onclick=(()=>{d.classList.toggle("yesFav");const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,console.log(e.is_favorite)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const p=document.createElement("p");p.innerHTML=e.address,t.append(p);const m=document.createElement("a");return m.innerHTML="View Details",m.href=DBHelper.urlForRestaurant(e),t.append(m),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwiaWQiLCJyZXZpZXciLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJwb3N0UmV2aWV3IiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJDb250ZW50LVR5cGUiLCJ1cGRhdGVGYXZvcml0ZVN0YXR1cyIsInJlc3RhdXJhbnRJZCIsImZhdm9yaXRlU3RhdHVzIiwiZ2V0IiwidGhlbiIsInJlc3R1cmFudCIsImlzX2Zhdm9yaXRlIiwiZmV0Y2hSZXZpZXdzQnlJZCIsInJldmlld1Jlc3BvbnNlIiwic3RhdHVzIiwianNvbiIsIkVycm9yIiwiREJIZWxwZXIiLCJEQVRBQkFTRV9VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJyZXN0YXVyYW50UmVzcG9uc2UiLCJmZXRjaFJlc3RhdXJhbnRzIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwiZmluZCIsInIiLCJuZWlnaGJvcmhvb2QiLCJmaWx0ZXIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuZGVmaW5lZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzY29wZSIsInJlZ2lzdHJhdGlvbiIsImUiLCJlcnJvciIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsInJlc3V0bHMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiaW1hZ2VJRCIsImltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlIiwiZmlndXJlIiwicGljdHVyZSIsInNvdXJjZUxhcmdlIiwic291cmNlU21hbGwiLCJpbWFnZSIsImZpZ0NhcHRpb24iLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJ0ZXh0Q29udGVudCIsImlzRmF2b3JpdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJvbmNsaWNrIiwidG9nZ2xlIiwiY3VycmVudEZhdlN0YXR1cyIsInBhcnNlIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJwdXNoIl0sIm1hcHBpbmdzIjoiQUFHRUEsZUFBZUMsbUJBQW1CQyxHQUNoQyxJQUFJQyxRQUFXQyxJQUFJQyxLQUFLLGlCQUFrQixFQUFHQyxHQUFhQSxFQUFVQyxrQkFBa0IsY0FBZSxDQUNuR0MsUUFBUyxRQUdQQyxFQUFLTixFQUFHTyxZQUFZLGNBQWUsYUFDbkNDLEVBQVFGLEVBQUdHLFlBQVksZUFFM0JWLEVBQVlXLFFBQVFDLElBQ2xCSCxFQUFNSSxJQUFJRCxXQUdOTCxFQUFHTyxTQUNUYixFQUFHYyxRQU1MakIsZUFBZWtCLGdCQUFnQkMsRUFBU0MsR0FDdEMsSUFBSWpCLFFBQVdDLElBQUlDLHNCQUFzQmUsSUFBTSxFQUFHZCxHQUFhQSxFQUFVQyxnQ0FBZ0NhLElBQU0sQ0FDN0daLFFBQVMsUUFHUEMsRUFBS04sRUFBR08sMEJBQTBCVSxJQUFNLGFBQ3hDVCxFQUFRRixFQUFHRywwQkFBMEJRLEtBQ3pDRCxFQUFRTixRQUFRUSxJQUNkVixFQUFNSSxJQUFJTSxXQUdOWixFQUFHTyxTQUNUYixFQUFHYyxRQUdMakIsZUFBZXNCLHlCQUF5QkYsR0FDdEMsSUFBSWpCLFFBQVdDLElBQUlDLHNCQUFzQmUsSUFBTSxHQUczQ1QsRUFES1IsRUFBR08sMEJBQTBCVSxJQUFNLFlBQzdCUiwwQkFBMEJRLEtBRXJDRyxRQUFzQlosRUFBTWEsU0FJaEMsT0FGQXJCLEVBQUdjLFFBRUlNLEVBTVR2QixlQUFleUIsb0JBQ2IsSUFBSXRCLFFBQVdDLElBQUlDLEtBQUssaUJBQWtCLEdBR3RDTSxFQURLUixFQUFHTyxZQUFZLGNBQWUsWUFDeEJFLFlBQVksZUFFdkJXLFFBQXNCWixFQUFNYSxTQUloQyxPQUZBckIsRUFBR2MsUUFFSU0sRUFNVHZCLGVBQWVDLG1CQUFtQkMsR0FDaEMsSUFBSUMsUUFB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LEdBRUh2QixJQU1URCxnQkFBa0IsRUFBQzdILEVBQWM2RixLQUFLN0YsZUFDcENBLEVBQVlXLFFBQVFDLElBRWxCLE1BQU0ySSxFQUFTM0csU0FBUzRHLHVCQUF1QjVJLEVBQVlpRixLQUFLaEMsS0FDaEVPLE9BQU9DLEtBQUtxQixNQUFNK0QsWUFBWUYsRUFBUSxRQUFTLEtBQzdDL0MsT0FBT2tELFNBQVNKLEtBQU9DLEVBQU81RSxNQUVoQ2tCLEtBQUtiLFFBQVEyRSxLQUFLSiIsImZpbGUiOiJyZXN0YXVyYW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiAgLyoqXG4gICAqIENyZWF0ZSByZXN0YXVyYW50cyBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cykge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIHJldmlld3MgYnkgcmVzdGF1cmFudCBpZCBpbiBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZCkge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKGByZXZpZXdzLWRiLWlkOiR7aWR9YCwgMSwgdXBncmFkZURCID0+IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShgcmV2aWV3cy1pZDoke2lkfWAsIHtcbiAgICAgIGtleVBhdGg6ICdpZCdcbiAgICB9KSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKGByZXZpZXdzLWlkOiR7aWR9YCwgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxuICAgIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgICAgc3RvcmUucHV0KHJldmlldylcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0UmV2aWV3c0J5UmVzdGF1cmFudElkKGlkKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oYHJldmlld3MtZGItaWQ6JHtpZH1gLCAxKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3MtaWQ6JHtpZH1gLCAncmVhZG9ubHknKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKGByZXZpZXdzLWlkOiR7aWR9YClcblxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAgIGRiLmNsb3NlKClcblxuICAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIH1cblxuICAvKipcbiAgICogUmV0cml2ZSBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIGdldEFsbFJlc3RhdXJhbnRzKCkge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZG9ubHknKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgICBsZXQgYWxsU2F2ZWRJdGVtcyA9IGF3YWl0IHN0b3JlLmdldEFsbCgpXG5cbiAgICBkYi5jbG9zZSgpXG5cbiAgICByZXR1cm4gYWxsU2F2ZWRJdGVtc1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGFsbCByZXN0YXVyYW50cyBpbiBJbmRleGVkREIuXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcbiAgICAgIGtleVBhdGg6ICdpZCdcbiAgICB9KSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxuICAgIGRiLmNsb3NlKClcbiAgfVxuXG4gIC8qKlxuICAgKiBQT1NUIG5ldyByZXZpZXdcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHBvc3RSZXZpZXcocmV2aWV3KSB7XG4gICAgYXdhaXQgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICAvKipcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlU3RhdHVzKHJlc3RhdXJhbnRJZCwgZmF2b3JpdGVTdGF0dXMpIHtcbiAgICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudElkfS8/aXNfZmF2b3JpdGU9JHtmYXZvcml0ZVN0YXR1c31gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpO1xuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG5cbiAgICBzdG9yZS5nZXQocmVzdGF1cmFudElkKVxuICAgICAgLnRoZW4ocmVzdHVyYW50ID0+IHtcbiAgICAgICAgcmVzdHVyYW50LmlzX2Zhdm9yaXRlID0gZmF2b3JpdGVTdGF0dXM7XG4gICAgICAgIHN0b3JlLnB1dChyZXN0dXJhbnQpO1xuICAgICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZTtcbiAgICBkYi5jbG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaFJldmlld3NCeUlkIChpZCkge1xuICAgIGxldCByZXZpZXdSZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke2lkfWApXG4gICAgaWYocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcbiAgICAgIGF3YWl0IHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZClcbiAgICAgIHJldHVybiByZXZpZXdzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVzcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcbiAgICB9XG4gIH1cblxuICBjbGFzcyBEQkhlbHBlciB7XG5cbiAgICAvKipcbiAgICAgKiBEYXRhYmFzZSBVUkwuXG4gICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xuICAgICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuICAgICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50cygpIHtcbiAgICAgIC8vIEZldGNoIHJlc3R1cmFudHMgZGF0YSBiYXNlXG4gICAgICBjb25zdCByZXN0YXVyYW50UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9YClcblxuICAgICAgaWYgKHJlc3RhdXJhbnRSZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IHJlc3RhdXJhbnRSZXNwb25zZS5qc29uKClcbiAgICAgICAgLy8gc3RvcmUgcmVzdGF1cmFudCBkYXRhIGJhc2UgaW50byBJbmRleGVkREJcbiAgICAgICAgYXdhaXQgc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKVxuICAgICAgICAvLyAvLyBmZXRjaCBhbmQgc3RvcmUgYWxsIHJldmlld3NcbiAgICAgICAgLy8gY29uc3QgcmV2aWV3UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5SRVZJRVdEQVRBX1VSTH1gKVxuXG4gICAgICAgIC8vIGlmIChyZXZpZXdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAvLyAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcbiAgICAgICAgLy8gICBhd2FpdCBzdG9yZUFsbFJldmlld3MocmV2aWV3cylcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgLy8gICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcbiAgICAgICAgLy8gfVxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBvZiByZXN0YXVyYW50cyBoYXMgZmFpbGVkJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xuXG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKClcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcbiAgICAgIGlmIChyZXN0YXVyYW50KSB7XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XG5cbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTmVpZ2Jvcmhvb2QgZG9lcyBub3QgZXhpc3QnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3RhdXJhbnRzIHdpdGggY3Vpc2luZSBhbmQgbmVpZ2hib3Job29kIGNvbmJpbmF0aW9uIGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoTmVpZ2hib3Job29kcygpIHtcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxuXG4gICAgICAgIHJldHVybiB1bmlxdWVOZWlnaGJvcmhvb2RzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgbmVpZ2hib3Job29kcycpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaEN1aXNpbmVzKCkge1xuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxuXG4gICAgICAgIHJldHVybiB1bmlxdWVDdWlzaW5lc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgYXQgZmV0Y2hpbmcgYWxsIGN1aXNpbmUnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAgICovXG4gICAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgICAqIEVycm9yIGNoZWNraW5nIGR1ZSB0byByZXN0YXVyYW50ICMxMCBkb2VzIG5vdCBoYXZlIGEgcGhvdG8gcHJvcGVydHlcbiAgICAgKi9cbiAgICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXG4gICAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gKGAvaW1nL2Vycm9yLmpwZ2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzcG9uc2l2ZSBpbWFnZSBvbmx5IGdldHMgdGhlIG5hbWUgb2YgdGhlIHBpY3R1cmUgYnkgaWQgd2lob3V0IGdldHRpbmcgdGhlIGV4dGVuc2lvbiwgZXh0ZW5zaW9uIHdpbGwgYmUgYWRkZWQgaW4gbGF0ZXJcbiAgICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XG4gICAgICovXG4gICAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpIHtcblxuICAgICAgY29uc3QgcGhvdG8gPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cbiAgICAgIGlmIChwaG90byA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy9lcnJvcmApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChgaW1nL3Jlc3BvbnNpdmVfaW1nLyR7cmVzdGF1cmFudC5pZH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAgICovXG4gICAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG4gICAgICAgIG1hcDogbWFwLFxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtYXJrZXI7XG4gICAgfVxuICB9IiwibGV0IHJlc3RhdXJhbnRzLFxuICBuZWlnaGJvcmhvb2RzLFxuICBjdWlzaW5lc1xudmFyIG1hcFxudmFyIG1hcmtlcnMgPSBbXVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDaGVja2luZyBpZiBTZXJ2aWNlIFdvcmtlciBpcyBhdmFpYmxlXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy4vc2VydmljZS13b3JrZXIuanMnLCB7XG4gICAgICBzY29wZTogJy4vJ1xuICAgIH0pXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJhdGlvbikge1xuICAgICAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgUmVnaXN0ZXInKTtcbiAgICB9KVxuICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xuICAgICAgY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgfSlcbn0gZWxzZSB7XG4gIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIG5vdCBzdXBwb3J0ZWQuJyk7XG59XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgYXdhaXQgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcyhuZWlnaGJvcmhvb2RzKVxuICAgIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSByZXN1bHRzO1xuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoQ3Vpc2luZXMgPSAoY3Vpc2luZXMpID0+IHtcbiAgLy8gRE9ORVxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKGN1aXNpbmVzKVxuICAgIC50aGVuKChyZXN1dGxzKSA9PiB7XG4gICAgICBzZWxmLmN1aXNpbmVzID0gcmVzdXRscztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG59XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cbmZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcblxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBsZXQgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpXG4gIC50aGVuKChyZXN1bHRzKSA9PiB7XG4gICAgcmVzZXRSZXN0YXVyYW50cyhyZXN1bHRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pXG59XG5cbi8qKlxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxuICovXG5yZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHVsLmlubmVySFRNTCA9ICcnO1xuXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XG4gIH0pO1xuICBhZGRNYXJrZXJzVG9NYXAoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICBjb25zdCBpbWFnZUlEID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUocmVzdGF1cmFudCk7XG4gIGNvbnN0IGZpZ3VyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ3VyZScpO1xuICBjb25zdCBwaWN0dXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncGljdHVyZScpO1xuICBjb25zdCBzb3VyY2VMYXJnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBjb25zdCBzb3VyY2VTbWFsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBjb25zdCBmaWdDYXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlnY2FwdGlvbicpO1xuXG4gIHNvdXJjZUxhcmdlLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1pbi13aWR0aDogNTAxcHgpJyk7XG4gIHNvdXJjZUxhcmdlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7aW1hZ2VJRH1fbGFyZ2VfMnguanBnIDJ4LCAke2ltYWdlSUR9X2xhcmdlXzF4LmpwZ2ApO1xuICBzb3VyY2VTbWFsbC5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtYXgtd2lkdGg6IDUwMHB4KScpO1xuICBzb3VyY2VTbWFsbC5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIGAke2ltYWdlSUR9X3NtYWxsXzJ4LmpwZyAyeCwgJHtpbWFnZUlEfV9zbWFsbF8xeC5qcGdgKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgcmVzdGF1cmFudC5uYW1lKVxuICBmaWdDYXB0aW9uLnRleHRDb250ZW50ID0gcmVzdGF1cmFudC5uYW1lO1xuICBmaWd1cmUuYXBwZW5kKHBpY3R1cmUpO1xuICBmaWd1cmUuYXBwZW5kKGZpZ0NhcHRpb24pXG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZUxhcmdlKTtcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlU21hbGwpO1xuICBwaWN0dXJlLmFwcGVuZChpbWFnZSk7XG4gIGxpLmFwcGVuZChmaWd1cmUpO1xuXG5cblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGxpLmFwcGVuZChuYW1lKTtcblxuICBjb25zdCBpc0Zhdm9yaXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGlzRmF2b3JpdGUuaW5uZXJIVE1MID0gJyZoZWFydHM7JztcbiAgaXNGYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdpc0Zhdm9yaXRlJylcbiAgLy8gU2V0IHN0eWxlcyBkZXBlbmRpbmcgaWYgaXMgZmF2b3JpdGUgb3Igbm90XG4gIGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndHJ1ZScgfCByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSB0cnVlKSB7XG4gICAgaXNGYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCd5ZXNGYXYnKVxuICAgIGNvbnNvbGUubG9nKGBTdGF0dXMgZm9yICR7cmVzdGF1cmFudC5pZH0gaXMgdHJ1ZSBhZCB0eXBlIGlzICR7dHlwZW9mKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpfWApO1xuICB9IGVsc2UgaWYocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gJ2ZhbHNlJyB8IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IGZhbHNlKSB7XG4gICAgaXNGYXZvcml0ZS5jbGFzc0xpc3QucmVtb3ZlKCd5ZXNGYXYnKVxuICAgIGNvbnNvbGUubG9nKGBTdGF0dXMgZm9yICR7cmVzdGF1cmFudC5pZH0gaXMgZmFsc2UgYWQgdHlwZSBpcyAke3R5cGVvZihyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKX1gKTtcbiAgfVxuXG4gIC8vIFVwZGF0aW5nIGRhdGEgYmFzZSBiYXNlIG9uIGZhdm9yaXRlIHN0YXR1c1xuICBpc0Zhdm9yaXRlLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgaXNGYXZvcml0ZS5jbGFzc0xpc3QudG9nZ2xlKCd5ZXNGYXYnKVxuICAgIGNvbnN0IGN1cnJlbnRGYXZTdGF0dXMgPSAhSlNPTi5wYXJzZShyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgICBjb25zb2xlLmxvZyhjdXJyZW50RmF2U3RhdHVzKTtcbiAgICB1cGRhdGVGYXZvcml0ZVN0YXR1cyhyZXN0YXVyYW50LmlkLCBjdXJyZW50RmF2U3RhdHVzKTtcbiAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gY3VycmVudEZhdlN0YXR1c1xuICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpO1xuICB9XG4gIGxpLmFwcGVuZChpc0Zhdm9yaXRlKTtcblxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcblxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBsaS5hcHBlbmQobW9yZSlcblxuICByZXR1cm4gbGlcbn1cblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcbiAgICB9KTtcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICB9KTtcbn0iXX0=
