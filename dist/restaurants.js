async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t,e){let a=await idb.open(`reviews-db-id:${e}`,1,t=>t.createObjectStore(`reviews-id:${e}`,{keyPath:"id"})),r=a.transaction(`reviews-id:${e}`,"readwrite"),n=r.objectStore(`reviews-id:${e}`);t.forEach(t=>{n.put(t)}),await r.complete,a.close()}async function getReviewsByRestaurantId(t){let e=await idb.open(`reviews-db-id:${t}`,1),a=e.transaction(`reviews-id:${t}`,"readonly").objectStore(`reviews-id:${t}`),r=await a.getAll();return e.close(),r}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function postReview(t){await fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})})}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");n.get(t).then(t=>{t.is_favorite=e,n.put(t)}),await r.complete,a.close()}async function fetchReviewsById(t){let e=await fetch(`http://localhost:1337/reviews/?restaurant_id=${t}`);if(200===e.status){const a=await e.json();return await storeAllReviews(a,t),a}throw new Error("Resquest of reviews has failed")}const toggleFavClassAndElement=(t,e)=>{"true"===t|!0===t?(e.classList.add("yesFav"),e.setAttribute("aria-label","remove as favorite")):(e.classList.remove("yesFav"),e.setAttribute("aria-label","remove as favorite"))};class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static async sendOfflineData(t){localStorage.setItem("data",JSON.stringify(t));const e=document.getElementById("reviews-list"),a=document.createElement("li"),r=document.createElement("p");r.innerHTML=t.name,a.appendChild(r);const n=document.createElement("p");n.innerHTML=(new Date).toDateString(),a.appendChild(n);const s=document.createElement("p");s.innerHTML=`Rating: ${t.rating}`,a.appendChild(s);const o=document.createElement("p");o.innerHTML=t.comments,a.appendChild(o),e.appendChild(a);const i=document.getElementById("offline-alert");i.style.display="block",window.addEventListener("online",t=>{postReview(JSON.parse(localStorage.getItem("data"))),i.style.display="none",localStorage.removeItem("data")})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,s=t.selectedIndex,a=e[n].value,r=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,r).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant_responsive(e),s=document.createElement("figure"),a=document.createElement("picture"),r=document.createElement("source"),o=document.createElement("source"),l=document.createElement("img"),c=document.createElement("figcaption");r.setAttribute("class","lazyload"),r.setAttribute("media","(min-width: 501px)"),r.setAttribute("data-srcset",`${n}_large_2x.jpg 2x, ${n}_large_1x.jpg`),o.setAttribute("class","lazyload"),o.setAttribute("media","(max-width: 500px)"),o.setAttribute("data-srcset",`${n}_small_2x.jpg 2x, ${n}_small_1x.jpg`),l.className="restaurant-img lazyload",l.setAttribute("data-src",`${DBHelper.imageUrlForRestaurant(e)}`),l.setAttribute("alt",e.name),c.textContent=e.name,s.append(a),s.append(c),a.append(r),a.append(o),a.append(l),t.append(s);const i=document.createElement("h1");i.innerHTML=e.name,t.append(i);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),toggleFavClassAndElement(e.is_favorite,d),d.onclick=(()=>{const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,toggleFavClassAndElement(e.is_favorite,d)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const m=document.createElement("p");m.innerHTML=e.address,t.append(m);const p=document.createElement("a");return p.innerHTML="View Details",p.href=DBHelper.urlForRestaurant(e),t.append(p),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwiaWQiLCJyZXZpZXciLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJwb3N0UmV2aWV3IiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwidXBkYXRlRmF2b3JpdGVTdGF0dXMiLCJyZXN0YXVyYW50SWQiLCJmYXZvcml0ZVN0YXR1cyIsImdldCIsInRoZW4iLCJyZXN0dXJhbnQiLCJpc19mYXZvcml0ZSIsImZldGNoUmV2aWV3c0J5SWQiLCJyZXZpZXdSZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJFcnJvciIsInRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudCIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmUiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsInJlc3RhdXJhbnRSZXNwb25zZSIsImZldGNoUmVzdGF1cmFudHMiLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJlcnIiLCJmaW5kIiwiciIsIm5laWdoYm9yaG9vZCIsImZpbHRlciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5kZWZpbmVkIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInVsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxpIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiZGF0ZSIsIkRhdGUiLCJ0b0RhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsIm9mZmxpbmVBbGVydCIsInN0eWxlIiwiZGlzcGxheSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInBhcnNlIiwiZ2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwic2NvcGUiLCJyZWdpc3RyYXRpb24iLCJlIiwiZXJyb3IiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsInNlbGVjdCIsIm9wdGlvbiIsInZhbHVlIiwiYXBwZW5kIiwicmVzdXRscyIsImZpbGxDdWlzaW5lc0hUTUwiLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwidXBkYXRlUmVzdGF1cmFudHMiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImltYWdlSUQiLCJpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZSIsImZpZ3VyZSIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsInNvdXJjZVNtYWxsIiwiaW1hZ2UiLCJmaWdDYXB0aW9uIiwiY2xhc3NOYW1lIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwidGV4dENvbnRlbnQiLCJpc0Zhdm9yaXRlIiwib25jbGljayIsImN1cnJlbnRGYXZTdGF0dXMiLCJhZGRyZXNzIiwibW9yZSIsImhyZWYiLCJtYXJrZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInB1c2giXSwibWFwcGluZ3MiOiJBQUdFQSxlQUFlQyxtQkFBbUJDLEdBQ2hDLElBQUlDLFFBQVdDLElBQUlDLEtBQUssaUJBQWtCLEVBQUdDLEdBQWFBLEVBQVVDLGtCQUFrQixjQUFlLENBQ25HQyxRQUFTLFFBR1BDLEVBQUtOLEVBQUdPLFlBQVksY0FBZSxhQUNuQ0MsRUFBUUYsRUFBR0csWUFBWSxlQUUzQlYsRUFBWVcsUUFBUUMsSUFDbEJILEVBQU1JLElBQUlELFdBR05MLEVBQUdPLFNBQ1RiLEVBQUdjLFFBTUxqQixlQUFla0IsZ0JBQWdCQyxFQUFTQyxHQUN0QyxJQUFJakIsUUFBV0MsSUFBSUMsc0JBQXNCZSxJQUFNLEVBQUdkLEdBQWFBLEVBQVVDLGdDQUFnQ2EsSUFBTSxDQUM3R1osUUFBUyxRQUdQQyxFQUFLTixFQUFHTywwQkFBMEJVLElBQU0sYUFDeENULEVBQVFGLEVBQUdHLDBCQUEwQlEsS0FDekNELEVBQVFOLFFBQVFRLElBQ2RWLEVBQU1JLElBQUlNLFdBR05aLEVBQUdPLFNBQ1RiLEVBQUdjLFFBR0xqQixlQUFlc0IseUJBQXlCRixHQUN0QyxJQUFJakIsUUFBV0MsSUFBSUMsc0JBQXNCZSxJQUFNLEdBRzNDVCxFQURLUixFQUFHTywwQkFBMEJVLElBQU0sWUFDN0JSLDBCQUEwQlEsS0FFckNHLFFBQXNCWixFQUFNYSxTQUloQyxPQUZBckIsRUFBR2MsUUFF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QUFZNEcsS0FBS3BELEtBQ2hFTyxPQUFPQyxLQUFLOEIsTUFBTTZELFlBQVlGLEVBQVEsUUFBUyxLQUM3QzdELE9BQU9nRSxTQUFTSixLQUFPQyxFQUFPbkYsTUFFaENzQyxLQUFLVixRQUFRMkQsS0FBS0oiLCJmaWxlIjoicmVzdGF1cmFudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIgIC8qKlxyXG4gICAqIENyZWF0ZSByZXN0YXVyYW50cyBJbmRleGVkREJcclxuICAgKi9cclxuICBhc3luYyBmdW5jdGlvbiBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpIHtcclxuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICB9KSlcclxuXHJcbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcblxyXG4gICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpXHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxyXG4gICAgZGIuY2xvc2UoKVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcmUgcmV2aWV3cyBieSByZXN0YXVyYW50IGlkIGluIEluZGV4ZWREQlxyXG4gICAqL1xyXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZCkge1xyXG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oYHJldmlld3MtZGItaWQ6JHtpZH1gLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKGByZXZpZXdzLWlkOiR7aWR9YCwge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICB9KSlcclxuXHJcbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihgcmV2aWV3cy1pZDoke2lkfWAsICdyZWFkd3JpdGUnKVxyXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxyXG4gICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgIHN0b3JlLnB1dChyZXZpZXcpXHJcbiAgICB9KTtcclxuXHJcbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxyXG4gICAgZGIuY2xvc2UoKVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZnVuY3Rpb24gZ2V0UmV2aWV3c0J5UmVzdGF1cmFudElkKGlkKSB7XHJcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbihgcmV2aWV3cy1kYi1pZDoke2lkfWAsIDEpXHJcblxyXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3MtaWQ6JHtpZH1gLCAncmVhZG9ubHknKVxyXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxyXG5cclxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcclxuXHJcbiAgICBkYi5jbG9zZSgpXHJcblxyXG4gICAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJpdmUgYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXHJcbiAgICovXHJcbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmVzdGF1cmFudHMoKSB7XHJcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxKVxyXG5cclxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXHJcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG5cclxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcclxuXHJcbiAgICBkYi5jbG9zZSgpXHJcblxyXG4gICAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3JlIGFsbCByZXN0YXVyYW50cyBpbiBJbmRleGVkREIuXHJcbiAgICovXHJcbiAgYXN5bmMgZnVuY3Rpb24gc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKSB7XHJcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcclxuICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgfSkpXHJcblxyXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXHJcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG5cclxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KVxyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgdHguY29tcGxldGVcclxuICAgIGRiLmNsb3NlKClcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBPU1QgbmV3IHJldmlld1xyXG4gICAqL1xyXG4gIGFzeW5jIGZ1bmN0aW9uIHBvc3RSZXZpZXcocmV2aWV3KSB7XHJcbiAgICBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MnLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpLFxyXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7XHJcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICB9XHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcclxuICAgKi9cclxuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVGYXZvcml0ZVN0YXR1cyhyZXN0YXVyYW50SWQsIGZhdm9yaXRlU3RhdHVzKSB7XHJcbiAgICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudElkfS8/aXNfZmF2b3JpdGU9JHtmYXZvcml0ZVN0YXR1c31gLCB7XHJcbiAgICAgIG1ldGhvZDogJ1BVVCdcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSk7XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcblxyXG4gICAgc3RvcmUuZ2V0KHJlc3RhdXJhbnRJZClcclxuICAgICAgLnRoZW4ocmVzdHVyYW50ID0+IHtcclxuICAgICAgICByZXN0dXJhbnQuaXNfZmF2b3JpdGUgPSBmYXZvcml0ZVN0YXR1cztcclxuICAgICAgICBzdG9yZS5wdXQocmVzdHVyYW50KTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgYXdhaXQgdHguY29tcGxldGU7XHJcbiAgICBkYi5jbG9zZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcclxuICAgKi9cclxuICBhc3luYyBmdW5jdGlvbiBmZXRjaFJldmlld3NCeUlkKGlkKSB7XHJcbiAgICBsZXQgcmV2aWV3UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JHtpZH1gKVxyXG4gICAgaWYgKHJldmlld1Jlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcclxuICAgICAgYXdhaXQgc3RvcmVBbGxSZXZpZXdzKHJldmlld3MsIGlkKVxyXG4gICAgICByZXR1cm4gcmV2aWV3c1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXNxdWVzdCBvZiByZXZpZXdzIGhhcyBmYWlsZWQnKVxyXG4gICAgfVxyXG4gIH1cclxuICAgIC8qKlxyXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XHJcbiAgICovXHJcbiAgY29uc3QgdG9nZ2xlRmF2Q2xhc3NBbmRFbGVtZW50ID0gKHN0YXR1cywgZWxlbWVudCkgPT4ge1xyXG5cclxuICAgIGlmIChzdGF0dXMgPT09ICd0cnVlJyB8IHN0YXR1cyA9PT0gdHJ1ZSkge1xyXG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3llc0ZhdicpXHJcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ3JlbW92ZSBhcyBmYXZvcml0ZScpXHJcbiAgICB9IGVsc2UgIHtcclxuICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCd5ZXNGYXYnKVxyXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdyZW1vdmUgYXMgZmF2b3JpdGUnKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxyXG4gICAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAgICogV09SS0lOR1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50cygpIHtcclxuICAgICAgLy8gRmV0Y2ggcmVzdHVyYW50cyBkYXRhIGJhc2VcclxuICAgICAgY29uc3QgcmVzdGF1cmFudFJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7REJIZWxwZXIuREFUQUJBU0VfVVJMfWApXHJcblxyXG4gICAgICBpZiAocmVzdGF1cmFudFJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCByZXN0YXVyYW50UmVzcG9uc2UuanNvbigpXHJcbiAgICAgICAgLy8gc3RvcmUgcmVzdGF1cmFudCBkYXRhIGJhc2UgaW50byBJbmRleGVkREJcclxuICAgICAgICBhd2FpdCBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpXHJcbiAgICAgICAgLy8gLy8gZmV0Y2ggYW5kIHN0b3JlIGFsbCByZXZpZXdzXHJcbiAgICAgICAgLy8gY29uc3QgcmV2aWV3UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5SRVZJRVdEQVRBX1VSTH1gKVxyXG5cclxuICAgICAgICAvLyBpZiAocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAvLyAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcclxuICAgICAgICAvLyAgIGF3YWl0IHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzKVxyXG4gICAgICAgIC8vIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcclxuICAgICAgICAvLyB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IG9mIHJlc3RhdXJhbnRzIGhhcyBmYWlsZWQnKVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAgICogV09SS0lOR1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xyXG5cclxuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXHJcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xyXG4gICAgICB9KVxyXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcclxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpXHJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcclxuICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudFxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcpXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICogV09SS0lOR1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcblxyXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcclxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xyXG5cclxuXHJcbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRzXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOZWlnYm9yaG9vZCBkb2VzIG5vdCBleGlzdCcpXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICAgKiBXT1JLSU5HXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XHJcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxyXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXHJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcclxuXHJcbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHRzXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50cyB3aXRoIGN1aXNpbmUgYW5kIG5laWdoYm9yaG9vZCBjb25iaW5hdGlvbiBkb2VzIG5vdCBleGlzdCcpXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgICogV09SS0lOR1xyXG4gICAgICovXHJcbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hOZWlnaGJvcmhvb2RzKCkge1xyXG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcclxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XHJcbiAgICAgIH0pXHJcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxyXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XHJcblxyXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuXHJcbiAgICAgICAgcmV0dXJuIHVuaXF1ZU5laWdoYm9yaG9vZHNcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgbmVpZ2hib3Job29kcycpXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGFzeW5jIGZldGNoQ3Vpc2luZXMoKSB7XHJcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxyXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuICAgICAgfSlcclxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXHJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcclxuXHJcbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcblxyXG4gICAgICAgIHJldHVybiB1bmlxdWVDdWlzaW5lc1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGF0IGZldGNoaW5nIGFsbCBjdWlzaW5lJylcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgICAqIEVycm9yIGNoZWNraW5nIGR1ZSB0byByZXN0YXVyYW50ICMxMCBkb2VzIG5vdCBoYXZlIGEgcGhvdG8gcHJvcGVydHlcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xyXG5cclxuICAgICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gKGAvaW1nL2Vycm9yLmpwZ2ApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXNwb25zaXZlIGltYWdlIG9ubHkgZ2V0cyB0aGUgbmFtZSBvZiB0aGUgcGljdHVyZSBieSBpZCB3aWhvdXQgZ2V0dGluZyB0aGUgZXh0ZW5zaW9uLCBleHRlbnNpb24gd2lsbCBiZSBhZGRlZCBpbiBsYXRlclxyXG4gICAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUocmVzdGF1cmFudCkge1xyXG5cclxuICAgICAgY29uc3QgcGhvdG8gPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XHJcblxyXG4gICAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy9lcnJvcmApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy8ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gbWFya2VyO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBzZW5kT2ZmbGluZURhdGEocmV2aWV3KSB7XHJcbiAgICAgIC8vIFN0b3JlIHRoZSByZXZpZXcgb24gbG9jYWwgc3RvcmFnZVxyXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGF0YScsIEpTT04uc3RyaW5naWZ5KHJldmlldykpO1xyXG5cclxuICAgICAgLy8gQnVpbGQgdGVtcG9yYXJ5IFVJIGFuZCBhcHBlbmQgdG8gdGhlIGFscmVhZHkgbGlzdCBvZiByZXZpZXdzXHJcbiAgICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblxyXG4gICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gICAgICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gICAgICBsaS5hcHBlbmRDaGlsZChuYW1lKVxyXG5cclxuICAgICAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpO1xyXG4gICAgICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgICAgIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gICAgICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICAgICAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICAgIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcclxuICAgICAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICAgICAgdWwuYXBwZW5kQ2hpbGQobGkpXHJcblxyXG4gICAgICAvLyBTaG93IE9mZmxpbmUgQWxlcnRcclxuICAgICAgY29uc3Qgb2ZmbGluZUFsZXJ0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvZmZsaW5lLWFsZXJ0XCIpXHJcbiAgICAgIG9mZmxpbmVBbGVydC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgLy8gV2FpdCB1bnRpbCBjbGllbnQgaXMgYmFjayBvbmxpbmVcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIChldmVudCkgPT4ge1xyXG4gICAgICAgIC8vIEdldHRpbmcgZGF0YSBmcm9tIGxvY2FsU3RvcmFnZVxyXG4gICAgICAgIGxldCByZXZpZXcgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkYXRhJykpXHJcbiAgICAgICAgLy8gU2VuZGluZyByZXZpZXcgdG8gdGhlIHNlcnZlclxyXG4gICAgICAgIHBvc3RSZXZpZXcocmV2aWV3KVxyXG5cclxuICAgICAgICAvLyBSZW1vdmUgb2ZmbGluZSBub3RpdGljYXRpb25cclxuICAgICAgICBvZmZsaW5lQWxlcnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgbG9jYWxTdG9yYWdlIGRhdGFcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZGF0YScpXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfSIsImxldCByZXN0YXVyYW50cyxcclxuICBuZWlnaGJvcmhvb2RzLFxyXG4gIGN1aXNpbmVzXHJcbnZhciBtYXBcclxudmFyIG1hcmtlcnMgPSBbXVxyXG5cclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4vLyBDaGVja2luZyBpZiBTZXJ2aWNlIFdvcmtlciBpcyBhdmFpYmxlXHJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy4vc2VydmljZS13b3JrZXIuanMnLCB7XHJcbiAgICAgIHNjb3BlOiAnLi8nXHJcbiAgICB9KVxyXG4gICAgLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJhdGlvbikge1xyXG4gICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBSZWdpc3RlcicpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxyXG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xyXG4gICAgfSlcclxufSBlbHNlIHtcclxuICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBub3Qgc3VwcG9ydGVkLicpO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXN5bmMgKGV2ZW50KSA9PiB7XHJcbiAgYXdhaXQgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgLy8gRE9ORVxyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcyhuZWlnaGJvcmhvb2RzKVxyXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gcmVzdWx0cztcclxuICAgICAgZmlsbE5laWdoYm9yaG9vZHNIVE1MKCk7XHJcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG59XHJcblxyXG4vKipcclxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cclxuICovXHJcbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hDdWlzaW5lcyA9IChjdWlzaW5lcykgPT4ge1xyXG4gIC8vIERPTkVcclxuICBEQkhlbHBlci5mZXRjaEN1aXNpbmVzKGN1aXNpbmVzKVxyXG4gICAgLnRoZW4oKHJlc3V0bHMpID0+IHtcclxuICAgICAgc2VsZi5jdWlzaW5lcyA9IHJlc3V0bHM7XHJcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XHJcblxyXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XHJcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcclxuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgem9vbTogMTIsXHJcbiAgICBjZW50ZXI6IGxvYyxcclxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gIH0pO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxyXG4gKi9cclxudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XHJcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XHJcblxyXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xyXG4gIC8vIERPTkVcclxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKVxyXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN1bHRzKTtcclxuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xyXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcclxuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IFtdO1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICB1bC5pbm5lckhUTUwgPSAnJztcclxuXHJcbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xyXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xyXG4gIHNlbGYubWFya2VycyA9IFtdO1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBhZGRNYXJrZXJzVG9NYXAoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXHJcbiAqL1xyXG5jcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG5cclxuICBjb25zdCBpbWFnZUlEID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUocmVzdGF1cmFudCk7XHJcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBjb25zdCBzb3VyY2VMYXJnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBjb25zdCBmaWdDYXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlnY2FwdGlvbicpO1xyXG5cclxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2xhenlsb2FkJyk7XHJcbiAgc291cmNlTGFyZ2Uuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWluLXdpZHRoOiA1MDFweCknKTtcclxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JywgYCR7aW1hZ2VJRH1fbGFyZ2VfMnguanBnIDJ4LCAke2ltYWdlSUR9X2xhcmdlXzF4LmpwZ2ApO1xyXG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbGF6eWxvYWQnKTtcclxuICBzb3VyY2VTbWFsbC5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtYXgtd2lkdGg6IDUwMHB4KScpO1xyXG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLCBgJHtpbWFnZUlEfV9zbWFsbF8yeC5qcGcgMngsICR7aW1hZ2VJRH1fc21hbGxfMXguanBnYCk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nIGxhenlsb2FkJztcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgYCR7REJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpfWApO1xyXG4gIC8vIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgcmVzdGF1cmFudC5uYW1lKVxyXG4gIGZpZ0NhcHRpb24udGV4dENvbnRlbnQgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgZmlndXJlLmFwcGVuZChwaWN0dXJlKTtcclxuICBmaWd1cmUuYXBwZW5kKGZpZ0NhcHRpb24pXHJcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlTGFyZ2UpO1xyXG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZVNtYWxsKTtcclxuICBwaWN0dXJlLmFwcGVuZChpbWFnZSk7XHJcbiAgbGkuYXBwZW5kKGZpZ3VyZSk7XHJcblxyXG5cclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBpc0Zhdm9yaXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgaXNGYXZvcml0ZS5pbm5lckhUTUwgPSAnJmhlYXJ0czsnO1xyXG4gIGlzRmF2b3JpdGUuY2xhc3NMaXN0LmFkZCgnaXNGYXZvcml0ZScpXHJcbiAgLy8gU2V0IHN0eWxlcyBkZXBlbmRpbmcgaWYgaXMgZmF2b3JpdGUgb3Igbm90XHJcbiAgdG9nZ2xlRmF2Q2xhc3NBbmRFbGVtZW50KHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUsIGlzRmF2b3JpdGUpXHJcblxyXG4gIC8vIFVwZGF0aW5nIGRhdGEgYmFzZSBiYXNlIG9uIGZhdm9yaXRlIHN0YXR1c1xyXG4gIGlzRmF2b3JpdGUub25jbGljayA9ICgpID0+IHtcclxuICAgIC8vIGlzRmF2b3JpdGUuY2xhc3NMaXN0LnRvZ2dsZSgneWVzRmF2JylcclxuICAgIGNvbnN0IGN1cnJlbnRGYXZTdGF0dXMgPSAhSlNPTi5wYXJzZShyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcclxuICAgIGNvbnNvbGUubG9nKGN1cnJlbnRGYXZTdGF0dXMpO1xyXG4gICAgdXBkYXRlRmF2b3JpdGVTdGF0dXMocmVzdGF1cmFudC5pZCwgY3VycmVudEZhdlN0YXR1cyk7XHJcbiAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gY3VycmVudEZhdlN0YXR1c1xyXG4gICAgLy8gU2V0IHN0eWxlcyBkZXBlbmRpbmcgaWYgaXMgZmF2b3JpdGUgb3Igbm90XHJcbiAgICB0b2dnbGVGYXZDbGFzc0FuZEVsZW1lbnQocmVzdGF1cmFudC5pc19mYXZvcml0ZSwgaXNGYXZvcml0ZSlcclxuICB9XHJcbiAgbGkuYXBwZW5kKGlzRmF2b3JpdGUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3QgbW9yZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcclxuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xyXG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgbGkuYXBwZW5kKG1vcmUpXHJcblxyXG4gIHJldHVybiBsaVxyXG59XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufSJdfQ==
