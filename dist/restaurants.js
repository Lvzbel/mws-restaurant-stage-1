async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,s=e[n].value,o=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,o).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant_responsive(e),r=document.createElement("figure"),s=document.createElement("picture"),o=document.createElement("source"),a=document.createElement("source"),c=document.createElement("img"),l=document.createElement("figcaption");o.setAttribute("media","(min-width: 501px)"),o.setAttribute("srcset",`${n}_large_2x.jpg 2x, ${n}_large_1x.jpg`),a.setAttribute("media","(max-width: 500px)"),a.setAttribute("srcset",`${n}_small_2x.jpg 2x, ${n}_small_1x.jpg`),c.className="restaurant-img",c.src=DBHelper.imageUrlForRestaurant(e),c.setAttribute("alt",e.name),l.textContent=e.name,r.append(s),r.append(l),s.append(o),s.append(a),s.append(c),t.append(r);const i=document.createElement("h1");i.innerHTML=e.name,t.append(i);const d=document.createElement("p");d.innerHTML=e.neighborhood,t.append(d);const u=document.createElement("p");u.innerHTML=e.address,t.append(u);const m=document.createElement("a");return m.innerHTML="View Details",m.href=DBHelper.urlForRestaurant(e),t.append(m),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJnZXRBbGxSZXN0YXVyYW50cyIsImFsbFNhdmVkSXRlbXMiLCJnZXRBbGwiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsInJlc3BvbnNlIiwiZmV0Y2giLCJzdGF0dXMiLCJqc29uIiwiRXJyb3IiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwiZmluZCIsInIiLCJuZWlnaGJvcmhvb2QiLCJmaWx0ZXIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuZGVmaW5lZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzY29wZSIsInJlZ2lzdHJhdGlvbiIsImUiLCJlcnJvciIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsInJlc3V0bHMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiaW1hZ2VJRCIsImltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlIiwiZmlndXJlIiwicGljdHVyZSIsInNvdXJjZUxhcmdlIiwic291cmNlU21hbGwiLCJpbWFnZSIsImZpZ0NhcHRpb24iLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJ0ZXh0Q29udGVudCIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBTUFBLGVBQWVDLG1CQUFtQkMsR0FDaEMsSUFBSUMsUUFBV0MsSUFBSUMsS0FBSyxpQkFBa0IsRUFBR0MsR0FBYUEsRUFBVUMsa0JBQWtCLGNBQWUsQ0FDbkdDLFFBQVMsUUFHUEMsRUFBS04sRUFBR08sWUFBWSxjQUFlLGFBQ25DQyxFQUFRRixFQUFHRyxZQUFZLGVBRTNCVixFQUFZVyxRQUFRQyxJQUNsQkgsRUFBTUksSUFBSUQsV0FHTkwsRUFBR08sU0FDVGIsRUFBR2MsUUFHTGpCLGVB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aENrQixLQUFLYixRQUFRbUUsS0FBS0oiLCJmaWxlIjoicmVzdGF1cmFudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsZXQgcmVzdGF1cmFudHNcclxuXHJcbi8vIGNvbnN0IGRlZmluZVJlc3QgPSBhc3luYyAoKSA9PiB7XHJcbi8vICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKClcclxuLy8gICByZXN0YXVyYW50cyA9ICByZXN1bHRzXHJcbi8vIH1cclxuYXN5bmMgZnVuY3Rpb24gc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKSB7XHJcbiAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgdXBncmFkZURCID0+IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICBrZXlQYXRoOiAnaWQnXHJcbiAgfSkpXHJcblxyXG4gIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxyXG4gIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcblxyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcclxuICB9KTtcclxuXHJcbiAgYXdhaXQgdHguY29tcGxldGVcclxuICBkYi5jbG9zZSgpXHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGdldEFsbFJlc3RhdXJhbnRzKCkge1xyXG4gIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpXHJcblxyXG4gIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXHJcbiAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcclxuXHJcbiAgbGV0IGFsbFNhdmVkSXRlbXMgPSBhd2FpdCBzdG9yZS5nZXRBbGwoKVxyXG5cclxuICBkYi5jbG9zZSgpXHJcbiAgXHJcbiAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcclxufVxyXG5cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAgIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICogV09SS0lOR1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRzKCkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9YClcclxuXHJcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCByZXNwb25zZS5qc29uKClcclxuICAgICAgYXdhaXQgc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKVxyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudHNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBvZiByZXN0YXVyYW50cyBoYXMgZmFpbGVkJylcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICogV09SS0lOR1xyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XHJcblxyXG4gICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PntcclxuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXHJcbiAgICB9KS5jYXRjaCgoZXJyKSA9PntcclxuICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuICAgIH0pXHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcclxuICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpXHJcbiAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcclxuICAgaWYgKHJlc3RhdXJhbnQpIHtcclxuICAgICByZXR1cm4gcmVzdGF1cmFudFxyXG4gICB9IGVsc2Uge1xyXG4gICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcpXHJcbiAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqIFdPUktJTkdcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XHJcblxyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXHJcbiAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XHJcbiAgICBcclxuICAgIGlmIChyZXN0YXVyYW50cykge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgcmV0dXJuIHJlc3VsdHNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignTmVpZ2Jvcmhvb2QgZG9lcyBub3QgZXhpc3QnKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqIFdPUktJTkdcclxuICAgKi9cclxuICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCkge1xyXG4gICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PntcclxuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXHJcbiAgICB9KS5jYXRjaCgoZXJyKSA9PntcclxuICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuICAgIH0pXHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcclxuICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcclxuXHJcbiAgICBpZiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudHMgd2l0aCBjdWlzaW5lIGFuZCBuZWlnaGJvcmhvb2QgY29uYmluYXRpb24gZG9lcyBub3QgZXhpc3QnKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKiBXT1JLSU5HXHJcbiAgICovXHJcbiAgc3RhdGljIGFzeW5jIGZldGNoTmVpZ2hib3Job29kcygpIHtcclxuICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT57XHJcbiAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxyXG4gICAgfSkuY2F0Y2goKGVycikgPT57XHJcbiAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XHJcbiAgICB9KVxyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXHJcbiAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XHJcblxyXG4gICAgaWYgKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxyXG5cclxuICAgICAgcmV0dXJuIHVuaXF1ZU5laWdoYm9yaG9vZHNcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGF0IGZldGNoaW5nIGFsbCBuZWlnaGJvcmhvb2RzJylcclxuICAgIH1cclxuICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBhc3luYyBmZXRjaEN1aXNpbmVzKCkge1xyXG4gICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PntcclxuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXHJcbiAgICB9KS5jYXRjaCgoZXJyKSA9PntcclxuICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuICAgIH0pXHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcclxuICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcclxuXHJcbiAgICBpZiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSlcclxuXHJcbiAgICAgICAgcmV0dXJuIHVuaXF1ZUN1aXNpbmVzXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgY3Vpc2luZScpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICBjb25zdCBwaG90byA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcclxuXHJcbiAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICByZXR1cm4gKGAvaW1nL2Vycm9yLmpwZ2ApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAqIFJlc3BvbnNpdmUgaW1hZ2Ugb25seSBnZXRzIHRoZSBuYW1lIG9mIHRoZSBwaWN0dXJlIGJ5IGlkIHdpaG91dCBnZXR0aW5nIHRoZSBleHRlbnNpb24sIGV4dGVuc2lvbiB3aWxsIGJlIGFkZGVkIGluIGxhdGVyXHJcbiAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KSB7XHJcblxyXG4gICAgY29uc3QgcGhvdG8gPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XHJcblxyXG4gICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgcmV0dXJuIChgaW1nL3Jlc3BvbnNpdmVfaW1nL2Vycm9yYCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gKGBpbWcvcmVzcG9uc2l2ZV9pbWcvJHtyZXN0YXVyYW50LmlkfWApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBNYWtlcyBpbml0aWFsIGZldGNoIHJlcXVlc3QgYW5kIHNhdmVzIGl0IGludG8gSW5kZXhlZERCXHJcbi8vICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PntcclxuLy8gICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxyXG4vLyAgIH0pLmNhdGNoKChlcnIpID0+e1xyXG4vLyAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcclxuLy8gICB9KVxyXG4vLyB9IiwibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG1hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbi8vIENoZWNraW5nIGlmIFNlcnZpY2UgV29ya2VyIGlzIGF2YWlibGVcclxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zZXJ2aWNlLXdvcmtlci5qcycsIHtcclxuICAgICAgc2NvcGU6ICcuLydcclxuICAgIH0pXHJcbiAgICAudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIFJlZ2lzdGVyJyk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XHJcbiAgICB9KVxyXG59IGVsc2Uge1xyXG4gIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIG5vdCBzdXBwb3J0ZWQuJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cclxuICovXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBhc3luYyAoZXZlbnQpID0+IHtcclxuICBhd2FpdCBmZXRjaE5laWdoYm9yaG9vZHMoKTtcclxuICBmZXRjaEN1aXNpbmVzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcclxuICAvLyBET05FXHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKG5laWdoYm9yaG9vZHMpXHJcbiAgICAudGhlbigocmVzdWx0cykgPT4ge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSByZXN1bHRzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxyXG4gKi9cclxuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXHJcbiAqL1xyXG5mZXRjaEN1aXNpbmVzID0gKGN1aXNpbmVzKSA9PiB7XHJcbiAgLy8gRE9ORVxyXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoY3Vpc2luZXMpXHJcbiAgICAudGhlbigocmVzdXRscykgPT4ge1xyXG4gICAgICBzZWxmLmN1aXNpbmVzID0gcmVzdXRscztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KVxyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgbGV0IGxvYyA9IHtcclxuICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgbG5nOiAtNzMuOTg3NTAxXHJcbiAgfTtcclxuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICB6b29tOiAxMixcclxuICAgIGNlbnRlcjogbG9jLFxyXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgfSk7XHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcbiAgLy8gRE9ORVxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpXHJcbiAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdWx0cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICB9KS5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH0pXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXHJcbiAqL1xyXG5yZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIHVsLmFwcGVuZChjcmVhdGVSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSk7XHJcbiAgfSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxyXG4gKi9cclxuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHJcbiAgLy8gY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICAvLyBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIC8vIGltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCByZXN0YXVyYW50Lm5hbWUpXHJcbiAgLy8gaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG5cclxuICAvLyBpbWFnZS5zcmMgPSBgJHtEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KX1fbGFyZ2VfMnguanBnYDtcclxuICBjb25zdCBpbWFnZUlEID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUocmVzdGF1cmFudCk7XHJcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XHJcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcclxuICBjb25zdCBzb3VyY2VMYXJnZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NvdXJjZScpO1xyXG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBjb25zdCBmaWdDYXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlnY2FwdGlvbicpO1xyXG5cclxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgJyhtaW4td2lkdGg6IDUwMXB4KScpO1xyXG4gIHNvdXJjZUxhcmdlLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7aW1hZ2VJRH1fbGFyZ2VfMnguanBnIDJ4LCAke2ltYWdlSUR9X2xhcmdlXzF4LmpwZ2ApO1xyXG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1heC13aWR0aDogNTAwcHgpJyk7XHJcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZUlEfV9zbWFsbF8yeC5qcGcgMngsICR7aW1hZ2VJRH1fc21hbGxfMXguanBnYCk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHJlc3RhdXJhbnQubmFtZSlcclxuICBmaWdDYXB0aW9uLnRleHRDb250ZW50ID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGZpZ3VyZS5hcHBlbmQocGljdHVyZSk7XHJcbiAgZmlndXJlLmFwcGVuZChmaWdDYXB0aW9uKVxyXG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZUxhcmdlKTtcclxuICBwaWN0dXJlLmFwcGVuZChzb3VyY2VTbWFsbCk7XHJcbiAgcGljdHVyZS5hcHBlbmQoaW1hZ2UpO1xyXG4gIGxpLmFwcGVuZChmaWd1cmUpO1xyXG5cclxuXHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn0iXX0=
