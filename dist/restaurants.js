async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t,e){let a=await idb.open(`reviews-db-id:${e}`,1,t=>t.createObjectStore(`reviews-id:${e}`,{keyPath:"id"})),r=a.transaction(`reviews-id:${e}`,"readwrite"),n=r.objectStore(`reviews-id:${e}`);t.forEach(t=>{n.put(t)}),await r.complete,a.close()}async function getReviewsByRestaurantId(t){let e=await idb.open(`reviews-db-id:${t}`,1),a=e.transaction(`reviews-id:${t}`,"readonly").objectStore(`reviews-id:${t}`),r=await a.getAll();return e.close(),r}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function postReview(t){await fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})})}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");n.get(t).then(t=>{t.is_favorite=e,n.put(t)}),await r.complete,a.close()}async function fetchReviewsById(t){let e=await fetch(`http://localhost:1337/reviews/?restaurant_id=${t}`);if(200===e.status){const a=await e.json();return await storeAllReviews(a,t),a}throw new Error("Resquest of reviews has failed")}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static async sendOfflineData(t){localStorage.setItem("data",JSON.stringify(t));const e=document.getElementById("reviews-list"),a=document.createElement("li"),r=document.createElement("p");r.innerHTML=t.name,a.appendChild(r);const n=document.createElement("p");n.innerHTML=(new Date).toDateString(),a.appendChild(n);const s=document.createElement("p");s.innerHTML=`Rating: ${t.rating}`,a.appendChild(s);const o=document.createElement("p");o.innerHTML=t.comments,a.appendChild(o),e.appendChild(a);const i=document.getElementById("offline-alert");i.style.display="block",window.addEventListener("online",t=>{postReview(JSON.parse(localStorage.getItem("data"))),i.style.display="none",localStorage.removeItem("data")})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,n=t.selectedIndex,o=e[s].value,r=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,r).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),s=DBHelper.imageUrlForRestaurant_responsive(e),n=document.createElement("figure"),o=document.createElement("picture"),r=document.createElement("source"),a=document.createElement("source"),i=document.createElement("img"),c=document.createElement("figcaption");r.setAttribute("media","(min-width: 501px)"),r.setAttribute("srcset",`${s}_large_2x.jpg 2x, ${s}_large_1x.jpg`),a.setAttribute("media","(max-width: 500px)"),a.setAttribute("srcset",`${s}_small_2x.jpg 2x, ${s}_small_1x.jpg`),i.className="restaurant-img",i.src=DBHelper.imageUrlForRestaurant(e),i.setAttribute("alt",e.name),c.textContent=e.name,n.append(o),n.append(c),o.append(r),o.append(a),o.append(i),t.append(n);const l=document.createElement("h1");l.innerHTML=e.name,t.append(l);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),"true"===e.is_favorite|!0===e.is_favorite?(d.classList.add("yesFav"),console.log(`Status for ${e.id} is true ad type is ${typeof e.is_favorite}`)):"false"===e.is_favorite|!1===e.is_favorite&&(d.classList.remove("yesFav"),console.log(`Status for ${e.id} is false ad type is ${typeof e.is_favorite}`)),d.onclick=(()=>{d.classList.toggle("yesFav");const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,console.log(e.is_favorite)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const p=document.createElement("p");p.innerHTML=e.address,t.append(p);const m=document.createElement("a");return m.innerHTML="View Details",m.href=DBHelper.urlForRestaurant(e),t.append(m),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwiaWQiLCJyZXZpZXciLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJwb3N0UmV2aWV3IiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwidXBkYXRlRmF2b3JpdGVTdGF0dXMiLCJyZXN0YXVyYW50SWQiLCJmYXZvcml0ZVN0YXR1cyIsImdldCIsInRoZW4iLCJyZXN0dXJhbnQiLCJpc19mYXZvcml0ZSIsImZldGNoUmV2aWV3c0J5SWQiLCJyZXZpZXdSZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJFcnJvciIsIkRCSGVscGVyIiwiREFUQUJBU0VfVVJMIiwiW29iamVjdCBPYmplY3RdIiwicmVzdGF1cmFudFJlc3BvbnNlIiwiZmV0Y2hSZXN0YXVyYW50cyIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVyciIsImZpbmQiLCJyIiwibmVpZ2hib3Job29kIiwiZmlsdGVyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmRlZmluZWQiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJuYW1lIiwidXJsIiwidXJsRm9yUmVzdGF1cmFudCIsImFuaW1hdGlvbiIsIkFuaW1hdGlvbiIsIkRST1AiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwidWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwibGkiLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJkYXRlIiwiRGF0ZSIsInRvRGF0ZVN0cmluZyIsInJhdGluZyIsImNvbW1lbnRzIiwib2ZmbGluZUFsZXJ0Iiwic3R5bGUiLCJkaXNwbGF5Iiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicGFyc2UiLCJnZXRJdGVtIiwicmVtb3ZlSXRlbSIsIm1hcmtlcnMiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzY29wZSIsInJlZ2lzdHJhdGlvbiIsImUiLCJlcnJvciIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0Iiwib3B0aW9uIiwidmFsdWUiLCJhcHBlbmQiLCJyZXN1dGxzIiwiZmlsbEN1aXNpbmVzSFRNTCIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibSIsInNldE1hcCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwiaW1hZ2VJRCIsImltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlIiwiZmlndXJlIiwicGljdHVyZSIsInNvdXJjZUxhcmdlIiwic291cmNlU21hbGwiLCJpbWFnZSIsImZpZ0NhcHRpb24iLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJ0ZXh0Q29udGVudCIsImlzRmF2b3JpdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJvbmNsaWNrIiwidG9nZ2xlIiwiY3VycmVudEZhdlN0YXR1cyIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBR0VBLGVBQWVDLG1CQUFtQkMsR0FDaEMsSUFBSUMsUUFBV0MsSUFBSUMsS0FBSyxpQkFBa0IsRUFBR0MsR0FBYUEsRUFBVUMsa0JBQWtCLGNBQWUsQ0FDbkdDLFFBQVMsUUFHUEMsRUFBS04sRUFBR08sWUFBWSxjQUFlLGFBQ25DQyxFQUFRRixFQUFHRyxZQUFZLGVBRTNCVixFQUFZVyxRQUFRQyxJQUNsQkgsRUFBTUksSUFBSUQsV0FHTkwsRUFBR08sU0FDVGIsRUFBR2MsUUFNTGpCLGVBQWVrQixnQkFBZ0JDLEVBQVNDLEdBQ3RDLElBQUlqQixRQUFXQyxJQUFJQyxzQkFBc0JlLElBQU0sRUFBR2QsR0FBYUEsRUFBVUMsZ0NBQWdDYSxJQUFNLENBQzdHWixRQUFTLFFBR1BDLEVBQUtOLEVBQUdPLDBCQUEwQlUsSUFBTSxhQUN4Q1QsRUFBUUYsRUFBR0csMEJBQTBCUSxLQUN6Q0QsRUFBUU4sUUFBUVEsSUFDZFYsRUFBTUksSUFBSU0sV0FHTlosRUFBR08sU0FDVGIsRUFBR2MsUUFHTGpCLGVBQWVzQix5QkFBeUJGLEdBQ3RDLElBQUlqQixRQUFXQyxJQUFJQyxzQkFBc0JlLElBQU0sR0FHM0NULEVBREtSLEVBQUdPLDBCQUEwQlUsSUFBTSxZQUM3QlIsMEJBQTBCUSxLQUVyQ0csUUFBc0JaLEVBQU1hLFNBSWhDLE9BRkFyQixFQUFHYyxRQUVJTSxFQU1UdkIsZUFBZXlCLG9CQUNi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RSxZQUFZRixFQUFRLFFBQVMsS0FDN0NuRSxPQUFPc0UsU0FBU0osS0FBT0MsRUFBT3pGLE1BRWhDc0MsS0FBS1YsUUFBUWlFLEtBQUtKIiwiZmlsZSI6InJlc3RhdXJhbnRzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiICAvKipcbiAgICogQ3JlYXRlIHJlc3RhdXJhbnRzIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgdXBncmFkZURCID0+IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XG4gICAgICBrZXlQYXRoOiAnaWQnXG4gICAgfSkpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxuXG4gICAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KVxuICAgIH0pO1xuXG4gICAgYXdhaXQgdHguY29tcGxldGVcbiAgICBkYi5jbG9zZSgpXG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgcmV2aWV3cyBieSByZXN0YXVyYW50IGlkIGluIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gc3RvcmVBbGxSZXZpZXdzKHJldmlld3MsIGlkKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oYHJldmlld3MtZGItaWQ6JHtpZH1gLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKGByZXZpZXdzLWlkOiR7aWR9YCwge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3MtaWQ6JHtpZH1gLCAncmVhZHdyaXRlJylcbiAgICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShgcmV2aWV3cy1pZDoke2lkfWApXG4gICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgICBzdG9yZS5wdXQocmV2aWV3KVxuICAgIH0pO1xuXG4gICAgYXdhaXQgdHguY29tcGxldGVcbiAgICBkYi5jbG9zZSgpXG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQoaWQpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbihgcmV2aWV3cy1kYi1pZDoke2lkfWAsIDEpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbihgcmV2aWV3cy1pZDoke2lkfWAsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxuXG4gICAgbGV0IGFsbFNhdmVkSXRlbXMgPSBhd2FpdCBzdG9yZS5nZXRBbGwoKVxuXG4gICAgZGIuY2xvc2UoKVxuXG4gICAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaXZlIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUmVzdGF1cmFudHMoKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkb25seScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAgIGRiLmNsb3NlKClcblxuICAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIH1cblxuICAvKipcbiAgICogU3RvcmUgYWxsIHJlc3RhdXJhbnRzIGluIEluZGV4ZWREQi5cbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cykge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgLyoqXG4gICAqIFBPU1QgbmV3IHJldmlld1xuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gcG9zdFJldmlldyhyZXZpZXcpIHtcbiAgICBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MnLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldyksXG4gICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuICAvKipcbiAgICogVXBkYXRlIEZhdm9yaXRlIFN0YXR1cyBpbiBhIHJlc3RhdXJhbnRcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlU3RhdHVzKHJlc3RhdXJhbnRJZCwgZmF2b3JpdGVTdGF0dXMpIHtcbiAgICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudElkfS8/aXNfZmF2b3JpdGU9JHtmYXZvcml0ZVN0YXR1c31gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnXG4gICAgfSk7XG5cbiAgICBjb25zdCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpO1xuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG5cbiAgICBzdG9yZS5nZXQocmVzdGF1cmFudElkKVxuICAgICAgLnRoZW4ocmVzdHVyYW50ID0+IHtcbiAgICAgICAgcmVzdHVyYW50LmlzX2Zhdm9yaXRlID0gZmF2b3JpdGVTdGF0dXM7XG4gICAgICAgIHN0b3JlLnB1dChyZXN0dXJhbnQpO1xuICAgICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZTtcbiAgICBkYi5jbG9zZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBmZXRjaFJldmlld3NCeUlkKGlkKSB7XG4gICAgbGV0IHJldmlld1Jlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPSR7aWR9YClcbiAgICBpZiAocmV2aWV3UmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcbiAgICAgIGF3YWl0IHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZClcbiAgICAgIHJldHVybiByZXZpZXdzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVzcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcbiAgICB9XG4gIH1cblxuICBjbGFzcyBEQkhlbHBlciB7XG5cbiAgICAvKipcbiAgICAgKiBEYXRhYmFzZSBVUkwuXG4gICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xuICAgICAgY29uc3QgcG9ydCA9IDEzMzcgLy8gQ2hhbmdlIHRoaXMgdG8geW91ciBzZXJ2ZXIgcG9ydFxuICAgICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50cygpIHtcbiAgICAgIC8vIEZldGNoIHJlc3R1cmFudHMgZGF0YSBiYXNlXG4gICAgICBjb25zdCByZXN0YXVyYW50UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5EQVRBQkFTRV9VUkx9YClcblxuICAgICAgaWYgKHJlc3RhdXJhbnRSZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IHJlc3RhdXJhbnRSZXNwb25zZS5qc29uKClcbiAgICAgICAgLy8gc3RvcmUgcmVzdGF1cmFudCBkYXRhIGJhc2UgaW50byBJbmRleGVkREJcbiAgICAgICAgYXdhaXQgc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKVxuICAgICAgICAvLyAvLyBmZXRjaCBhbmQgc3RvcmUgYWxsIHJldmlld3NcbiAgICAgICAgLy8gY29uc3QgcmV2aWV3UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtEQkhlbHBlci5SRVZJRVdEQVRBX1VSTH1gKVxuXG4gICAgICAgIC8vIGlmIChyZXZpZXdSZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAvLyAgIGNvbnN0IHJldmlld3MgPSBhd2FpdCByZXZpZXdSZXNwb25zZS5qc29uKClcbiAgICAgICAgLy8gICBhd2FpdCBzdG9yZUFsbFJldmlld3MocmV2aWV3cylcbiAgICAgICAgLy8gfSBlbHNlIHtcbiAgICAgICAgLy8gICB0aHJvdyBuZXcgRXJyb3IoJ1JlcXVlc3Qgb2YgcmV2aWV3cyBoYXMgZmFpbGVkJylcbiAgICAgICAgLy8gfVxuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBvZiByZXN0YXVyYW50cyBoYXMgZmFpbGVkJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkge1xuXG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKClcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcbiAgICAgIGlmIChyZXN0YXVyYW50KSB7XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XG5cbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTmVpZ2Jvcmhvb2QgZG9lcyBub3QgZXhpc3QnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kKSB7XG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3RhdXJhbnRzIHdpdGggY3Vpc2luZSBhbmQgbmVpZ2hib3Job29kIGNvbmJpbmF0aW9uIGRvZXMgbm90IGV4aXN0JylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoTmVpZ2hib3Job29kcygpIHtcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxuXG4gICAgICAgIHJldHVybiB1bmlxdWVOZWlnaGJvcmhvb2RzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgbmVpZ2hib3Job29kcycpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaEN1aXNpbmVzKCkge1xuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKVxuXG4gICAgICAgIHJldHVybiB1bmlxdWVDdWlzaW5lc1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgYXQgZmV0Y2hpbmcgYWxsIGN1aXNpbmUnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAgICovXG4gICAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgICAqIEVycm9yIGNoZWNraW5nIGR1ZSB0byByZXN0YXVyYW50ICMxMCBkb2VzIG5vdCBoYXZlIGEgcGhvdG8gcHJvcGVydHlcbiAgICAgKi9cbiAgICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXG4gICAgICBpZiAocGhvdG8gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gKGAvaW1nL2Vycm9yLmpwZ2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0uanBnYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzcG9uc2l2ZSBpbWFnZSBvbmx5IGdldHMgdGhlIG5hbWUgb2YgdGhlIHBpY3R1cmUgYnkgaWQgd2lob3V0IGdldHRpbmcgdGhlIGV4dGVuc2lvbiwgZXh0ZW5zaW9uIHdpbGwgYmUgYWRkZWQgaW4gbGF0ZXJcbiAgICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XG4gICAgICovXG4gICAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpIHtcblxuICAgICAgY29uc3QgcGhvdG8gPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cbiAgICAgIGlmIChwaG90byA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy9lcnJvcmApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIChgaW1nL3Jlc3BvbnNpdmVfaW1nLyR7cmVzdGF1cmFudC5pZH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAgICovXG4gICAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG4gICAgICAgIG1hcDogbWFwLFxuICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtYXJrZXI7XG4gICAgfVxuXG4gICAgc3RhdGljIGFzeW5jIHNlbmRPZmZsaW5lRGF0YShyZXZpZXcpIHtcbiAgICAgIC8vIFN0b3JlIHRoZSByZXZpZXcgb24gbG9jYWwgc3RvcmFnZVxuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2RhdGEnLCBKU09OLnN0cmluZ2lmeShyZXZpZXcpKTtcblxuICAgICAgLy8gQnVpbGQgdGVtcG9yYXJ5IFVJIGFuZCBhcHBlbmQgdG8gdGhlIGFscmVhZHkgbGlzdCBvZiByZXZpZXdzXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcblxuICAgICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gICAgICBsaS5hcHBlbmRDaGlsZChuYW1lKVxuXG4gICAgICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZSgpLnRvRGF0ZVN0cmluZygpO1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgICAgIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcbiAgICAgIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgICAgIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICAgICAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gICAgICB1bC5hcHBlbmRDaGlsZChsaSlcblxuICAgICAgLy8gU2hvdyBPZmZsaW5lIEFsZXJ0XG4gICAgICBjb25zdCBvZmZsaW5lQWxlcnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm9mZmxpbmUtYWxlcnRcIilcbiAgICAgIG9mZmxpbmVBbGVydC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgICAvLyBXYWl0IHVudGlsIGNsaWVudCBpcyBiYWNrIG9ubGluZVxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIChldmVudCkgPT4ge1xuICAgICAgICAvLyBHZXR0aW5nIGRhdGEgZnJvbSBsb2NhbFN0b3JhZ2VcbiAgICAgICAgbGV0IHJldmlldyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGEnKSlcbiAgICAgICAgLy8gU2VuZGluZyByZXZpZXcgdG8gdGhlIHNlcnZlclxuICAgICAgICBwb3N0UmV2aWV3KHJldmlldylcblxuICAgICAgICAvLyBSZW1vdmUgb2ZmbGluZSBub3RpdGljYXRpb25cbiAgICAgICAgb2ZmbGluZUFsZXJ0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgICAgICAvLyBSZW1vdmUgbG9jYWxTdG9yYWdlIGRhdGFcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2RhdGEnKVxuICAgICAgfSlcbiAgICB9XG4gIH0iLCJsZXQgcmVzdGF1cmFudHMsXG4gIG5laWdoYm9yaG9vZHMsXG4gIGN1aXNpbmVzXG52YXIgbWFwXG52YXIgbWFya2VycyA9IFtdXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENoZWNraW5nIGlmIFNlcnZpY2UgV29ya2VyIGlzIGF2YWlibGVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zZXJ2aWNlLXdvcmtlci5qcycsIHtcbiAgICAgIHNjb3BlOiAnLi8nXG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XG4gICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBSZWdpc3RlcicpO1xuICAgIH0pXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICB9KVxufSBlbHNlIHtcbiAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgbm90IHN1cHBvcnRlZC4nKTtcbn1cblxuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFzeW5jIChldmVudCkgPT4ge1xuICBhd2FpdCBmZXRjaE5laWdoYm9yaG9vZHMoKTtcbiAgZmV0Y2hDdWlzaW5lcygpO1xufSk7XG5cbi8qKlxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKG5laWdoYm9yaG9vZHMpXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IHJlc3VsdHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG59XG5cbi8qKlxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cbiAqL1xuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuZmV0Y2hDdWlzaW5lcyA9IChjdWlzaW5lcykgPT4ge1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoY3Vpc2luZXMpXG4gICAgLnRoZW4oKHJlc3V0bHMpID0+IHtcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSByZXN1dGxzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbn1cblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGxldCBsb2MgPSB7XG4gICAgbGF0OiA0MC43MjIyMTYsXG4gICAgbG5nOiAtNzMuOTg3NTAxXG4gIH07XG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICB6b29tOiAxMixcbiAgICBjZW50ZXI6IGxvYyxcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgfSk7XG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59XG5cbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcblxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcblxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZClcbiAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICByZXNldFJlc3RhdXJhbnRzKHJlc3VsdHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSlcbn1cblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIGNvbnN0IGltYWdlSUQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KTtcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7XG4gIGNvbnN0IHNvdXJjZUxhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGNvbnN0IGZpZ0NhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XG5cbiAgc291cmNlTGFyZ2Uuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWluLXdpZHRoOiA1MDFweCknKTtcbiAgc291cmNlTGFyZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZUlEfV9sYXJnZV8yeC5qcGcgMngsICR7aW1hZ2VJRH1fbGFyZ2VfMXguanBnYCk7XG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1heC13aWR0aDogNTAwcHgpJyk7XG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7aW1hZ2VJRH1fc21hbGxfMnguanBnIDJ4LCAke2ltYWdlSUR9X3NtYWxsXzF4LmpwZ2ApO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCByZXN0YXVyYW50Lm5hbWUpXG4gIGZpZ0NhcHRpb24udGV4dENvbnRlbnQgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGZpZ3VyZS5hcHBlbmQocGljdHVyZSk7XG4gIGZpZ3VyZS5hcHBlbmQoZmlnQ2FwdGlvbilcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlTGFyZ2UpO1xuICBwaWN0dXJlLmFwcGVuZChzb3VyY2VTbWFsbCk7XG4gIHBpY3R1cmUuYXBwZW5kKGltYWdlKTtcbiAgbGkuYXBwZW5kKGZpZ3VyZSk7XG5cblxuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IGlzRmF2b3JpdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgaXNGYXZvcml0ZS5pbm5lckhUTUwgPSAnJmhlYXJ0czsnO1xuICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ2lzRmF2b3JpdGUnKVxuICAvLyBTZXQgc3R5bGVzIGRlcGVuZGluZyBpZiBpcyBmYXZvcml0ZSBvciBub3RcbiAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09ICd0cnVlJyB8IHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT09IHRydWUpIHtcbiAgICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ3llc0ZhdicpXG4gICAgY29uc29sZS5sb2coYFN0YXR1cyBmb3IgJHtyZXN0YXVyYW50LmlkfSBpcyB0cnVlIGFkIHR5cGUgaXMgJHt0eXBlb2YocmVzdGF1cmFudC5pc19mYXZvcml0ZSl9YCk7XG4gIH0gZWxzZSBpZihyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAnZmFsc2UnIHwgcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PT0gZmFsc2UpIHtcbiAgICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ3llc0ZhdicpXG4gICAgY29uc29sZS5sb2coYFN0YXR1cyBmb3IgJHtyZXN0YXVyYW50LmlkfSBpcyBmYWxzZSBhZCB0eXBlIGlzICR7dHlwZW9mKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpfWApO1xuICB9XG5cbiAgLy8gVXBkYXRpbmcgZGF0YSBiYXNlIGJhc2Ugb24gZmF2b3JpdGUgc3RhdHVzXG4gIGlzRmF2b3JpdGUub25jbGljayA9ICgpID0+IHtcbiAgICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC50b2dnbGUoJ3llc0ZhdicpXG4gICAgY29uc3QgY3VycmVudEZhdlN0YXR1cyA9ICFKU09OLnBhcnNlKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpO1xuICAgIGNvbnNvbGUubG9nKGN1cnJlbnRGYXZTdGF0dXMpO1xuICAgIHVwZGF0ZUZhdm9yaXRlU3RhdHVzKHJlc3RhdXJhbnQuaWQsIGN1cnJlbnRGYXZTdGF0dXMpO1xuICAgIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBjdXJyZW50RmF2U3RhdHVzXG4gICAgY29uc29sZS5sb2cocmVzdGF1cmFudC5pc19mYXZvcml0ZSk7XG4gIH1cbiAgbGkuYXBwZW5kKGlzRmF2b3JpdGUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGxpLmFwcGVuZChtb3JlKVxuXG4gIHJldHVybiBsaVxufVxuXG4vKipcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXG4gKi9cbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufSJdfQ==
