async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function storeAllReviews(t,e){let a=await idb.open(`reviews-db-id:${e}`,1,t=>t.createObjectStore(`reviews-id:${e}`,{keyPath:"id"})),r=a.transaction(`reviews-id:${e}`,"readwrite"),n=r.objectStore(`reviews-id:${e}`);t.forEach(t=>{n.put(t)}),await r.complete,a.close()}async function getReviewsByRestaurantId(t){let e=await idb.open(`reviews-db-id:${t}`,1),a=e.transaction(`reviews-id:${t}`,"readonly").objectStore(`reviews-id:${t}`),r=await a.getAll();return e.close(),r}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function postReview(t){await fetch("http://localhost:1337/reviews",{method:"POST",body:JSON.stringify(t),headers:new Headers({"Content-Type":"application/json"})})}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=await idb.open("restaurants-db",1),r=a.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");n.get(t).then(t=>{t.is_favorite=e,n.put(t)}),await r.complete,a.close()}async function fetchReviewsById(t){let e=await fetch(`http://localhost:1337/reviews/?restaurant_id=${t}`);if(200===e.status){const a=await e.json();return await storeAllReviews(a,t),a}throw new Error("Resquest of reviews has failed")}const toggleFavClassAndElement=(t,e)=>{"true"===t|!0===t?(e.classList.add("yesFav"),e.setAttribute("aria-label","remove as favorite")):(e.classList.remove("yesFav"),e.setAttribute("aria-label","remove as favorite"))};class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static async sendOfflineData(t){localStorage.setItem("data",JSON.stringify(t));const e=document.getElementById("reviews-list"),a=document.createElement("li"),r=document.createElement("p");r.innerHTML=t.name,a.appendChild(r);const n=document.createElement("p");n.innerHTML=(new Date).toDateString(),a.appendChild(n);const s=document.createElement("p");s.innerHTML=`Rating: ${t.rating}`,a.appendChild(s);const o=document.createElement("p");o.innerHTML=t.comments,a.appendChild(o),e.appendChild(a);const i=document.getElementById("offline-alert");i.style.display="block",window.addEventListener("online",t=>{postReview(JSON.parse(localStorage.getItem("data"))),i.style.display="none",localStorage.removeItem("data")})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})});const fakeMap=document.getElementById("map-button").addEventListener("click",()=>{const e=document.getElementById("toggle-container"),t=document.getElementById("map-container");e.classList.add("hide-container"),t.classList.add("show-container")});window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,s=t.selectedIndex,a=e[n].value,o=t[s].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,o).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant_responsive(e),s=document.createElement("figure"),a=document.createElement("picture"),o=document.createElement("source"),r=document.createElement("source"),c=document.createElement("img"),l=document.createElement("figcaption");o.setAttribute("class","lazyload"),o.setAttribute("media","(min-width: 501px)"),o.setAttribute("data-srcset",`${n}_large_2x.jpg 2x, ${n}_large_1x.jpg`),r.setAttribute("class","lazyload"),r.setAttribute("media","(max-width: 500px)"),r.setAttribute("data-srcset",`${n}_small_2x.jpg 2x, ${n}_small_1x.jpg`),c.className="restaurant-img lazyload",c.setAttribute("data-src",`${DBHelper.imageUrlForRestaurant(e)}`),c.setAttribute("alt",e.name),l.textContent=e.name,s.append(a),s.append(l),a.append(o),a.append(r),a.append(c),t.append(s);const i=document.createElement("h1");i.innerHTML=e.name,t.append(i);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),toggleFavClassAndElement(e.is_favorite,d),d.onclick=(()=>{const t=!JSON.parse(e.is_favorite);console.log(t),updateFavoriteStatus(e.id,t),e.is_favorite=t,toggleFavClassAndElement(e.is_favorite,d)}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const m=document.createElement("p");m.innerHTML=e.address,t.append(m);const p=document.createElement("a");return p.innerHTML="View Details",p.href=DBHelper.urlForRestaurant(e),t.append(p),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJzdG9yZUFsbFJldmlld3MiLCJyZXZpZXdzIiwiaWQiLCJyZXZpZXciLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJhbGxTYXZlZEl0ZW1zIiwiZ2V0QWxsIiwiZ2V0QWxsUmVzdGF1cmFudHMiLCJwb3N0UmV2aWV3IiwiZmV0Y2giLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImhlYWRlcnMiLCJIZWFkZXJzIiwiQ29udGVudC1UeXBlIiwidXBkYXRlRmF2b3JpdGVTdGF0dXMiLCJyZXN0YXVyYW50SWQiLCJmYXZvcml0ZVN0YXR1cyIsImdldCIsInRoZW4iLCJyZXN0dXJhbnQiLCJpc19mYXZvcml0ZSIsImZldGNoUmV2aWV3c0J5SWQiLCJyZXZpZXdSZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJFcnJvciIsInRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudCIsImVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzZXRBdHRyaWJ1dGUiLCJyZW1vdmUiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsInJlc3RhdXJhbnRSZXNwb25zZSIsImZldGNoUmVzdGF1cmFudHMiLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJlcnIiLCJmaW5kIiwiciIsIm5laWdoYm9yaG9vZCIsImZpbHRlciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5kZWZpbmVkIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsInVsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImxpIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiZGF0ZSIsIkRhdGUiLCJ0b0RhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsIm9mZmxpbmVBbGVydCIsInN0eWxlIiwiZGlzcGxheSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInBhcnNlIiwiZ2V0SXRlbSIsInJlbW92ZUl0ZW0iLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwic2NvcGUiLCJyZWdpc3RyYXRpb24iLCJlIiwiZXJyb3IiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsInNlbGVjdCIsIm9wdGlvbiIsInZhbHVlIiwiYXBwZW5kIiwicmVzdXRscyIsImZpbGxDdWlzaW5lc0hUTUwiLCJmYWtlTWFwIiwidG9nZ2xlQ29udGFpbmVyIiwiZ29vZ2xlTWFwQ29udGFpbmVyIiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJpbWFnZUlEIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUiLCJmaWd1cmUiLCJwaWN0dXJlIiwic291cmNlTGFyZ2UiLCJzb3VyY2VTbWFsbCIsImltYWdlIiwiZmlnQ2FwdGlvbiIsImNsYXNzTmFtZSIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInRleHRDb250ZW50IiwiaXNGYXZvcml0ZSIsIm9uY2xpY2siLCJjdXJyZW50RmF2U3RhdHVzIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJwdXNoIl0sIm1hcHBpbmdzIjoiQUFHRUEsZUFBZUMsbUJBQW1CQyxHQUNoQyxJQUFJQyxRQUFXQyxJQUFJQyxLQUFLLGlCQUFrQixFQUFHQyxHQUFhQSxFQUFVQyxrQkFBa0IsY0FBZSxDQUNuR0MsUUFBUyxRQUdQQyxFQUFLTixFQUFHTyxZQUFZLGNBQWUsYUFDbkNDLEVBQVFGLEVBQUdHLFlBQVksZUFFM0JWLEVBQVlXLFFBQVFDLElBQ2xCSCxFQUFNSSxJQUFJRCxXQUdOTCxFQUFHTyxTQUNUYixFQUFHYyxRQU1MakIsZUFBZWtCLGdCQUFnQkMsRUFBU0MsR0FDdEMsSUFBSWpCLFFBQVdDLElBQUlDLHNCQUFzQmUsSUFBTSxFQUFHZCxHQUFhQSxFQUFVQyxnQ0FBZ0NhLElBQU0sQ0FDN0daLFFBQVMsUUFHUEMsRUFBS04sRUFBR08sMEJBQTBCVSxJQUFNLGFBQ3hDVCxFQUFRRixFQUFHRywwQkFBMEJRLEtBQ3pDRCxFQUFRTixRQUFRUSxJQUNkVixFQUFNSSxJQUFJTSxXQUdOWixFQUFHTyxTQUNUYixFQUFHYyxRQUdMakIsZUFBZXNCLHlCQUF5QkYsR0FDdEMsSUFBSWpCLFFBQVdDLElBQUlDLHNCQUFzQmUsSUFBTSxHQUczQ1QsRUFES1IsRUFBR08sMEJBQTBCVSxJQUFNLFlBQzdCUiww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T3dDLEdBRVYsTUFBTUMsRUFBTzVFLFNBQVNHLGNBQWMsS0FLcEMsT0FKQXlFLEVBQUt4RSxVQUFZLGVBQ2pCd0UsRUFBS0MsS0FBT3BILFNBQVNnQyxpQkFBaUJ2RSxHQUN0Q2dGLEVBQUdpQyxPQUFPeUMsR0FFSDFFLElBTVQwRCxnQkFBa0IsRUFBQ3RKLEVBQWN3SCxLQUFLeEgsZUFDcENBLEVBQVlXLFFBQVFDLElBRWxCLE1BQU00SixFQUFTckgsU0FBU3NILHVCQUF1QjdKLEVBQVk0RyxLQUFLcEQsS0FDaEVPLE9BQU9DLEtBQUs4QixNQUFNZ0UsWUFBWUYsRUFBUSxRQUFTLEtBQzdDaEUsT0FBT21FLFNBQVNKLEtBQU9DLEVBQU90RixNQUVoQ3NDLEtBQUtWLFFBQVE4RCxLQUFLSiIsImZpbGUiOiJyZXN0YXVyYW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIiAgLyoqXG4gICAqIENyZWF0ZSByZXN0YXVyYW50cyBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlUmVzdGF1cmFudHNEYihyZXN0YXVyYW50cykge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgICAga2V5UGF0aDogJ2lkJ1xuICAgIH0pKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcblxuICAgIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIHJldmlld3MgYnkgcmVzdGF1cmFudCBpZCBpbiBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzLCBpZCkge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKGByZXZpZXdzLWRiLWlkOiR7aWR9YCwgMSwgdXBncmFkZURCID0+IHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZShgcmV2aWV3cy1pZDoke2lkfWAsIHtcbiAgICAgIGtleVBhdGg6ICdpZCdcbiAgICB9KSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKGByZXZpZXdzLWlkOiR7aWR9YCwgJ3JlYWR3cml0ZScpXG4gICAgbGV0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoYHJldmlld3MtaWQ6JHtpZH1gKVxuICAgIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgICAgc3RvcmUucHV0KHJldmlldylcbiAgICB9KTtcblxuICAgIGF3YWl0IHR4LmNvbXBsZXRlXG4gICAgZGIuY2xvc2UoKVxuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gZ2V0UmV2aWV3c0J5UmVzdGF1cmFudElkKGlkKSB7XG4gICAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oYHJldmlld3MtZGItaWQ6JHtpZH1gLCAxKVxuXG4gICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oYHJldmlld3MtaWQ6JHtpZH1gLCAncmVhZG9ubHknKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKGByZXZpZXdzLWlkOiR7aWR9YClcblxuICAgIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICAgIGRiLmNsb3NlKClcblxuICAgIHJldHVybiBhbGxTYXZlZEl0ZW1zXG4gIH1cblxuICAvKipcbiAgICogUmV0cml2ZSBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIGdldEFsbFJlc3RhdXJhbnRzKCkge1xuICAgIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEpXG5cbiAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZG9ubHknKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgICBsZXQgYWxsU2F2ZWRJdGVtcyA9IGF3YWl0IHN0b3JlLmdldEFsbCgpXG5cbiAgICBkYi5jbG9zZSgpXG5cbiAgICByZXR1cm4gYWxsU2F2ZWRJdGVtc1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3JlIGFsbCByZXN0YXVyYW50cyBpbiBJbmRleGVkREIuXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpIHtcbiAgICBsZXQgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCB1cGdyYWRlREIgPT4gdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcbiAgICAgIGtleVBhdGg6ICdpZCdcbiAgICB9KSlcblxuICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxuICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xuICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0eC5jb21wbGV0ZVxuICAgIGRiLmNsb3NlKClcbiAgfVxuXG4gIC8qKlxuICAgKiBQT1NUIG5ldyByZXZpZXdcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIHBvc3RSZXZpZXcocmV2aWV3KSB7XG4gICAgYXdhaXQgZmV0Y2goJ2h0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzJywge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXZpZXcpLFxuICAgICAgaGVhZGVyczogbmV3IEhlYWRlcnMoe1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVGYXZvcml0ZVN0YXR1cyhyZXN0YXVyYW50SWQsIGZhdm9yaXRlU3RhdHVzKSB7XG4gICAgYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnRJZH0vP2lzX2Zhdm9yaXRlPSR7ZmF2b3JpdGVTdGF0dXN9YCwge1xuICAgICAgbWV0aG9kOiAnUFVUJ1xuICAgIH0pO1xuXG4gICAgY29uc3QgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxKTtcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcbiAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xuXG4gICAgc3RvcmUuZ2V0KHJlc3RhdXJhbnRJZClcbiAgICAgIC50aGVuKHJlc3R1cmFudCA9PiB7XG4gICAgICAgIHJlc3R1cmFudC5pc19mYXZvcml0ZSA9IGZhdm9yaXRlU3RhdHVzO1xuICAgICAgICBzdG9yZS5wdXQocmVzdHVyYW50KTtcbiAgICAgIH0pO1xuXG4gICAgYXdhaXQgdHguY29tcGxldGU7XG4gICAgZGIuY2xvc2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgRmF2b3JpdGUgU3RhdHVzIGluIGEgcmVzdGF1cmFudFxuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hSZXZpZXdzQnlJZChpZCkge1xuICAgIGxldCByZXZpZXdSZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8/cmVzdGF1cmFudF9pZD0ke2lkfWApXG4gICAgaWYgKHJldmlld1Jlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCByZXZpZXdzID0gYXdhaXQgcmV2aWV3UmVzcG9uc2UuanNvbigpXG4gICAgICBhd2FpdCBzdG9yZUFsbFJldmlld3MocmV2aWV3cywgaWQpXG4gICAgICByZXR1cm4gcmV2aWV3c1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Jlc3F1ZXN0IG9mIHJldmlld3MgaGFzIGZhaWxlZCcpXG4gICAgfVxuICB9XG4gICAgLyoqXG4gICAqIFVwZGF0ZSBGYXZvcml0ZSBTdGF0dXMgaW4gYSByZXN0YXVyYW50XG4gICAqL1xuICBjb25zdCB0b2dnbGVGYXZDbGFzc0FuZEVsZW1lbnQgPSAoc3RhdHVzLCBlbGVtZW50KSA9PiB7XG5cbiAgICBpZiAoc3RhdHVzID09PSAndHJ1ZScgfCBzdGF0dXMgPT09IHRydWUpIHtcbiAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgneWVzRmF2JylcbiAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ3JlbW92ZSBhcyBmYXZvcml0ZScpXG4gICAgfSBlbHNlICB7XG4gICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3llc0ZhdicpXG4gICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdyZW1vdmUgYXMgZmF2b3JpdGUnKVxuICAgIH1cbiAgfVxuXG4gIGNsYXNzIERCSGVscGVyIHtcblxuICAgIC8qKlxuICAgICAqIERhdGFiYXNlIFVSTC5cbiAgICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXG4gICAgICovXG4gICAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgICBjb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRzKCkge1xuICAgICAgLy8gRmV0Y2ggcmVzdHVyYW50cyBkYXRhIGJhc2VcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH1gKVxuXG4gICAgICBpZiAocmVzdGF1cmFudFJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgcmVzdGF1cmFudFJlc3BvbnNlLmpzb24oKVxuICAgICAgICAvLyBzdG9yZSByZXN0YXVyYW50IGRhdGEgYmFzZSBpbnRvIEluZGV4ZWREQlxuICAgICAgICBhd2FpdCBzdG9yZVJlc3RhdXJhbnRzRGIocmVzdGF1cmFudHMpXG4gICAgICAgIC8vIC8vIGZldGNoIGFuZCBzdG9yZSBhbGwgcmV2aWV3c1xuICAgICAgICAvLyBjb25zdCByZXZpZXdSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0RCSGVscGVyLlJFVklFV0RBVEFfVVJMfWApXG5cbiAgICAgICAgLy8gaWYgKHJldmlld1Jlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIC8vICAgY29uc3QgcmV2aWV3cyA9IGF3YWl0IHJldmlld1Jlc3BvbnNlLmpzb24oKVxuICAgICAgICAvLyAgIGF3YWl0IHN0b3JlQWxsUmV2aWV3cyhyZXZpZXdzKVxuICAgICAgICAvLyB9IGVsc2Uge1xuICAgICAgICAvLyAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBvZiByZXZpZXdzIGhhcyBmYWlsZWQnKVxuICAgICAgICAvLyB9XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50c1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IG9mIHJlc3RhdXJhbnRzIGhhcyBmYWlsZWQnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkKSB7XG5cbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKVxuICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKVxuICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICogV09SS0lOR1xuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QpIHtcblxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICByZXR1cm4gcmVzdWx0c1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdOZWlnYm9yaG9vZCBkb2VzIG5vdCBleGlzdCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKiBXT1JLSU5HXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcbiAgICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICAgIH0pXG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgICAgaWYgKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudHMgd2l0aCBjdWlzaW5lIGFuZCBuZWlnaGJvcmhvb2QgY29uYmluYXRpb24gZG9lcyBub3QgZXhpc3QnKVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqIFdPUktJTkdcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgZmV0Y2hOZWlnaGJvcmhvb2RzKCkge1xuICAgICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3InLCBlcnIpO1xuICAgICAgfSlcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgICAgY29uc3QgcmVzdGF1cmFudHMgPSBhd2FpdCBnZXRBbGxSZXN0YXVyYW50cygpO1xuXG4gICAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZClcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpXG5cbiAgICAgICAgcmV0dXJuIHVuaXF1ZU5laWdoYm9yaG9vZHNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIGF0IGZldGNoaW5nIGFsbCBuZWlnaGJvcmhvb2RzJylcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIGZldGNoQ3Vpc2luZXMoKSB7XG4gICAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgICB9KVxuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzIGZyb20gSW5kZXhlZERCXG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKVxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXG5cbiAgICAgICAgcmV0dXJuIHVuaXF1ZUN1aXNpbmVzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgY3Vpc2luZScpXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICAgKi9cbiAgICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxuICAgICAqL1xuICAgIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xuICAgICAgY29uc3QgcGhvdG8gPSByZXN0YXVyYW50LnBob3RvZ3JhcGg7XG5cbiAgICAgIGlmIChwaG90byA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiAoYC9pbWcvZXJyb3IuanBnYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNwb25zaXZlIGltYWdlIG9ubHkgZ2V0cyB0aGUgbmFtZSBvZiB0aGUgcGljdHVyZSBieSBpZCB3aWhvdXQgZ2V0dGluZyB0aGUgZXh0ZW5zaW9uLCBleHRlbnNpb24gd2lsbCBiZSBhZGRlZCBpbiBsYXRlclxuICAgICAqIEVycm9yIGNoZWNraW5nIGR1ZSB0byByZXN0YXVyYW50ICMxMCBkb2VzIG5vdCBoYXZlIGEgcGhvdG8gcHJvcGVydHlcbiAgICAgKi9cbiAgICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50X3Jlc3BvbnNpdmUocmVzdGF1cmFudCkge1xuXG4gICAgICBjb25zdCBwaG90byA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblxuICAgICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIChgaW1nL3Jlc3BvbnNpdmVfaW1nL2Vycm9yYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gKGBpbWcvcmVzcG9uc2l2ZV9pbWcvJHtyZXN0YXVyYW50LmlkfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICAgKi9cbiAgICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcbiAgICAgICAgbWFwOiBtYXAsXG4gICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICB9XG5cbiAgICBzdGF0aWMgYXN5bmMgc2VuZE9mZmxpbmVEYXRhKHJldmlldykge1xuICAgICAgLy8gU3RvcmUgdGhlIHJldmlldyBvbiBsb2NhbCBzdG9yYWdlXG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGF0YScsIEpTT04uc3RyaW5naWZ5KHJldmlldykpO1xuXG4gICAgICAvLyBCdWlsZCB0ZW1wb3JhcnkgVUkgYW5kIGFwcGVuZCB0byB0aGUgYWxyZWFkeSBsaXN0IG9mIHJldmlld3NcbiAgICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICAgICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gICAgICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgICAgIGxpLmFwcGVuZENoaWxkKG5hbWUpXG5cbiAgICAgIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICBkYXRlLmlubmVySFRNTCA9IG5ldyBEYXRlKCkudG9EYXRlU3RyaW5nKCk7XG4gICAgICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcblxuICAgICAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgICAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICAgICAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICAgICAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gICAgICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgICAgIHVsLmFwcGVuZENoaWxkKGxpKVxuXG4gICAgICAvLyBTaG93IE9mZmxpbmUgQWxlcnRcbiAgICAgIGNvbnN0IG9mZmxpbmVBbGVydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib2ZmbGluZS1hbGVydFwiKVxuICAgICAgb2ZmbGluZUFsZXJ0LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgICAgIC8vIFdhaXQgdW50aWwgY2xpZW50IGlzIGJhY2sgb25saW5lXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgKGV2ZW50KSA9PiB7XG4gICAgICAgIC8vIEdldHRpbmcgZGF0YSBmcm9tIGxvY2FsU3RvcmFnZVxuICAgICAgICBsZXQgcmV2aWV3ID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZGF0YScpKVxuICAgICAgICAvLyBTZW5kaW5nIHJldmlldyB0byB0aGUgc2VydmVyXG4gICAgICAgIHBvc3RSZXZpZXcocmV2aWV3KVxuXG4gICAgICAgIC8vIFJlbW92ZSBvZmZsaW5lIG5vdGl0aWNhdGlvblxuICAgICAgICBvZmZsaW5lQWxlcnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXG4gICAgICAgIC8vIFJlbW92ZSBsb2NhbFN0b3JhZ2UgZGF0YVxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZGF0YScpXG4gICAgICB9KVxuICAgIH1cbiAgfSIsImxldCByZXN0YXVyYW50cyxcbiAgbmVpZ2hib3Job29kcyxcbiAgY3Vpc2luZXNcbnZhciBtYXBcbnZhciBtYXJrZXJzID0gW11cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ2hlY2tpbmcgaWYgU2VydmljZSBXb3JrZXIgaXMgYXZhaWJsZVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcuL3NlcnZpY2Utd29ya2VyLmpzJywge1xuICAgICAgc2NvcGU6ICcuLydcbiAgICB9KVxuICAgIC50aGVuKGZ1bmN0aW9uIChyZWdpc3RyYXRpb24pIHtcbiAgICAgIGNvbnNvbGUubG9nKCdTZXJ2aWNlV29ya2VyIFJlZ2lzdGVyJyk7XG4gICAgfSlcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgIH0pXG59IGVsc2Uge1xuICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBub3Qgc3VwcG9ydGVkLicpO1xufVxuXG4vKipcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxuICovXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXN5bmMgKGV2ZW50KSA9PiB7XG4gIGF3YWl0IGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgLy8gRE9ORVxuICBEQkhlbHBlci5mZXRjaE5laWdoYm9yaG9vZHMobmVpZ2hib3Job29kcylcbiAgICAudGhlbigocmVzdWx0cykgPT4ge1xuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gcmVzdWx0cztcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbn1cblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcbiAgbmVpZ2hib3Job29kcy5mb3JFYWNoKG5laWdoYm9yaG9vZCA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcbiAgICBvcHRpb24udmFsdWUgPSBuZWlnaGJvcmhvb2Q7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn1cblxuLyoqXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaEN1aXNpbmVzID0gKGN1aXNpbmVzKSA9PiB7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcyhjdWlzaW5lcylcbiAgICAudGhlbigocmVzdXRscykgPT4ge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IHJlc3V0bHM7XG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59XG5cbi8qKlxuICogV2lsbCBpbml0aWFsaXplIEdvZ2dsZSBNYXAgYW5kIHdpbGwgaGlkZSBmYWtlIG1hcFxuICovXG5cbmNvbnN0IGZha2VNYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWJ1dHRvbicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjb25zdCB0b2dnbGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLWNvbnRhaW5lcicpO1xuICBjb25zdCBnb29nbGVNYXBDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpXG5cbiAgdG9nZ2xlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGUtY29udGFpbmVyJyk7XG4gIGdvb2dsZU1hcENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzaG93LWNvbnRhaW5lcicpO1xufSlcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBsZXQgbG9jID0ge1xuICAgIGxhdDogNDAuNzIyMjE2LFxuICAgIGxuZzogLTczLjk4NzUwMVxuICB9O1xuICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICB1cGRhdGVSZXN0YXVyYW50cygpO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXG4gKi9cbnVwZGF0ZVJlc3RhdXJhbnRzID0gKCkgPT4ge1xuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjb25zdCBuU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG5cbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xuICBjb25zdCBuSW5kZXggPSBuU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcbiAgY29uc3QgbmVpZ2hib3Job29kID0gblNlbGVjdFtuSW5kZXhdLnZhbHVlO1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdWx0cyk7XG4gICAgICBmaWxsUmVzdGF1cmFudHNIVE1MKCk7XG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KVxufVxuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuICBzZWxmLm1hcmtlcnMgPSBbXTtcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xuICB9KTtcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cbiAqL1xuY3JlYXRlUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgY29uc3QgaW1hZ2VJRCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpO1xuICBjb25zdCBmaWd1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWd1cmUnKTtcbiAgY29uc3QgcGljdHVyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3BpY3R1cmUnKTtcbiAgY29uc3Qgc291cmNlTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3Qgc291cmNlU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgY29uc3QgZmlnQ2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ZpZ2NhcHRpb24nKTtcblxuICBzb3VyY2VMYXJnZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2xhenlsb2FkJyk7XG4gIHNvdXJjZUxhcmdlLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1pbi13aWR0aDogNTAxcHgpJyk7XG4gIHNvdXJjZUxhcmdlLnNldEF0dHJpYnV0ZSgnZGF0YS1zcmNzZXQnLCBgJHtpbWFnZUlEfV9sYXJnZV8yeC5qcGcgMngsICR7aW1hZ2VJRH1fbGFyZ2VfMXguanBnYCk7XG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbGF6eWxvYWQnKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWF4LXdpZHRoOiA1MDBweCknKTtcbiAgc291cmNlU21hbGwuc2V0QXR0cmlidXRlKCdkYXRhLXNyY3NldCcsIGAke2ltYWdlSUR9X3NtYWxsXzJ4LmpwZyAyeCwgJHtpbWFnZUlEfV9zbWFsbF8xeC5qcGdgKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nIGxhenlsb2FkJztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIGAke0RCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KX1gKTtcbiAgLy8gaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgcmVzdGF1cmFudC5uYW1lKVxuICBmaWdDYXB0aW9uLnRleHRDb250ZW50ID0gcmVzdGF1cmFudC5uYW1lO1xuICBmaWd1cmUuYXBwZW5kKHBpY3R1cmUpO1xuICBmaWd1cmUuYXBwZW5kKGZpZ0NhcHRpb24pXG4gIHBpY3R1cmUuYXBwZW5kKHNvdXJjZUxhcmdlKTtcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlU21hbGwpO1xuICBwaWN0dXJlLmFwcGVuZChpbWFnZSk7XG4gIGxpLmFwcGVuZChmaWd1cmUpO1xuXG5cblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGxpLmFwcGVuZChuYW1lKTtcblxuICBjb25zdCBpc0Zhdm9yaXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XG4gIGlzRmF2b3JpdGUuaW5uZXJIVE1MID0gJyZoZWFydHM7JztcbiAgaXNGYXZvcml0ZS5jbGFzc0xpc3QuYWRkKCdpc0Zhdm9yaXRlJylcbiAgLy8gU2V0IHN0eWxlcyBkZXBlbmRpbmcgaWYgaXMgZmF2b3JpdGUgb3Igbm90XG4gIHRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlLCBpc0Zhdm9yaXRlKVxuXG4gIC8vIFVwZGF0aW5nIGRhdGEgYmFzZSBiYXNlIG9uIGZhdm9yaXRlIHN0YXR1c1xuICBpc0Zhdm9yaXRlLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgLy8gaXNGYXZvcml0ZS5jbGFzc0xpc3QudG9nZ2xlKCd5ZXNGYXYnKVxuICAgIGNvbnN0IGN1cnJlbnRGYXZTdGF0dXMgPSAhSlNPTi5wYXJzZShyZXN0YXVyYW50LmlzX2Zhdm9yaXRlKTtcbiAgICBjb25zb2xlLmxvZyhjdXJyZW50RmF2U3RhdHVzKTtcbiAgICB1cGRhdGVGYXZvcml0ZVN0YXR1cyhyZXN0YXVyYW50LmlkLCBjdXJyZW50RmF2U3RhdHVzKTtcbiAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gY3VycmVudEZhdlN0YXR1c1xuICAgIC8vIFNldCBzdHlsZXMgZGVwZW5kaW5nIGlmIGlzIGZhdm9yaXRlIG9yIG5vdFxuICAgIHRvZ2dsZUZhdkNsYXNzQW5kRWxlbWVudChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlLCBpc0Zhdm9yaXRlKVxuICB9XG4gIGxpLmFwcGVuZChpc0Zhdm9yaXRlKTtcblxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcbiAgbGkuYXBwZW5kKG5laWdoYm9yaG9vZCk7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcblxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBsaS5hcHBlbmQobW9yZSlcblxuICByZXR1cm4gbGlcbn1cblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCAoKSA9PiB7XG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcbiAgICB9KTtcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICB9KTtcbn0iXX0=
