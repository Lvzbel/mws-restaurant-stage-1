async function storeRestaurantsDb(t){let e=await idb.open("restaurants-db",1,t=>t.createObjectStore("restaurants",{keyPath:"id"})),a=e.transaction("restaurants","readwrite"),r=a.objectStore("restaurants");t.forEach(t=>{r.put(t)}),await a.complete,e.close()}async function getAllRestaurants(){let t=await idb.open("restaurants-db",1),e=t.transaction("restaurants","readonly").objectStore("restaurants"),a=await e.getAll();return t.close(),a}async function updateFavoriteStatus(t,e){await fetch(`http://localhost:1337/restaurants/${t}/?is_favorite=${e}`,{method:"PUT"});const a=(await idb.open("restaurants-db",1)).transaction("restaurants","readwrite").objectStore("restaurants");a.get(t).then(t=>{t.is_favorite=e,a.put(t)})}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static async fetchRestaurants(){const t=await fetch(`${DBHelper.DATABASE_URL}`);if(200===t.status){const e=await t.json();return await storeRestaurantsDb(e),e}throw new Error("Request of restaurants has failed")}static async fetchRestaurantById(t){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const e=(await getAllRestaurants()).find(e=>e.id==t);if(e)return e;throw new Error("Restaurant does not exist")}static async fetchRestaurantByNeighborhood(t){const e=await getAllRestaurants();if(e){return e.filter(e=>e.neighborhood==t)}throw new Error("Neigborhood does not exist")}static async fetchRestaurantByCuisineAndNeighborhood(t,e){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const a=await getAllRestaurants();if(a){let r=a;return"all"!=t&&(r=r.filter(e=>e.cuisine_type==t)),"all"!=e&&(r=r.filter(t=>t.neighborhood==e)),r}throw new Error("Restaurants with cuisine and neighborhood conbination does not exist")}static async fetchNeighborhoods(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].neighborhood);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all neighborhoods")}static async fetchCuisines(){await DBHelper.fetchRestaurants().then(t=>{console.log(t)}).catch(t=>{console.log("Error",t)});const t=await getAllRestaurants();if(t){const e=t.map((e,a)=>t[a].cuisine_type);return e.filter((t,a)=>e.indexOf(t)==a)}throw new Error("Failed at fetching all cuisine")}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return void 0===t.photograph?"/img/error.jpg":`/img/${t.photograph}.jpg`}static imageUrlForRestaurant_responsive(t){return void 0===t.photograph?"img/responsive_img/error":`img/responsive_img/${t.id}`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}}
let restaurants,neighborhoods,cuisines;var map,markers=[];navigator.serviceWorker?navigator.serviceWorker.register("./service-worker.js",{scope:"./"}).then(function(e){console.log("ServiceWorker Register")}).catch(function(e){console.log("error"),console.error(e)}):console.log("ServiceWorker not supported."),document.addEventListener("DOMContentLoaded",async e=>{await fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods(neighborhoods).then(e=>{self.neighborhoods=e,fillNeighborhoodsHTML()}).catch(e=>{console.log(e)})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),fetchCuisines=(e=>{DBHelper.fetchCuisines(e).then(e=>{self.cuisines=e,fillCuisinesHTML()}).catch(e=>{console.log(e)})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const s=document.createElement("option");s.innerHTML=e,s.value=e,t.append(s)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),s=e.selectedIndex,n=t.selectedIndex,r=e[s].value,a=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(r,a).then(e=>{resetRestaurants(e),fillRestaurantsHTML()}).catch(e=>{console.log(e)})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li"),s=DBHelper.imageUrlForRestaurant_responsive(e),n=document.createElement("figure"),r=document.createElement("picture"),a=document.createElement("source"),o=document.createElement("source"),c=document.createElement("img"),l=document.createElement("figcaption");a.setAttribute("media","(min-width: 501px)"),a.setAttribute("srcset",`${s}_large_2x.jpg 2x, ${s}_large_1x.jpg`),o.setAttribute("media","(max-width: 500px)"),o.setAttribute("srcset",`${s}_small_2x.jpg 2x, ${s}_small_1x.jpg`),c.className="restaurant-img",c.src=DBHelper.imageUrlForRestaurant(e),c.setAttribute("alt",e.name),l.textContent=e.name,n.append(r),n.append(l),r.append(a),r.append(o),r.append(c),t.append(n);const i=document.createElement("h1");i.innerHTML=e.name,t.append(i);const d=document.createElement("button");d.innerHTML="&hearts;",d.classList.add("isFavorite"),e.is_favorite?(d.classList.add("yesFav"),console.log(`Status for ${e.id} is true`)):(d.classList.remove("yesFav"),console.log(`Status for ${e.id} is false`)),d.onclick=(()=>{const t=!e.is_favorite;updateFavoriteStatus(e.id,t),d.classList.toggle("yesFav")}),t.append(d);const u=document.createElement("p");u.innerHTML=e.neighborhood,t.append(u);const m=document.createElement("p");m.innerHTML=e.address,t.append(m);const p=document.createElement("a");return p.innerHTML="View Details",p.href=DBHelper.urlForRestaurant(e),t.append(p),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJhc3luYyIsInN0b3JlUmVzdGF1cmFudHNEYiIsInJlc3RhdXJhbnRzIiwiZGIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwiY3JlYXRlT2JqZWN0U3RvcmUiLCJrZXlQYXRoIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2xvc2UiLCJnZXRBbGxSZXN0YXVyYW50cyIsImFsbFNhdmVkSXRlbXMiLCJnZXRBbGwiLCJ1cGRhdGVGYXZvcml0ZVN0YXR1cyIsInJlc3RhdXJhbnRJZCIsImZhdm9yaXRlU3RhdHVzIiwiZmV0Y2giLCJtZXRob2QiLCJnZXQiLCJ0aGVuIiwicmVzdHVyYW50IiwiaXNfZmF2b3JpdGUiLCJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsInJlc3BvbnNlIiwic3RhdHVzIiwianNvbiIsIkVycm9yIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwiY29uc29sZSIsImxvZyIsImNhdGNoIiwiZXJyIiwiZmluZCIsInIiLCJuZWlnaGJvcmhvb2QiLCJmaWx0ZXIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuZGVmaW5lZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzY29wZSIsInJlZ2lzdHJhdGlvbiIsImUiLCJlcnJvciIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJnZXRFbGVtZW50QnlJZCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJ2YWx1ZSIsImFwcGVuZCIsInJlc3V0bHMiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJtIiwic2V0TWFwIiwidWwiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwiaW1hZ2VJRCIsImltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlIiwiZmlndXJlIiwicGljdHVyZSIsInNvdXJjZUxhcmdlIiwic291cmNlU21hbGwiLCJpbWFnZSIsImZpZ0NhcHRpb24iLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJ0ZXh0Q29udGVudCIsImlzRmF2b3JpdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJvbmNsaWNrIiwiY3VycmVudEZhdlN0YXR1cyIsInRvZ2dsZSIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBTUFBLGVBQWVDLG1CQUFtQkMsR0FDaEMsSUFBSUMsUUFBV0MsSUFBSUMsS0FB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RXJCdEgsRUFBV2UsYUFDYnFHLEVBQVdDLFVBQVVDLElBQUksVUFDekI3RixRQUFRQyxrQkFBa0IxQixFQUFXdUIsZ0JBRXJDNkYsRUFBV0MsVUFBVUUsT0FBTyxVQUM1QjlGLFFBQVFDLGtCQUFrQjFCLEVBQVd1QixnQkFJdkM2RixFQUFXSSxRQUFVLE1BQ25CLE1BQU1DLEdBQW9CekgsRUFBV2UsWUFDckNSLHFCQUFxQlAsRUFBV3VCLEdBQUlrRyxHQUNwQ0wsRUFBV0MsVUFBVUssT0FBTyxZQUU5QnBCLEVBQUd6QixPQUFPdUMsR0FFVixNQUFNckYsRUFBZWlDLFNBQVNVLGNBQWMsS0FDNUMzQyxFQUFhNEMsVUFBWTNFLEVBQVcrQixhQUNwQ3VFLEVBQUd6QixPQUFPOUMsR0FFVixNQUFNNEYsRUFBVTNELFNBQVNVLGNBQWMsS0FDdkNpRCxFQUFRaEQsVUFBWTNFLEVBQVcySCxRQUMvQnJCLEVBQUd6QixPQUFPOEMsR0FFVixNQUFNQyxFQUFPNUQsU0FBU1UsY0FBYyxLQUtwQyxPQUpBa0QsRUFBS2pELFVBQVksZUFDakJpRCxFQUFLQyxLQUFPN0csU0FBU29DLGlCQUFpQnBELEdBQ3RDc0csRUFBR3pCLE9BQU8rQyxHQUVIdEIsSUFNVEQsZ0JBQWtCLEVBQUNqSCxFQUFjaUYsS0FBS2pGLGVBQ3BDQSxFQUFZVyxRQUFRQyxJQUVsQixNQUFNOEgsRUFBUzlHLFNBQVMrRyx1QkFBdUIvSCxFQUFZcUUsS0FBS2hDLEtBQ2hFTyxPQUFPQyxLQUFLcUIsTUFBTThELFlBQVlGLEVBQVEsUUFBUyxLQUM3QzlDLE9BQU9pRCxTQUFTSixLQUFPQyxFQUFPM0UsTUFFaENrQixLQUFLYixRQUFRMEUsS0FBS0oiLCJmaWxlIjoicmVzdGF1cmFudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsZXQgcmVzdGF1cmFudHNcblxuLy8gY29uc3QgZGVmaW5lUmVzdCA9IGFzeW5jICgpID0+IHtcbi8vICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKClcbi8vICAgcmVzdGF1cmFudHMgPSAgcmVzdWx0c1xuLy8gfVxuYXN5bmMgZnVuY3Rpb24gc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKSB7XG4gIGxldCBkYiA9IGF3YWl0IGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIHVwZ3JhZGVEQiA9PiB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xuICAgIGtleVBhdGg6ICdpZCdcbiAgfSkpXG5cbiAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXG4gIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXG5cbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICBzdG9yZS5wdXQocmVzdGF1cmFudClcbiAgfSk7XG5cbiAgYXdhaXQgdHguY29tcGxldGVcbiAgZGIuY2xvc2UoKVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbGxSZXN0YXVyYW50cygpIHtcbiAgbGV0IGRiID0gYXdhaXQgaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSlcblxuICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZG9ubHknKVxuICBsZXQgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxuXG4gIGxldCBhbGxTYXZlZEl0ZW1zID0gYXdhaXQgc3RvcmUuZ2V0QWxsKClcblxuICBkYi5jbG9zZSgpXG5cbiAgcmV0dXJuIGFsbFNhdmVkSXRlbXNcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRmF2b3JpdGVTdGF0dXMocmVzdGF1cmFudElkLCBmYXZvcml0ZVN0YXR1cykge1xuICBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jlc3RhdXJhbnRzLyR7cmVzdGF1cmFudElkfS8/aXNfZmF2b3JpdGU9JHtmYXZvcml0ZVN0YXR1c31gLCB7XG4gICAgbWV0aG9kOiAnUFVUJ1xuICB9KTtcbiAgY29uc3QgZGIgPSBhd2FpdCBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxKTtcbiAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XG4gIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XG5cbiAgc3RvcmUuZ2V0KHJlc3RhdXJhbnRJZClcbiAgICAudGhlbihyZXN0dXJhbnQgPT4ge1xuICAgICAgcmVzdHVyYW50LmlzX2Zhdm9yaXRlID0gZmF2b3JpdGVTdGF0dXM7XG4gICAgICBzdG9yZS5wdXQocmVzdHVyYW50KTtcbiAgICB9KTtcbn1cblxuY2xhc3MgREJIZWxwZXIge1xuXG4gIC8qKlxuICAgKiBEYXRhYmFzZSBVUkwuXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cbiAgICovXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xuICAgIGNvbnN0IHBvcnQgPSAxMzM3IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKiBXT1JLSU5HXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZmV0Y2hSZXN0YXVyYW50cygpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0RCSGVscGVyLkRBVEFCQVNFX1VSTH1gKVxuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKVxuICAgICAgYXdhaXQgc3RvcmVSZXN0YXVyYW50c0RiKHJlc3RhdXJhbnRzKVxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVxdWVzdCBvZiByZXN0YXVyYW50cyBoYXMgZmFpbGVkJylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICogV09SS0lOR1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQpIHtcblxuICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICB9KVxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKVxuICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZClcbiAgICBpZiAocmVzdGF1cmFudCkge1xuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqIFdPUktJTkdcbiAgICovXG4gIHN0YXRpYyBhc3luYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QpIHtcblxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICByZXR1cm4gcmVzdWx0c1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05laWdib3Job29kIGRvZXMgbm90IGV4aXN0JylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICogV09SS0lOR1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcbiAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgfSlcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcbiAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgfVxuICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRzXG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVzdGF1cmFudHMgd2l0aCBjdWlzaW5lIGFuZCBuZWlnaGJvcmhvb2QgY29uYmluYXRpb24gZG9lcyBub3QgZXhpc3QnKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICogV09SS0lOR1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGZldGNoTmVpZ2hib3Job29kcygpIHtcbiAgICBhd2FpdCBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKCkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHJlc3RhdXJhbnRzKVxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdFcnJvcicsIGVycik7XG4gICAgfSlcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgZnJvbSBJbmRleGVkREJcbiAgICBjb25zdCByZXN0YXVyYW50cyA9IGF3YWl0IGdldEFsbFJlc3RhdXJhbnRzKCk7XG5cbiAgICBpZiAocmVzdGF1cmFudHMpIHtcbiAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xuICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKVxuICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXG4gICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKVxuXG4gICAgICByZXR1cm4gdW5pcXVlTmVpZ2hib3Job29kc1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgbmVpZ2hib3Job29kcycpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBmZXRjaEN1aXNpbmVzKCkge1xuICAgIGF3YWl0IERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgY29uc29sZS5sb2cocmVzdGF1cmFudHMpXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbiAgICB9KVxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyBmcm9tIEluZGV4ZWREQlxuICAgIGNvbnN0IHJlc3RhdXJhbnRzID0gYXdhaXQgZ2V0QWxsUmVzdGF1cmFudHMoKTtcblxuICAgIGlmIChyZXN0YXVyYW50cykge1xuICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSlcbiAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXG5cbiAgICAgIHJldHVybiB1bmlxdWVDdWlzaW5lc1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCBhdCBmZXRjaGluZyBhbGwgY3Vpc2luZScpXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXG4gICAqL1xuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgKiBFcnJvciBjaGVja2luZyBkdWUgdG8gcmVzdGF1cmFudCAjMTAgZG9lcyBub3QgaGF2ZSBhIHBob3RvIHByb3BlcnR5XG4gICAqL1xuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICBjb25zdCBwaG90byA9IHJlc3RhdXJhbnQucGhvdG9ncmFwaDtcblxuICAgIGlmIChwaG90byA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gKGAvaW1nL2Vycm9yLmpwZ2ApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS5qcGdgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzcG9uc2l2ZSBpbWFnZSBvbmx5IGdldHMgdGhlIG5hbWUgb2YgdGhlIHBpY3R1cmUgYnkgaWQgd2lob3V0IGdldHRpbmcgdGhlIGV4dGVuc2lvbiwgZXh0ZW5zaW9uIHdpbGwgYmUgYWRkZWQgaW4gbGF0ZXJcbiAgICogRXJyb3IgY2hlY2tpbmcgZHVlIHRvIHJlc3RhdXJhbnQgIzEwIGRvZXMgbm90IGhhdmUgYSBwaG90byBwcm9wZXJ0eVxuICAgKi9cbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudF9yZXNwb25zaXZlKHJlc3RhdXJhbnQpIHtcblxuICAgIGNvbnN0IHBob3RvID0gcmVzdGF1cmFudC5waG90b2dyYXBoO1xuXG4gICAgaWYgKHBob3RvID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiAoYGltZy9yZXNwb25zaXZlX2ltZy9lcnJvcmApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gKGBpbWcvcmVzcG9uc2l2ZV9pbWcvJHtyZXN0YXVyYW50LmlkfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXG4gICAqL1xuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXG4gICAgICBtYXA6IG1hcCxcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcbiAgICB9KTtcbiAgICByZXR1cm4gbWFya2VyO1xuICB9XG59XG5cbi8vIGFzeW5jICgpID0+IHtcbi8vIE1ha2VzIGluaXRpYWwgZmV0Y2ggcmVxdWVzdCBhbmQgc2F2ZXMgaXQgaW50byBJbmRleGVkREJcbi8vICAgYXdhaXQgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oKHJlc3RhdXJhbnRzKSA9Pntcbi8vICAgICBjb25zb2xlLmxvZyhyZXN0YXVyYW50cylcbi8vICAgfSkuY2F0Y2goKGVycikgPT57XG4vLyAgICAgY29uc29sZS5sb2coJ0Vycm9yJywgZXJyKTtcbi8vICAgfSlcbi8vIH0iLCJsZXQgcmVzdGF1cmFudHMsXG4gIG5laWdoYm9yaG9vZHMsXG4gIGN1aXNpbmVzXG52YXIgbWFwXG52YXIgbWFya2VycyA9IFtdXG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENoZWNraW5nIGlmIFNlcnZpY2UgV29ya2VyIGlzIGF2YWlibGVcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zZXJ2aWNlLXdvcmtlci5qcycsIHtcbiAgICAgIHNjb3BlOiAnLi8nXG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbiAocmVnaXN0cmF0aW9uKSB7XG4gICAgICBjb25zb2xlLmxvZygnU2VydmljZVdvcmtlciBSZWdpc3RlcicpO1xuICAgIH0pXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICB9KVxufSBlbHNlIHtcbiAgY29uc29sZS5sb2coJ1NlcnZpY2VXb3JrZXIgbm90IHN1cHBvcnRlZC4nKTtcbn1cblxuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFzeW5jIChldmVudCkgPT4ge1xuICBhd2FpdCBmZXRjaE5laWdoYm9yaG9vZHMoKTtcbiAgZmV0Y2hDdWlzaW5lcygpO1xufSk7XG5cbi8qKlxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5mZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKG5laWdoYm9yaG9vZHMpXG4gICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IHJlc3VsdHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0pXG59XG5cbi8qKlxuICogU2V0IG5laWdoYm9yaG9vZHMgSFRNTC5cbiAqL1xuZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25laWdoYm9yaG9vZHMtc2VsZWN0Jyk7XG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59XG5cbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuZmV0Y2hDdWlzaW5lcyA9IChjdWlzaW5lcykgPT4ge1xuICAvLyBET05FXG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoY3Vpc2luZXMpXG4gICAgLnRoZW4oKHJlc3V0bHMpID0+IHtcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSByZXN1dGxzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSlcbn1cblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG4gIGN1aXNpbmVzLmZvckVhY2goY3Vpc2luZSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XG4gICAgb3B0aW9uLnZhbHVlID0gY3Vpc2luZTtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufVxuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGxldCBsb2MgPSB7XG4gICAgbGF0OiA0MC43MjIyMTYsXG4gICAgbG5nOiAtNzMuOTg3NTAxXG4gIH07XG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcbiAgICB6b29tOiAxMixcbiAgICBjZW50ZXI6IGxvYyxcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgfSk7XG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59XG5cbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xudXBkYXRlUmVzdGF1cmFudHMgPSAoKSA9PiB7XG4gIGNvbnN0IGNTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcblxuICBjb25zdCBjSW5kZXggPSBjU2VsZWN0LnNlbGVjdGVkSW5kZXg7XG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcblxuICBjb25zdCBjdWlzaW5lID0gY1NlbGVjdFtjSW5kZXhdLnZhbHVlO1xuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XG4gIC8vIERPTkVcbiAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZClcbiAgLnRoZW4oKHJlc3VsdHMpID0+IHtcbiAgICByZXNldFJlc3RhdXJhbnRzKHJlc3VsdHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgfSlcbn1cblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cbnJlc2V0UmVzdGF1cmFudHMgPSAocmVzdGF1cmFudHMpID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcbiAgdWwuaW5uZXJIVE1MID0gJyc7XG5cbiAgLy8gUmVtb3ZlIGFsbCBtYXAgbWFya2Vyc1xuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcbiAgc2VsZi5tYXJrZXJzID0gW107XG4gIHNlbGYucmVzdGF1cmFudHMgPSByZXN0YXVyYW50cztcbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKi9cbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIGNvbnN0IGltYWdlSUQgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnRfcmVzcG9uc2l2ZShyZXN0YXVyYW50KTtcbiAgY29uc3QgZmlndXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmlndXJlJyk7XG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7XG4gIGNvbnN0IHNvdXJjZUxhcmdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIGNvbnN0IHNvdXJjZVNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGNvbnN0IGZpZ0NhcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmaWdjYXB0aW9uJyk7XG5cbiAgc291cmNlTGFyZ2Uuc2V0QXR0cmlidXRlKCdtZWRpYScsICcobWluLXdpZHRoOiA1MDFweCknKTtcbiAgc291cmNlTGFyZ2Uuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBgJHtpbWFnZUlEfV9sYXJnZV8yeC5qcGcgMngsICR7aW1hZ2VJRH1fbGFyZ2VfMXguanBnYCk7XG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnbWVkaWEnLCAnKG1heC13aWR0aDogNTAwcHgpJyk7XG4gIHNvdXJjZVNtYWxsLnNldEF0dHJpYnV0ZSgnc3Jjc2V0JywgYCR7aW1hZ2VJRH1fc21hbGxfMnguanBnIDJ4LCAke2ltYWdlSUR9X3NtYWxsXzF4LmpwZ2ApO1xuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZShcImFsdFwiLCByZXN0YXVyYW50Lm5hbWUpXG4gIGZpZ0NhcHRpb24udGV4dENvbnRlbnQgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGZpZ3VyZS5hcHBlbmQocGljdHVyZSk7XG4gIGZpZ3VyZS5hcHBlbmQoZmlnQ2FwdGlvbilcbiAgcGljdHVyZS5hcHBlbmQoc291cmNlTGFyZ2UpO1xuICBwaWN0dXJlLmFwcGVuZChzb3VyY2VTbWFsbCk7XG4gIHBpY3R1cmUuYXBwZW5kKGltYWdlKTtcbiAgbGkuYXBwZW5kKGZpZ3VyZSk7XG5cblxuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IGlzRmF2b3JpdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgaXNGYXZvcml0ZS5pbm5lckhUTUwgPSAnJmhlYXJ0czsnO1xuICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ2lzRmF2b3JpdGUnKVxuICAvLyBTZXQgc3R5bGVzIGRlcGVuZGluZyBpZiBpcyBmYXZvcml0ZSBvciBub3RcbiAgaWYgKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUpIHtcbiAgICBpc0Zhdm9yaXRlLmNsYXNzTGlzdC5hZGQoJ3llc0ZhdicpXG4gICAgY29uc29sZS5sb2coYFN0YXR1cyBmb3IgJHtyZXN0YXVyYW50LmlkfSBpcyB0cnVlYCk7XG4gIH0gZWxzZSB7XG4gICAgaXNGYXZvcml0ZS5jbGFzc0xpc3QucmVtb3ZlKCd5ZXNGYXYnKVxuICAgIGNvbnNvbGUubG9nKGBTdGF0dXMgZm9yICR7cmVzdGF1cmFudC5pZH0gaXMgZmFsc2VgKTtcbiAgfVxuXG4gIC8vIFVwZGF0aW5nIGRhdGEgYmFzZSBiYXNlIG9uIGZhdm9yaXRlIHN0YXR1c1xuICBpc0Zhdm9yaXRlLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgY29uc3QgY3VycmVudEZhdlN0YXR1cyA9ICFyZXN0YXVyYW50LmlzX2Zhdm9yaXRlO1xuICAgIHVwZGF0ZUZhdm9yaXRlU3RhdHVzKHJlc3RhdXJhbnQuaWQsIGN1cnJlbnRGYXZTdGF0dXMpO1xuICAgIGlzRmF2b3JpdGUuY2xhc3NMaXN0LnRvZ2dsZSgneWVzRmF2Jyk7XG4gIH1cbiAgbGkuYXBwZW5kKGlzRmF2b3JpdGUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGxpLmFwcGVuZChtb3JlKVxuXG4gIHJldHVybiBsaVxufVxuXG4vKipcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXG4gKi9cbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybFxuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufSJdfQ==
