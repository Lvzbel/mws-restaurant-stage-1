let restaurant;var map;async function fillReviewsHTML(e){let t;const n=document.getElementById("reviews-container"),r=document.createElement("h2");r.innerHTML="Reviews",r.setAttribute("id","review-title"),n.appendChild(r),await fetchReviewsById(e);const a=await getReviewsByRestaurantId(e);if(!a)throw new Error("Reviews does not exist");t=a.filter(t=>t.restaurant_id==e);if(!t){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const i=document.getElementById("reviews-list");t.forEach(e=>{i.appendChild(createReviewHTML(e))}),n.appendChild(i)}async function addReview(){event.preventDefault();let e=getParameterByName("id");const t={restaurant_id:e,name:document.getElementById("reviewer").value,rating:document.querySelector("#rating-selection option:checked").value,comments:document.getElementById("review-comments").value};if(!navigator.onLine)return void DBHelper.sendOfflineData(t);await postReview(t);const n=document.getElementById("review-title");n.parentNode.removeChild(n),document.getElementById("reviews-list").innerHTML="",fillReviewsHTML(e)}window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{let t;if(self.restaurant)return void e(null,self.restaurant);const n=getParameterByName("id");n?DBHelper.fetchRestaurantById(n).then(n=>{t=n,self.restaurant=t,fillRestaurantHTML(),e(null,t)}).catch(e=>{console.log(e)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e.id)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwiYXN5bmMiLCJmaWxsUmV2aWV3c0hUTUwiLCJyZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZmV0Y2hSZXZpZXdzQnlJZCIsImFsbFJldmlld3MiLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJFcnJvciIsImZpbHRlciIsInIiLCJyZXN0YXVyYW50X2lkIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFkZFJldmlldyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidmFsdWUiLCJyYXRpbmciLCJxdWVyeVNlbGVjdG9yIiwiY29tbWVudHMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJEQkhlbHBlciIsInNlbmRPZmZsaW5lRGF0YSIsInBvc3RSZXZpZXciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwiY29uc29sZSIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJpZCIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJ0aGVuIiwicmVzdWx0IiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibGkiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVzdWx0cyIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQ0osSUFBSUMsSUErRkpDLGVBQWVDLGdCQUFnQkMsR0FDN0IsSUFBSUMsRUFDSixNQUFNQyxFQUFZQyxTQUFTQyxlQUFlLHFCQUNwQ0MsRUFBUUYsU0FBU0csY0FBYyxNQUNyQ0QsRUFBTUUsVUFBWSxVQUNsQkYsRUFBTUcsYUFBYSxLQUFNLGdCQUN6Qk4sRUFBVU8sWUFBWUosU0FJaEJLLGlCQUFpQlYsR0FFdkIsTUFBTVcsUUFBbUJDLHlCQUF5QlosR0FFbEQsSUFBSVcsRUFJRixNQUFNLElBQUlFLE1BQU0sMEJBRmhCWixFQURnQlUsRUFBV0csT0FBT0MsR0FBS0EsRUFBRUMsZUFBaUJoQixHQU01RCxJQUFLQyxFQUFTLENBQ1osTUFBTWdCLEVBQVlkLFNBQVNHLGNBQWMsS0FHekMsT0FGQVcsRUFBVVYsVUFBWSx1QkFDdEJMLEVBQVVPLFlBQVlRLEdBR3hCLE1BQU1DLEVBQUtmLFNBQVNDLGVBQWUsZ0JBQ25DSCxFQUFRa0IsUUFBUUMsSUFDZEYsRUFBR1QsWUFBWVksaUJBQWlCRCxNQUVsQ2xCLEVBQVVPLFlBQVlTLEdBd0R4QnBCLGVBQWV3QixZQUViQyxNQUFNQyxpQkFFTixJQUFJeEIsRUFBZXlCLG1CQUFtQixNQUl0QyxNQUFNTCxFQUFTLENBQ2JKLGNBQWlCaEIsRUFDakIwQixLQUxTdkIsU0FBU0MsZUFBZSxZQUFZdUIsTUFNN0NDLE9BTFd6QixTQUFTMEIsY0FBYyxvQ0FBb0NGLE1B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QWMsTUFDbENzRSxFQUFHckUsVUFBWVgsRUFBVzhCLEtBQzFCdUQsRUFBV3hFLFlBQVltRSxLQU16Qm5ELG1CQUFxQixFQUFDQyxFQUFNd0QsS0FDckJBLElBQ0hBLEVBQU01QyxPQUFPNkMsU0FBU0MsTUFDeEIxRCxFQUFPQSxFQUFLMkQsUUFBUSxVQUFXLFFBQy9CLE1BQ0VDLEVBRFksSUFBSUMsY0FBYzdELHNCQUNkOEQsS0FBS04sR0FDdkIsT0FBS0ksRUFFQUEsRUFBUSxHQUVORyxtQkFBbUJILEVBQVEsR0FBR0QsUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xyXG52YXIgbWFwO1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cclxuICovXHJcbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgICAgICB6b29tOiAxNixcclxuICAgICAgICBjZW50ZXI6IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxyXG4gICAgICB9KTtcclxuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcclxuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCBjdXJyZW50IHJlc3RhdXJhbnQgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcclxuICBsZXQgcmVzdGF1cmFudFxyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkudGhlbigocmVzdWx0KSA9PiB7XHJcbiAgICAgIHJlc3RhdXJhbnQgPSByZXN1bHRcclxuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudFxyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcclxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKVxyXG4gICAgfSlcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcclxuICovXHJcbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnXHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIHJlc3RhdXJhbnQubmFtZSlcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3cyBuZXdlciB2ZXJzaW9ucyBub3cgbmVlZHMgcmVzdGF1cmFudCBpZCB0byBwYXNzZWRcclxuICBmaWxsUmV2aWV3c0hUTUwocmVzdGF1cmFudC5pZCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnRJZCkge1xyXG4gIGxldCByZXZpZXdzO1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XHJcbiAgdGl0bGUuc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJyZXZpZXctdGl0bGVcIik7XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuICAvLyBUaGlzIGZ1bmN0aW9uIHdhcyBtb2RpZmllZCB0byBiZSBhYmxlIHRvIGdldCBhbGxyZXZpZXdzIGZyb21cclxuXHJcbiAgLy8gRmV0Y2ggYWxsIHJldmlld3Mgb2YgY2VydGFpbiByZXN0YXVyYW50XHJcbiAgYXdhaXQgZmV0Y2hSZXZpZXdzQnlJZChyZXN0YXVyYW50SWQpO1xyXG5cclxuICBjb25zdCBhbGxSZXZpZXdzID0gYXdhaXQgZ2V0UmV2aWV3c0J5UmVzdGF1cmFudElkKHJlc3RhdXJhbnRJZCk7XHJcblxyXG4gIGlmIChhbGxSZXZpZXdzKSB7XHJcbiAgICBjb25zdCByZXN1bHRzID0gYWxsUmV2aWV3cy5maWx0ZXIociA9PiByLnJlc3RhdXJhbnRfaWQgPT0gcmVzdGF1cmFudElkKTtcclxuICAgIHJldmlld3MgPSByZXN1bHRzXHJcbiAgfSBlbHNlIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignUmV2aWV3cyBkb2VzIG5vdCBleGlzdCcpXHJcbiAgfVxyXG5cclxuICBpZiAoIXJldmlld3MpIHtcclxuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgfSk7XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gbmV3IERhdGUocmV2aWV3LnVwZGF0ZWRBdCkudG9EYXRlU3RyaW5nKCk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XHJcblxyXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgdGhlIHZhbHVlcyBmcm9tIHRoZSByZXZpZXcgZm9ybVxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gYWRkUmV2aWV3KCkge1xyXG4gIC8vIFByZXZlbnRpbmcgZGVmYXVsIGJlaGF2aW9yXHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAvLyBSZXRyaXZpbmcgbmVzc2VzYXJ5IGRhdGEgZnJvbSBvdXIgZm9ybVxyXG4gIGxldCByZXN0YXVyYW50SWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XHJcbiAgbGV0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3ZXInKS52YWx1ZTtcclxuICBsZXQgcmF0aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JhdGluZy1zZWxlY3Rpb24gb3B0aW9uOmNoZWNrZWQnKS52YWx1ZTtcclxuICBsZXQgY29tbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LWNvbW1lbnRzJykudmFsdWVcclxuICBjb25zdCByZXZpZXcgPSB7XHJcbiAgICAncmVzdGF1cmFudF9pZCc6IHJlc3RhdXJhbnRJZCxcclxuICAgICduYW1lJzogbmFtZSxcclxuICAgICdyYXRpbmcnOiByYXRpbmcsXHJcbiAgICAnY29tbWVudHMnOiBjb21tZW50c1xyXG4gIH1cclxuXHJcbiAgLy8gQ2hlY2tpbmcgaWYgY2xpZW50IGlzIG9ubGluZVxyXG4gIGlmICghbmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgREJIZWxwZXIuc2VuZE9mZmxpbmVEYXRhKHJldmlldyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIFxyXG4gIGF3YWl0IHBvc3RSZXZpZXcocmV2aWV3KTtcclxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctdGl0bGUnKTtcclxuICB0aXRsZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRpdGxlKTtcclxuICBjb25zdCByZXZpZXdzQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICByZXZpZXdzQ29udGVudC5pbm5lckhUTUwgPSBcIlwiO1xyXG4gIGZpbGxSZXZpZXdzSFRNTChyZXN0YXVyYW50SWQpXHJcbn0iXX0=
