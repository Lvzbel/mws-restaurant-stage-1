let restaurant;var map;async function fillReviewsHTML(e){let t;const n=document.getElementById("reviews-container"),r=document.createElement("h2");r.innerHTML="Reviews",r.setAttribute("id","review-title"),n.appendChild(r),await fetchReviewsById(e);const a=await getReviewsByRestaurantId(e);if(!a)throw new Error("Reviews does not exist");t=a.filter(t=>t.restaurant_id==e);if(!t){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void n.appendChild(e)}const i=document.getElementById("reviews-list");t.forEach(e=>{i.appendChild(createReviewHTML(e))}),n.appendChild(i)}async function addReview(){event.preventDefault();let e=getParameterByName("id");const t={restaurant_id:e,name:document.getElementById("reviewer").value,rating:document.querySelector("#rating-selection option:checked").value,comments:document.getElementById("review-comments").value};if(!navigator.onLine)return void DBHelper.sendOfflineData(t);await postReview(t);const n=document.getElementById("review-title");n.parentNode.removeChild(n),document.getElementById("reviews-list").innerHTML="",fillReviewsHTML(e)}window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{let t;if(self.restaurant)return void e(null,self.restaurant);const n=getParameterByName("id");n?DBHelper.fetchRestaurantById(n).then(n=>{t=n,self.restaurant=t,fillRestaurantHTML(),e(null,t)}).catch(e=>{console.log(e)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.setAttribute("alt",e.name),t.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML(e.id)}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwiYXN5bmMiLCJmaWxsUmV2aWV3c0hUTUwiLCJyZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInRpdGxlIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiZmV0Y2hSZXZpZXdzQnlJZCIsImFsbFJldmlld3MiLCJnZXRSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJFcnJvciIsImZpbHRlciIsInIiLCJyZXN0YXVyYW50X2lkIiwibm9SZXZpZXdzIiwidWwiLCJmb3JFYWNoIiwicmV2aWV3IiwiY3JlYXRlUmV2aWV3SFRNTCIsImFkZFJldmlldyIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidmFsdWUiLCJyYXRpbmciLCJxdWVyeVNlbGVjdG9yIiwiY29tbWVudHMiLCJuYXZpZ2F0b3IiLCJvbkxpbmUiLCJEQkhlbHBlciIsInNlbmRPZmZsaW5lRGF0YSIsInBvc3RSZXZpZXciLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsImVycm9yIiwiY29uc29sZSIsInNlbGYiLCJnb29nbGUiLCJtYXBzIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdGxuZyIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbGJhY2siLCJpZCIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJ0aGVuIiwicmVzdWx0IiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiY2F0Y2giLCJlcnIiLCJsb2ciLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJjdWlzaW5lX3R5cGUiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJkYXkiLCJ0aW1lIiwibGkiLCJkYXRlIiwiRGF0ZSIsInVwZGF0ZWRBdCIsInRvRGF0ZVN0cmluZyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVzdWx0cyIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFdBQ0osSUFBSUMsSUErRkpDLGVBQWVDLGdCQUFnQkMsR0FDN0IsSUFBSUMsRUFDSixNQUFNQyxFQUFZQyxTQUFTQyxlQUFlLHFCQUNwQ0MsRUFBUUYsU0FBU0csY0FBYyxNQUNyQ0QsRUFBTUUsVUFBWSxVQUNsQkYsRUFBTUcsYUFBYSxLQUFNLGdCQUN6Qk4sRUFBVU8sWUFBWUosU0FJaEJLLGlCQUFpQlYsR0FFdkIsTUFBTVcsUUFBbUJDLHlCQUF5QlosR0FFbEQsSUFBSVcsRUFJRixNQUFNLElBQUlFLE1BQU0sMEJBRmhCWixFQURnQlUsRUFBV0csT0FBT0MsR0FBS0EsRUFBRUMsZUFBaUJoQixHQU01RCxJQUFLQyxFQUFTLENBQ1osTUFBTWdCLEVBQVlkLFNBQVNHLGNBQWMsS0FHekMsT0FGQVcsRUFBVVYsVUFBWSx1QkFDdEJMLEVBQVVPLFlBQVlRLEdBR3hCLE1BQU1DLEVBQUtmLFNBQVNDLGVBQWUsZ0JBQ25DSCxFQUFRa0IsUUFBUUMsSUFDZEYsRUFBR1QsWUFBWVksaUJBQWlCRCxNQUVsQ2xCLEVBQVVPLFlBQVlTLEdBd0R4QnBCLGVBQWV3QixZQUViQyxNQUFNQyxpQkFFTixJQUFJeEIsRUFBZXlCLG1CQUFtQixNQUl0QyxNQUFNTCxFQUFTLENBQ2JKLGNBQWlCaEIsRUFDakIwQixLQUxTdkIsU0FBU0MsZUFBZSxZQUFZdUIsTUFNN0NDLE9BTFd6QixTQUFTMEIsY0FBYyxvQ0FBb0NGLE1BTXRFRyxTQUxhM0IsU0FBU0MsZUFBZSxtQkFBbUJ1QixPQVMxRCxJQUFLSSxVQUFVQyxPQUViLFlBREFDLFNBQVNDLGdCQUFnQmQsU0FJckJlLFdBQVdmLEdBQ2pCLE1BQU1mLEVBQVFGLFNBQVNDLGVBQWUsZ0JBQ3RDQyxFQUFNK0IsV0FBV0MsWUFBWWhDLEdBQ05GLFNBQVNDLGVBQWUsZ0JBQ2hDRyxVQUFZLEdBQzNCUixnQkFBZ0JDLEdBM01sQnNDLE9BQU9DLFFBQVUsTUFDZkMsdUJBQXVCLENBQUNDLEVBQU83QyxLQUN6QjZDLEVBQ0ZDLFFBQVFELE1BQU1BLElBRWRFLEtBQUs5QyxJQUFNLElBQUkrQyxPQUFPQyxLQUFLQyxJQUFJM0MsU0FBU0MsZUFBZSxPQUFRLENBQzdEMkMsS0FBTSxHQUNOQyxPQUFRcEQsRUFBV3FELE9BQ25CQyxhQUFhLElBRWZDLGlCQUNBbEIsU0FBU21CLHVCQUF1QlQsS0FBSy9DLFdBQVkrQyxLQUFLOUMsVUFRNUQyQyx1QkFBeUIsQ0FBQ2EsSUFDeEIsSUFBSXpELEVBQ0osR0FBSStDLEtBQUsvQyxXQUVQLFlBREF5RCxFQUFTLEtBQU1WLEtBQUsvQyxZQUd0QixNQUFNMEQsRUFBSzdCLG1CQUFtQixNQUN6QjZCLEVBSUhyQixTQUFTc0Isb0JBQW9CRCxHQUFJRSxLQUFNQyxJQUNyQzdELEVBQWE2RCxFQUNiZCxLQUFLL0MsV0FBYUEsRUFDbEI4RCxxQkFDQUwsRUFBUyxLQUFNekQsS0FDZCtELE1BQU9DLElBQ1JsQixRQUFRbUIsSUFBSUQsTUFUZG5CLE1BQVEsMEJBQ1JZLEVBQVNaLE1BQU8sU0FnQnBCaUIsbUJBQXFCLEVBQUM5RCxFQUFhK0MsS0FBSy9DLGNBQ3pCTyxTQUFTQyxlQUFlLG1CQUNoQ0csVUFBWVgsRUFBVzhCLEtBRVp2QixTQUFTQyxlQUFlLHNCQUNoQ0csVUFBWVgsRUFBV2tFLFFBRS9CLE1BQU1DLEVBQVE1RCxTQUFTQyxlQUFlLGtCQUN0QzJELEVBQU1DLFVBQVksaUJBQ2xCRCxFQUFNdkQsYUFBYSxNQUFPWixFQUFXOEIsTUFDckNxQyxFQUFNRSxJQUFNaEMsU0FBU2lDLHNCQUFzQnRFLEdBRTNCTyxTQUFTQyxlQUFlLHNCQUNoQ0csVUFBWVgsRUFBV3VFLGFBRzNCdkUsRUFBV3dFLGlCQUNiQywwQkFHRnRFLGdCQUFnQkgsRUFBVzBELE1BTTdCZSx3QkFBMEIsRUFBQ0MsRUFBaUIzQixLQUFLL0MsV0FBV3dFLG1CQUMxRCxNQUFNRyxFQUFRcEUsU0FBU0MsZUFBZSxvQkFDdEMsSUFBSyxJQUFJb0UsS0FBT0YsRUFBZ0IsQ0FDOUIsTUFBTUcsRUFBTXRFLFNBQVNHLGNBQWMsTUFFN0JvRSxFQUFNdkUsU0FBU0csY0FBYyxNQUNuQ29FLEVBQUluRSxVQUFZaUUsRUFDaEJDLEVBQUloRSxZQUFZaUUsR0FFaEIsTUFBTUMsRUFBT3hFLFNBQVNHLGNBQWMsTUFDcENxRSxFQUFLcEUsVUFBWStELEVBQWVFLEdBQ2hDQyxFQUFJaEUsWUFBWWtFLEdBRWhCSixFQUFNOUQsWUFBWWdFLE1BNEN0QnBELGlCQUFtQixDQUFDRCxJQUNsQixNQUFNd0QsRUFBS3pFLFNBQVNHLGNBQWMsTUFDNUJvQixFQUFPdkIsU0FBU0csY0FBYyxLQUNwQ29CLEVBQUtuQixVQUFZYSxFQUFPTSxLQUN4QmtELEVBQUduRSxZQUFZaUIsR0FFZixNQUFNbUQsRUFBTzFFLFNBQVNHLGNBQWMsS0FDcEN1RSxFQUFLdEUsVUFBWSxJQUFJdUUsS0FBSzFELEVBQU8yRCxXQUFXQyxlQUM1Q0osRUFBR25FLFlBQVlvRSxHQUVmLE1BQU1qRCxFQUFTekIsU0FBU0csY0FBYyxLQUN0Q3NCLEVBQU9yQixxQkFBdUJhLEVBQU9RLFNBQ3JDZ0QsRUFBR25FLFlBQVltQixHQUVmLE1BQU1FLEVBQVczQixTQUFTRyxjQUFjLEtBSXhDLE9BSEF3QixFQUFTdkIsVUFBWWEsRUFBT1UsU0FDNUI4QyxFQUFHbkUsWUFBWXFCLEdBRVI4QyxJQU1UekIsZUFBaUIsRUFBQ3ZELEVBQWErQyxLQUFLL0MsY0FDbEMsTUFBTXFGLEVBQWE5RSxTQUFTQyxlQUFlLGNBQ3JDd0UsRUFBS3pFLFNBQVNHLGNBQWMsTUFDbENzRSxFQUFHckUsVUFBWVgsRUFBVzhCLEtBQzFCdUQsRUFBV3hFLFlBQVltRSxLQU16Qm5ELG1CQUFxQixFQUFDQyxFQUFNd0QsS0FDckJBLElBQ0hBLEVBQU01QyxPQUFPNkMsU0FBU0MsTUFDeEIxRCxFQUFPQSxFQUFLMkQsUUFBUSxVQUFXLFFBQy9CLE1BQ0VDLEVBRFksSUFBSUMsY0FBYzdELHNCQUNkOEQsS0FBS04sR0FDdkIsT0FBS0ksRUFFQUEsRUFBUSxHQUVORyxtQkFBbUJILEVBQVEsR0FBR0QsUUFBUSxNQUFPLE1BRDNDLEdBRkEiLCJmaWxlIjoicmVzdGF1cmFudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xudmFyIG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGxldCByZXN0YXVyYW50XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICByZXN0YXVyYW50ID0gcmVzdWx0XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXG4gICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgIH0pXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgcmVzdGF1cmFudC5uYW1lKVxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3cyBuZXdlciB2ZXJzaW9ucyBub3cgbmVlZHMgcmVzdGF1cmFudCBpZCB0byBwYXNzZWRcbiAgZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnQuaWQpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICBjb25zdCB0aW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnRJZCkge1xuICBsZXQgcmV2aWV3cztcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICB0aXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcInJldmlldy10aXRsZVwiKTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcbiAgLy8gVGhpcyBmdW5jdGlvbiB3YXMgbW9kaWZpZWQgdG8gYmUgYWJsZSB0byBnZXQgYWxscmV2aWV3cyBmcm9tXG5cbiAgLy8gRmV0Y2ggYWxsIHJldmlld3Mgb2YgY2VydGFpbiByZXN0YXVyYW50XG4gIGF3YWl0IGZldGNoUmV2aWV3c0J5SWQocmVzdGF1cmFudElkKTtcblxuICBjb25zdCBhbGxSZXZpZXdzID0gYXdhaXQgZ2V0UmV2aWV3c0J5UmVzdGF1cmFudElkKHJlc3RhdXJhbnRJZCk7XG5cbiAgaWYgKGFsbFJldmlld3MpIHtcbiAgICBjb25zdCByZXN1bHRzID0gYWxsUmV2aWV3cy5maWx0ZXIociA9PiByLnJlc3RhdXJhbnRfaWQgPT0gcmVzdGF1cmFudElkKTtcbiAgICByZXZpZXdzID0gcmVzdWx0c1xuICB9IGVsc2Uge1xuICAgIHRocm93IG5ldyBFcnJvcignUmV2aWV3cyBkb2VzIG5vdCBleGlzdCcpXG4gIH1cblxuICBpZiAoIXJldmlld3MpIHtcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XG4gICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcbiAgfSk7XG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSBuZXcgRGF0ZShyZXZpZXcudXBkYXRlZEF0KS50b0RhdGVTdHJpbmcoKTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG5cbi8qKlxuICogR2V0IHRoZSB2YWx1ZXMgZnJvbSB0aGUgcmV2aWV3IGZvcm1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWRkUmV2aWV3KCkge1xuICAvLyBQcmV2ZW50aW5nIGRlZmF1bCBiZWhhdmlvclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvLyBSZXRyaXZpbmcgbmVzc2VzYXJ5IGRhdGEgZnJvbSBvdXIgZm9ybVxuICBsZXQgcmVzdGF1cmFudElkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBsZXQgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdlcicpLnZhbHVlO1xuICBsZXQgcmF0aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3JhdGluZy1zZWxlY3Rpb24gb3B0aW9uOmNoZWNrZWQnKS52YWx1ZTtcbiAgbGV0IGNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1jb21tZW50cycpLnZhbHVlXG4gIGNvbnN0IHJldmlldyA9IHtcbiAgICAncmVzdGF1cmFudF9pZCc6IHJlc3RhdXJhbnRJZCxcbiAgICAnbmFtZSc6IG5hbWUsXG4gICAgJ3JhdGluZyc6IHJhdGluZyxcbiAgICAnY29tbWVudHMnOiBjb21tZW50c1xuICB9XG5cbiAgLy8gQ2hlY2tpbmcgaWYgY2xpZW50IGlzIG9ubGluZVxuICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICBEQkhlbHBlci5zZW5kT2ZmbGluZURhdGEocmV2aWV3KTtcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIGF3YWl0IHBvc3RSZXZpZXcocmV2aWV3KTtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LXRpdGxlJyk7XG4gIHRpdGxlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGl0bGUpO1xuICBjb25zdCByZXZpZXdzQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcbiAgcmV2aWV3c0NvbnRlbnQuaW5uZXJIVE1MID0gXCJcIjtcbiAgZmlsbFJldmlld3NIVE1MKHJlc3RhdXJhbnRJZClcbn0iXX0=
